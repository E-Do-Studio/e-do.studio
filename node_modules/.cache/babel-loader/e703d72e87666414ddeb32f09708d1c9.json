{"ast":null,"code":"import { Color, UniformsUtils, ShaderMaterial, CustomBlending, AddEquation, OneFactor, SrcAlphaFactor, WebGLRenderTarget, HalfFloatType } from \"three\";\nimport { Pass, FullScreenQuad } from \"./Pass.js\";\nimport { CopyShader } from \"../shaders/CopyShader.js\";\n\nclass SSAARenderPass extends Pass {\n  constructor(scene, camera, clearColor, clearAlpha) {\n    super();\n    this.scene = scene;\n    this.camera = camera;\n    this.sampleLevel = 4;\n    this.unbiased = true;\n    this.clearColor = clearColor !== void 0 ? clearColor : 0;\n    this.clearAlpha = clearAlpha !== void 0 ? clearAlpha : 0;\n    this._oldClearColor = new Color();\n    const copyShader = CopyShader;\n    this.copyUniforms = UniformsUtils.clone(copyShader.uniforms);\n    this.copyMaterial = new ShaderMaterial({\n      uniforms: this.copyUniforms,\n      vertexShader: copyShader.vertexShader,\n      fragmentShader: copyShader.fragmentShader,\n      transparent: true,\n      depthTest: false,\n      depthWrite: false,\n      // do not use AdditiveBlending because it mixes the alpha channel instead of adding\n      blending: CustomBlending,\n      blendEquation: AddEquation,\n      blendDst: OneFactor,\n      blendDstAlpha: OneFactor,\n      blendSrc: SrcAlphaFactor,\n      blendSrcAlpha: OneFactor\n    });\n    this.fsQuad = new FullScreenQuad(this.copyMaterial);\n  }\n\n  dispose() {\n    if (this.sampleRenderTarget) {\n      this.sampleRenderTarget.dispose();\n      this.sampleRenderTarget = null;\n    }\n\n    this.copyMaterial.dispose();\n    this.fsQuad.dispose();\n  }\n\n  setSize(width, height) {\n    if (this.sampleRenderTarget) this.sampleRenderTarget.setSize(width, height);\n  }\n\n  render(renderer, writeBuffer, readBuffer) {\n    if (!this.sampleRenderTarget) {\n      this.sampleRenderTarget = new WebGLRenderTarget(readBuffer.width, readBuffer.height, {\n        type: HalfFloatType\n      });\n      this.sampleRenderTarget.texture.name = \"SSAARenderPass.sample\";\n    }\n\n    const jitterOffsets = _JitterVectors[Math.max(0, Math.min(this.sampleLevel, 5))];\n\n    const autoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const baseSampleWeight = 1 / jitterOffsets.length;\n    const roundingRange = 1 / 32;\n    this.copyUniforms[\"tDiffuse\"].value = this.sampleRenderTarget.texture;\n    const viewOffset = {\n      fullWidth: readBuffer.width,\n      fullHeight: readBuffer.height,\n      offsetX: 0,\n      offsetY: 0,\n      width: readBuffer.width,\n      height: readBuffer.height\n    };\n    const originalViewOffset = Object.assign({}, this.camera.view);\n    if (originalViewOffset.enabled) Object.assign(viewOffset, originalViewOffset);\n\n    for (let i = 0; i < jitterOffsets.length; i++) {\n      const jitterOffset = jitterOffsets[i];\n\n      if (this.camera.setViewOffset) {\n        this.camera.setViewOffset(viewOffset.fullWidth, viewOffset.fullHeight, viewOffset.offsetX + jitterOffset[0] * 0.0625, viewOffset.offsetY + jitterOffset[1] * 0.0625, // 0.0625 = 1 / 16\n        viewOffset.width, viewOffset.height);\n      }\n\n      let sampleWeight = baseSampleWeight;\n\n      if (this.unbiased) {\n        const uniformCenteredDistribution = -0.5 + (i + 0.5) / jitterOffsets.length;\n        sampleWeight += roundingRange * uniformCenteredDistribution;\n      }\n\n      this.copyUniforms[\"opacity\"].value = sampleWeight;\n      renderer.setClearColor(this.clearColor, this.clearAlpha);\n      renderer.setRenderTarget(this.sampleRenderTarget);\n      renderer.clear();\n      renderer.render(this.scene, this.camera);\n      renderer.setRenderTarget(this.renderToScreen ? null : writeBuffer);\n\n      if (i === 0) {\n        renderer.setClearColor(0, 0);\n        renderer.clear();\n      }\n\n      this.fsQuad.render(renderer);\n    }\n\n    if (this.camera.setViewOffset && originalViewOffset.enabled) {\n      this.camera.setViewOffset(originalViewOffset.fullWidth, originalViewOffset.fullHeight, originalViewOffset.offsetX, originalViewOffset.offsetY, originalViewOffset.width, originalViewOffset.height);\n    } else if (this.camera.clearViewOffset) {\n      this.camera.clearViewOffset();\n    }\n\n    renderer.autoClear = autoClear;\n    renderer.setClearColor(this._oldClearColor, oldClearAlpha);\n  }\n\n}\n\nconst _JitterVectors = [[[0, 0]], [[4, 4], [-4, -4]], [[-2, -6], [6, -2], [-6, 2], [2, 6]], [[1, -3], [-1, 3], [5, 1], [-3, -5], [-5, 5], [-7, -1], [3, 7], [7, -7]], [[1, 1], [-1, -3], [-3, 2], [4, -1], [-5, -2], [2, 5], [5, 3], [3, -5], [-2, 6], [0, -7], [-4, -6], [-6, 4], [-8, 0], [7, -4], [6, 7], [-7, -8]], [[-4, -7], [-7, -5], [-3, -5], [-5, -4], [-1, -4], [-2, -2], [-6, -1], [-4, 0], [-7, 1], [-1, 2], [-6, 3], [-3, 3], [-7, 6], [-3, 6], [-5, 7], [-1, 7], [5, -7], [1, -6], [6, -5], [4, -4], [2, -3], [7, -2], [1, -1], [4, -1], [2, 1], [6, 2], [0, 4], [4, 4], [2, 5], [7, 5], [5, 6], [3, 7]]];\nexport { SSAARenderPass };","map":{"version":3,"sources":["/Users/theodaguier/Repositories/E-Do-Studio/node_modules/three-stdlib/postprocessing/SSAARenderPass.js"],"names":["Color","UniformsUtils","ShaderMaterial","CustomBlending","AddEquation","OneFactor","SrcAlphaFactor","WebGLRenderTarget","HalfFloatType","Pass","FullScreenQuad","CopyShader","SSAARenderPass","constructor","scene","camera","clearColor","clearAlpha","sampleLevel","unbiased","_oldClearColor","copyShader","copyUniforms","clone","uniforms","copyMaterial","vertexShader","fragmentShader","transparent","depthTest","depthWrite","blending","blendEquation","blendDst","blendDstAlpha","blendSrc","blendSrcAlpha","fsQuad","dispose","sampleRenderTarget","setSize","width","height","render","renderer","writeBuffer","readBuffer","type","texture","name","jitterOffsets","_JitterVectors","Math","max","min","autoClear","getClearColor","oldClearAlpha","getClearAlpha","baseSampleWeight","length","roundingRange","value","viewOffset","fullWidth","fullHeight","offsetX","offsetY","originalViewOffset","Object","assign","view","enabled","i","jitterOffset","setViewOffset","sampleWeight","uniformCenteredDistribution","setClearColor","setRenderTarget","clear","renderToScreen","clearViewOffset"],"mappings":"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","sourcesContent":["import { Color, UniformsUtils, ShaderMaterial, CustomBlending, AddEquation, OneFactor, SrcAlphaFactor, WebGLRenderTarget, HalfFloatType } from \"three\";\nimport { Pass, FullScreenQuad } from \"./Pass.js\";\nimport { CopyShader } from \"../shaders/CopyShader.js\";\nclass SSAARenderPass extends Pass {\n  constructor(scene, camera, clearColor, clearAlpha) {\n    super();\n    this.scene = scene;\n    this.camera = camera;\n    this.sampleLevel = 4;\n    this.unbiased = true;\n    this.clearColor = clearColor !== void 0 ? clearColor : 0;\n    this.clearAlpha = clearAlpha !== void 0 ? clearAlpha : 0;\n    this._oldClearColor = new Color();\n    const copyShader = CopyShader;\n    this.copyUniforms = UniformsUtils.clone(copyShader.uniforms);\n    this.copyMaterial = new ShaderMaterial({\n      uniforms: this.copyUniforms,\n      vertexShader: copyShader.vertexShader,\n      fragmentShader: copyShader.fragmentShader,\n      transparent: true,\n      depthTest: false,\n      depthWrite: false,\n      // do not use AdditiveBlending because it mixes the alpha channel instead of adding\n      blending: CustomBlending,\n      blendEquation: AddEquation,\n      blendDst: OneFactor,\n      blendDstAlpha: OneFactor,\n      blendSrc: SrcAlphaFactor,\n      blendSrcAlpha: OneFactor\n    });\n    this.fsQuad = new FullScreenQuad(this.copyMaterial);\n  }\n  dispose() {\n    if (this.sampleRenderTarget) {\n      this.sampleRenderTarget.dispose();\n      this.sampleRenderTarget = null;\n    }\n    this.copyMaterial.dispose();\n    this.fsQuad.dispose();\n  }\n  setSize(width, height) {\n    if (this.sampleRenderTarget)\n      this.sampleRenderTarget.setSize(width, height);\n  }\n  render(renderer, writeBuffer, readBuffer) {\n    if (!this.sampleRenderTarget) {\n      this.sampleRenderTarget = new WebGLRenderTarget(readBuffer.width, readBuffer.height, { type: HalfFloatType });\n      this.sampleRenderTarget.texture.name = \"SSAARenderPass.sample\";\n    }\n    const jitterOffsets = _JitterVectors[Math.max(0, Math.min(this.sampleLevel, 5))];\n    const autoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const baseSampleWeight = 1 / jitterOffsets.length;\n    const roundingRange = 1 / 32;\n    this.copyUniforms[\"tDiffuse\"].value = this.sampleRenderTarget.texture;\n    const viewOffset = {\n      fullWidth: readBuffer.width,\n      fullHeight: readBuffer.height,\n      offsetX: 0,\n      offsetY: 0,\n      width: readBuffer.width,\n      height: readBuffer.height\n    };\n    const originalViewOffset = Object.assign({}, this.camera.view);\n    if (originalViewOffset.enabled)\n      Object.assign(viewOffset, originalViewOffset);\n    for (let i = 0; i < jitterOffsets.length; i++) {\n      const jitterOffset = jitterOffsets[i];\n      if (this.camera.setViewOffset) {\n        this.camera.setViewOffset(\n          viewOffset.fullWidth,\n          viewOffset.fullHeight,\n          viewOffset.offsetX + jitterOffset[0] * 0.0625,\n          viewOffset.offsetY + jitterOffset[1] * 0.0625,\n          // 0.0625 = 1 / 16\n          viewOffset.width,\n          viewOffset.height\n        );\n      }\n      let sampleWeight = baseSampleWeight;\n      if (this.unbiased) {\n        const uniformCenteredDistribution = -0.5 + (i + 0.5) / jitterOffsets.length;\n        sampleWeight += roundingRange * uniformCenteredDistribution;\n      }\n      this.copyUniforms[\"opacity\"].value = sampleWeight;\n      renderer.setClearColor(this.clearColor, this.clearAlpha);\n      renderer.setRenderTarget(this.sampleRenderTarget);\n      renderer.clear();\n      renderer.render(this.scene, this.camera);\n      renderer.setRenderTarget(this.renderToScreen ? null : writeBuffer);\n      if (i === 0) {\n        renderer.setClearColor(0, 0);\n        renderer.clear();\n      }\n      this.fsQuad.render(renderer);\n    }\n    if (this.camera.setViewOffset && originalViewOffset.enabled) {\n      this.camera.setViewOffset(\n        originalViewOffset.fullWidth,\n        originalViewOffset.fullHeight,\n        originalViewOffset.offsetX,\n        originalViewOffset.offsetY,\n        originalViewOffset.width,\n        originalViewOffset.height\n      );\n    } else if (this.camera.clearViewOffset) {\n      this.camera.clearViewOffset();\n    }\n    renderer.autoClear = autoClear;\n    renderer.setClearColor(this._oldClearColor, oldClearAlpha);\n  }\n}\nconst _JitterVectors = [\n  [\n    [0, 0]\n  ],\n  [\n    [4, 4],\n    [-4, -4]\n  ],\n  [\n    [-2, -6],\n    [6, -2],\n    [-6, 2],\n    [2, 6]\n  ],\n  [\n    [1, -3],\n    [-1, 3],\n    [5, 1],\n    [-3, -5],\n    [-5, 5],\n    [-7, -1],\n    [3, 7],\n    [7, -7]\n  ],\n  [\n    [1, 1],\n    [-1, -3],\n    [-3, 2],\n    [4, -1],\n    [-5, -2],\n    [2, 5],\n    [5, 3],\n    [3, -5],\n    [-2, 6],\n    [0, -7],\n    [-4, -6],\n    [-6, 4],\n    [-8, 0],\n    [7, -4],\n    [6, 7],\n    [-7, -8]\n  ],\n  [\n    [-4, -7],\n    [-7, -5],\n    [-3, -5],\n    [-5, -4],\n    [-1, -4],\n    [-2, -2],\n    [-6, -1],\n    [-4, 0],\n    [-7, 1],\n    [-1, 2],\n    [-6, 3],\n    [-3, 3],\n    [-7, 6],\n    [-3, 6],\n    [-5, 7],\n    [-1, 7],\n    [5, -7],\n    [1, -6],\n    [6, -5],\n    [4, -4],\n    [2, -3],\n    [7, -2],\n    [1, -1],\n    [4, -1],\n    [2, 1],\n    [6, 2],\n    [0, 4],\n    [4, 4],\n    [2, 5],\n    [7, 5],\n    [5, 6],\n    [3, 7]\n  ]\n];\nexport {\n  SSAARenderPass\n};\n"]},"metadata":{},"sourceType":"module"}