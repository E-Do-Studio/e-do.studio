{"ast":null,"code":"import _classCallCheck from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport { Loader, FileLoader, LoadingManager, Group } from \"three\";\nimport { ColladaLoader } from \"./ColladaLoader.js\";\nimport { unzipSync } from \"fflate\";\n\nvar KMZLoader = /*#__PURE__*/function (_Loader) {\n  _inherits(KMZLoader, _Loader);\n\n  var _super = _createSuper(KMZLoader);\n\n  function KMZLoader(manager) {\n    _classCallCheck(this, KMZLoader);\n\n    return _super.call(this, manager);\n  }\n\n  _createClass(KMZLoader, [{\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var loader = new FileLoader(scope.manager);\n      loader.setPath(scope.path);\n      loader.setResponseType(\"arraybuffer\");\n      loader.setRequestHeader(scope.requestHeader);\n      loader.setWithCredentials(scope.withCredentials);\n      loader.load(url, function (text) {\n        try {\n          onLoad(scope.parse(text));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n\n          scope.manager.itemError(url);\n        }\n      }, onProgress, onError);\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(data) {\n      function findFile(url) {\n        for (var path in zip) {\n          if (path.substr(-url.length) === url) {\n            return zip[path];\n          }\n        }\n      }\n\n      var manager = new LoadingManager();\n      manager.setURLModifier(function (url) {\n        var image = findFile(url);\n\n        if (image) {\n          console.log(\"Loading\", url);\n          var blob = new Blob([image.buffer], {\n            type: \"application/octet-stream\"\n          });\n          return URL.createObjectURL(blob);\n        }\n\n        return url;\n      });\n      var zip = unzipSync(new Uint8Array(data));\n\n      if (zip[\"doc.kml\"]) {\n        var xml = new DOMParser().parseFromString(fflate.strFromU8(zip[\"doc.kml\"]), \"application/xml\");\n        var model = xml.querySelector(\"Placemark Model Link href\");\n\n        if (model) {\n          var loader = new ColladaLoader(manager);\n          return loader.parse(fflate.strFromU8(zip[model.textContent]));\n        }\n      } else {\n        console.warn(\"KMZLoader: Missing doc.kml file.\");\n\n        for (var path in zip) {\n          var extension = path.split(\".\").pop().toLowerCase();\n\n          if (extension === \"dae\") {\n            var _loader = new ColladaLoader(manager);\n\n            return _loader.parse(fflate.strFromU8(zip[path]));\n          }\n        }\n      }\n\n      console.error(\"KMZLoader: Couldn't find .dae file.\");\n      return {\n        scene: new Group()\n      };\n    }\n  }]);\n\n  return KMZLoader;\n}(Loader);\n\nexport { KMZLoader };","map":{"version":3,"sources":["/Users/theodaguier/Repositories/E-Do-Studio/node_modules/three-stdlib/loaders/KMZLoader.js"],"names":["Loader","FileLoader","LoadingManager","Group","ColladaLoader","unzipSync","KMZLoader","manager","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","load","text","parse","e","console","error","itemError","data","findFile","zip","substr","length","setURLModifier","image","log","blob","Blob","buffer","type","URL","createObjectURL","Uint8Array","xml","DOMParser","parseFromString","fflate","strFromU8","model","querySelector","textContent","warn","extension","split","pop","toLowerCase","scene"],"mappings":";;;;AAAA,SAASA,MAAT,EAAiBC,UAAjB,EAA6BC,cAA7B,EAA6CC,KAA7C,QAA0D,OAA1D;AACA,SAASC,aAAT,QAA8B,oBAA9B;AACA,SAASC,SAAT,QAA0B,QAA1B;;IACMC,S;;;;;AACJ,qBAAYC,OAAZ,EAAqB;AAAA;;AAAA,6BACbA,OADa;AAEpB;;;;WACD,cAAKC,GAAL,EAAUC,MAAV,EAAkBC,UAAlB,EAA8BC,OAA9B,EAAuC;AACrC,UAAMC,KAAK,GAAG,IAAd;AACA,UAAMC,MAAM,GAAG,IAAIZ,UAAJ,CAAeW,KAAK,CAACL,OAArB,CAAf;AACAM,MAAAA,MAAM,CAACC,OAAP,CAAeF,KAAK,CAACG,IAArB;AACAF,MAAAA,MAAM,CAACG,eAAP,CAAuB,aAAvB;AACAH,MAAAA,MAAM,CAACI,gBAAP,CAAwBL,KAAK,CAACM,aAA9B;AACAL,MAAAA,MAAM,CAACM,kBAAP,CAA0BP,KAAK,CAACQ,eAAhC;AACAP,MAAAA,MAAM,CAACQ,IAAP,CACEb,GADF,EAEE,UAASc,IAAT,EAAe;AACb,YAAI;AACFb,UAAAA,MAAM,CAACG,KAAK,CAACW,KAAN,CAAYD,IAAZ,CAAD,CAAN;AACD,SAFD,CAEE,OAAOE,CAAP,EAAU;AACV,cAAIb,OAAJ,EAAa;AACXA,YAAAA,OAAO,CAACa,CAAD,CAAP;AACD,WAFD,MAEO;AACLC,YAAAA,OAAO,CAACC,KAAR,CAAcF,CAAd;AACD;;AACDZ,UAAAA,KAAK,CAACL,OAAN,CAAcoB,SAAd,CAAwBnB,GAAxB;AACD;AACF,OAbH,EAcEE,UAdF,EAeEC,OAfF;AAiBD;;;WACD,eAAMiB,IAAN,EAAY;AACV,eAASC,QAAT,CAAkBrB,GAAlB,EAAuB;AACrB,aAAK,IAAMO,IAAX,IAAmBe,GAAnB,EAAwB;AACtB,cAAIf,IAAI,CAACgB,MAAL,CAAY,CAACvB,GAAG,CAACwB,MAAjB,MAA6BxB,GAAjC,EAAsC;AACpC,mBAAOsB,GAAG,CAACf,IAAD,CAAV;AACD;AACF;AACF;;AACD,UAAMR,OAAO,GAAG,IAAIL,cAAJ,EAAhB;AACAK,MAAAA,OAAO,CAAC0B,cAAR,CAAuB,UAASzB,GAAT,EAAc;AACnC,YAAM0B,KAAK,GAAGL,QAAQ,CAACrB,GAAD,CAAtB;;AACA,YAAI0B,KAAJ,EAAW;AACTT,UAAAA,OAAO,CAACU,GAAR,CAAY,SAAZ,EAAuB3B,GAAvB;AACA,cAAM4B,IAAI,GAAG,IAAIC,IAAJ,CAAS,CAACH,KAAK,CAACI,MAAP,CAAT,EAAyB;AAAEC,YAAAA,IAAI,EAAE;AAAR,WAAzB,CAAb;AACA,iBAAOC,GAAG,CAACC,eAAJ,CAAoBL,IAApB,CAAP;AACD;;AACD,eAAO5B,GAAP;AACD,OARD;AASA,UAAMsB,GAAG,GAAGzB,SAAS,CAAC,IAAIqC,UAAJ,CAAed,IAAf,CAAD,CAArB;;AACA,UAAIE,GAAG,CAAC,SAAD,CAAP,EAAoB;AAClB,YAAMa,GAAG,GAAG,IAAIC,SAAJ,GAAgBC,eAAhB,CAAgCC,MAAM,CAACC,SAAP,CAAiBjB,GAAG,CAAC,SAAD,CAApB,CAAhC,EAAkE,iBAAlE,CAAZ;AACA,YAAMkB,KAAK,GAAGL,GAAG,CAACM,aAAJ,CAAkB,2BAAlB,CAAd;;AACA,YAAID,KAAJ,EAAW;AACT,cAAMnC,MAAM,GAAG,IAAIT,aAAJ,CAAkBG,OAAlB,CAAf;AACA,iBAAOM,MAAM,CAACU,KAAP,CAAauB,MAAM,CAACC,SAAP,CAAiBjB,GAAG,CAACkB,KAAK,CAACE,WAAP,CAApB,CAAb,CAAP;AACD;AACF,OAPD,MAOO;AACLzB,QAAAA,OAAO,CAAC0B,IAAR,CAAa,kCAAb;;AACA,aAAK,IAAMpC,IAAX,IAAmBe,GAAnB,EAAwB;AACtB,cAAMsB,SAAS,GAAGrC,IAAI,CAACsC,KAAL,CAAW,GAAX,EAAgBC,GAAhB,GAAsBC,WAAtB,EAAlB;;AACA,cAAIH,SAAS,KAAK,KAAlB,EAAyB;AACvB,gBAAMvC,OAAM,GAAG,IAAIT,aAAJ,CAAkBG,OAAlB,CAAf;;AACA,mBAAOM,OAAM,CAACU,KAAP,CAAauB,MAAM,CAACC,SAAP,CAAiBjB,GAAG,CAACf,IAAD,CAApB,CAAb,CAAP;AACD;AACF;AACF;;AACDU,MAAAA,OAAO,CAACC,KAAR,CAAc,qCAAd;AACA,aAAO;AAAE8B,QAAAA,KAAK,EAAE,IAAIrD,KAAJ;AAAT,OAAP;AACD;;;;EAnEqBH,M;;AAqExB,SACEM,SADF","sourcesContent":["import { Loader, FileLoader, LoadingManager, Group } from \"three\";\nimport { ColladaLoader } from \"./ColladaLoader.js\";\nimport { unzipSync } from \"fflate\";\nclass KMZLoader extends Loader {\n  constructor(manager) {\n    super(manager);\n  }\n  load(url, onLoad, onProgress, onError) {\n    const scope = this;\n    const loader = new FileLoader(scope.manager);\n    loader.setPath(scope.path);\n    loader.setResponseType(\"arraybuffer\");\n    loader.setRequestHeader(scope.requestHeader);\n    loader.setWithCredentials(scope.withCredentials);\n    loader.load(\n      url,\n      function(text) {\n        try {\n          onLoad(scope.parse(text));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n          scope.manager.itemError(url);\n        }\n      },\n      onProgress,\n      onError\n    );\n  }\n  parse(data) {\n    function findFile(url) {\n      for (const path in zip) {\n        if (path.substr(-url.length) === url) {\n          return zip[path];\n        }\n      }\n    }\n    const manager = new LoadingManager();\n    manager.setURLModifier(function(url) {\n      const image = findFile(url);\n      if (image) {\n        console.log(\"Loading\", url);\n        const blob = new Blob([image.buffer], { type: \"application/octet-stream\" });\n        return URL.createObjectURL(blob);\n      }\n      return url;\n    });\n    const zip = unzipSync(new Uint8Array(data));\n    if (zip[\"doc.kml\"]) {\n      const xml = new DOMParser().parseFromString(fflate.strFromU8(zip[\"doc.kml\"]), \"application/xml\");\n      const model = xml.querySelector(\"Placemark Model Link href\");\n      if (model) {\n        const loader = new ColladaLoader(manager);\n        return loader.parse(fflate.strFromU8(zip[model.textContent]));\n      }\n    } else {\n      console.warn(\"KMZLoader: Missing doc.kml file.\");\n      for (const path in zip) {\n        const extension = path.split(\".\").pop().toLowerCase();\n        if (extension === \"dae\") {\n          const loader = new ColladaLoader(manager);\n          return loader.parse(fflate.strFromU8(zip[path]));\n        }\n      }\n    }\n    console.error(\"KMZLoader: Couldn't find .dae file.\");\n    return { scene: new Group() };\n  }\n}\nexport {\n  KMZLoader\n};\n"]},"metadata":{},"sourceType":"module"}