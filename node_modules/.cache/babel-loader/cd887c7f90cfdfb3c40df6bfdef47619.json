{"ast":null,"code":"import { Loader, FileLoader, BufferGeometry, Vector3, Float32BufferAttribute, AnimationClip } from \"three\";\nconst _normalData = [[-0.525731, 0, 0.850651], [-0.442863, 0.238856, 0.864188], [-0.295242, 0, 0.955423], [-0.309017, 0.5, 0.809017], [-0.16246, 0.262866, 0.951056], [0, 0, 1], [0, 0.850651, 0.525731], [-0.147621, 0.716567, 0.681718], [0.147621, 0.716567, 0.681718], [0, 0.525731, 0.850651], [0.309017, 0.5, 0.809017], [0.525731, 0, 0.850651], [0.295242, 0, 0.955423], [0.442863, 0.238856, 0.864188], [0.16246, 0.262866, 0.951056], [-0.681718, 0.147621, 0.716567], [-0.809017, 0.309017, 0.5], [-0.587785, 0.425325, 0.688191], [-0.850651, 0.525731, 0], [-0.864188, 0.442863, 0.238856], [-0.716567, 0.681718, 0.147621], [-0.688191, 0.587785, 0.425325], [-0.5, 0.809017, 0.309017], [-0.238856, 0.864188, 0.442863], [-0.425325, 0.688191, 0.587785], [-0.716567, 0.681718, -0.147621], [-0.5, 0.809017, -0.309017], [-0.525731, 0.850651, 0], [0, 0.850651, -0.525731], [-0.238856, 0.864188, -0.442863], [0, 0.955423, -0.295242], [-0.262866, 0.951056, -0.16246], [0, 1, 0], [0, 0.955423, 0.295242], [-0.262866, 0.951056, 0.16246], [0.238856, 0.864188, 0.442863], [0.262866, 0.951056, 0.16246], [0.5, 0.809017, 0.309017], [0.238856, 0.864188, -0.442863], [0.262866, 0.951056, -0.16246], [0.5, 0.809017, -0.309017], [0.850651, 0.525731, 0], [0.716567, 0.681718, 0.147621], [0.716567, 0.681718, -0.147621], [0.525731, 0.850651, 0], [0.425325, 0.688191, 0.587785], [0.864188, 0.442863, 0.238856], [0.688191, 0.587785, 0.425325], [0.809017, 0.309017, 0.5], [0.681718, 0.147621, 0.716567], [0.587785, 0.425325, 0.688191], [0.955423, 0.295242, 0], [1, 0, 0], [0.951056, 0.16246, 0.262866], [0.850651, -0.525731, 0], [0.955423, -0.295242, 0], [0.864188, -0.442863, 0.238856], [0.951056, -0.16246, 0.262866], [0.809017, -0.309017, 0.5], [0.681718, -0.147621, 0.716567], [0.850651, 0, 0.525731], [0.864188, 0.442863, -0.238856], [0.809017, 0.309017, -0.5], [0.951056, 0.16246, -0.262866], [0.525731, 0, -0.850651], [0.681718, 0.147621, -0.716567], [0.681718, -0.147621, -0.716567], [0.850651, 0, -0.525731], [0.809017, -0.309017, -0.5], [0.864188, -0.442863, -0.238856], [0.951056, -0.16246, -0.262866], [0.147621, 0.716567, -0.681718], [0.309017, 0.5, -0.809017], [0.425325, 0.688191, -0.587785], [0.442863, 0.238856, -0.864188], [0.587785, 0.425325, -0.688191], [0.688191, 0.587785, -0.425325], [-0.147621, 0.716567, -0.681718], [-0.309017, 0.5, -0.809017], [0, 0.525731, -0.850651], [-0.525731, 0, -0.850651], [-0.442863, 0.238856, -0.864188], [-0.295242, 0, -0.955423], [-0.16246, 0.262866, -0.951056], [0, 0, -1], [0.295242, 0, -0.955423], [0.16246, 0.262866, -0.951056], [-0.442863, -0.238856, -0.864188], [-0.309017, -0.5, -0.809017], [-0.16246, -0.262866, -0.951056], [0, -0.850651, -0.525731], [-0.147621, -0.716567, -0.681718], [0.147621, -0.716567, -0.681718], [0, -0.525731, -0.850651], [0.309017, -0.5, -0.809017], [0.442863, -0.238856, -0.864188], [0.16246, -0.262866, -0.951056], [0.238856, -0.864188, -0.442863], [0.5, -0.809017, -0.309017], [0.425325, -0.688191, -0.587785], [0.716567, -0.681718, -0.147621], [0.688191, -0.587785, -0.425325], [0.587785, -0.425325, -0.688191], [0, -0.955423, -0.295242], [0, -1, 0], [0.262866, -0.951056, -0.16246], [0, -0.850651, 0.525731], [0, -0.955423, 0.295242], [0.238856, -0.864188, 0.442863], [0.262866, -0.951056, 0.16246], [0.5, -0.809017, 0.309017], [0.716567, -0.681718, 0.147621], [0.525731, -0.850651, 0], [-0.238856, -0.864188, -0.442863], [-0.5, -0.809017, -0.309017], [-0.262866, -0.951056, -0.16246], [-0.850651, -0.525731, 0], [-0.716567, -0.681718, -0.147621], [-0.716567, -0.681718, 0.147621], [-0.525731, -0.850651, 0], [-0.5, -0.809017, 0.309017], [-0.238856, -0.864188, 0.442863], [-0.262866, -0.951056, 0.16246], [-0.864188, -0.442863, 0.238856], [-0.809017, -0.309017, 0.5], [-0.688191, -0.587785, 0.425325], [-0.681718, -0.147621, 0.716567], [-0.442863, -0.238856, 0.864188], [-0.587785, -0.425325, 0.688191], [-0.309017, -0.5, 0.809017], [-0.147621, -0.716567, 0.681718], [-0.425325, -0.688191, 0.587785], [-0.16246, -0.262866, 0.951056], [0.442863, -0.238856, 0.864188], [0.16246, -0.262866, 0.951056], [0.309017, -0.5, 0.809017], [0.147621, -0.716567, 0.681718], [0, -0.525731, 0.850651], [0.425325, -0.688191, 0.587785], [0.587785, -0.425325, 0.688191], [0.688191, -0.587785, 0.425325], [-0.955423, 0.295242, 0], [-0.951056, 0.16246, 0.262866], [-1, 0, 0], [-0.850651, 0, 0.525731], [-0.955423, -0.295242, 0], [-0.951056, -0.16246, 0.262866], [-0.864188, 0.442863, -0.238856], [-0.951056, 0.16246, -0.262866], [-0.809017, 0.309017, -0.5], [-0.864188, -0.442863, -0.238856], [-0.951056, -0.16246, -0.262866], [-0.809017, -0.309017, -0.5], [-0.681718, 0.147621, -0.716567], [-0.681718, -0.147621, -0.716567], [-0.850651, 0, -0.525731], [-0.688191, 0.587785, -0.425325], [-0.587785, 0.425325, -0.688191], [-0.425325, 0.688191, -0.587785], [-0.425325, -0.688191, -0.587785], [-0.587785, -0.425325, -0.688191], [-0.688191, -0.587785, -0.425325]];\n\nclass MD2Loader extends Loader {\n  constructor(manager) {\n    super(manager);\n  }\n\n  load(url, onLoad, onProgress, onError) {\n    const scope = this;\n    const loader = new FileLoader(scope.manager);\n    loader.setPath(scope.path);\n    loader.setResponseType(\"arraybuffer\");\n    loader.setRequestHeader(scope.requestHeader);\n    loader.setWithCredentials(scope.withCredentials);\n    loader.load(url, function (buffer) {\n      try {\n        onLoad(scope.parse(buffer));\n      } catch (e) {\n        if (onError) {\n          onError(e);\n        } else {\n          console.error(e);\n        }\n\n        scope.manager.itemError(url);\n      }\n    }, onProgress, onError);\n  }\n\n  parse(buffer) {\n    const data = new DataView(buffer);\n    const header = {};\n    const headerNames = [\"ident\", \"version\", \"skinwidth\", \"skinheight\", \"framesize\", \"num_skins\", \"num_vertices\", \"num_st\", \"num_tris\", \"num_glcmds\", \"num_frames\", \"offset_skins\", \"offset_st\", \"offset_tris\", \"offset_frames\", \"offset_glcmds\", \"offset_end\"];\n\n    for (let i = 0; i < headerNames.length; i++) {\n      header[headerNames[i]] = data.getInt32(i * 4, true);\n    }\n\n    if (header.ident !== 844121161 || header.version !== 8) {\n      console.error(\"Not a valid MD2 file\");\n      return;\n    }\n\n    if (header.offset_end !== data.byteLength) {\n      console.error(\"Corrupted MD2 file\");\n      return;\n    }\n\n    const geometry = new BufferGeometry();\n    const uvsTemp = [];\n    let offset = header.offset_st;\n\n    for (let i = 0, l = header.num_st; i < l; i++) {\n      const u = data.getInt16(offset + 0, true);\n      const v = data.getInt16(offset + 2, true);\n      uvsTemp.push(u / header.skinwidth, 1 - v / header.skinheight);\n      offset += 4;\n    }\n\n    offset = header.offset_tris;\n    const vertexIndices = [];\n    const uvIndices = [];\n\n    for (let i = 0, l = header.num_tris; i < l; i++) {\n      vertexIndices.push(data.getUint16(offset + 0, true), data.getUint16(offset + 2, true), data.getUint16(offset + 4, true));\n      uvIndices.push(data.getUint16(offset + 6, true), data.getUint16(offset + 8, true), data.getUint16(offset + 10, true));\n      offset += 12;\n    }\n\n    const translation = new Vector3();\n    const scale = new Vector3();\n    const string = [];\n    const frames = [];\n    offset = header.offset_frames;\n\n    for (let i = 0, l = header.num_frames; i < l; i++) {\n      scale.set(data.getFloat32(offset + 0, true), data.getFloat32(offset + 4, true), data.getFloat32(offset + 8, true));\n      translation.set(data.getFloat32(offset + 12, true), data.getFloat32(offset + 16, true), data.getFloat32(offset + 20, true));\n      offset += 24;\n\n      for (let j = 0; j < 16; j++) {\n        const character = data.getUint8(offset + j, true);\n        if (character === 0) break;\n        string[j] = character;\n      }\n\n      const frame = {\n        name: String.fromCharCode.apply(null, string),\n        vertices: [],\n        normals: []\n      };\n      offset += 16;\n\n      for (let j = 0; j < header.num_vertices; j++) {\n        let x = data.getUint8(offset++, true);\n        let y = data.getUint8(offset++, true);\n        let z = data.getUint8(offset++, true);\n\n        const n = _normalData[data.getUint8(offset++, true)];\n\n        x = x * scale.x + translation.x;\n        y = y * scale.y + translation.y;\n        z = z * scale.z + translation.z;\n        frame.vertices.push(x, z, y);\n        frame.normals.push(n[0], n[2], n[1]);\n      }\n\n      frames.push(frame);\n    }\n\n    const positions = [];\n    const normals = [];\n    const uvs = [];\n    const verticesTemp = frames[0].vertices;\n    const normalsTemp = frames[0].normals;\n\n    for (let i = 0, l = vertexIndices.length; i < l; i++) {\n      const vertexIndex = vertexIndices[i];\n      let stride = vertexIndex * 3;\n      const x = verticesTemp[stride];\n      const y = verticesTemp[stride + 1];\n      const z = verticesTemp[stride + 2];\n      positions.push(x, y, z);\n      const nx = normalsTemp[stride];\n      const ny = normalsTemp[stride + 1];\n      const nz = normalsTemp[stride + 2];\n      normals.push(nx, ny, nz);\n      const uvIndex = uvIndices[i];\n      stride = uvIndex * 2;\n      const u = uvsTemp[stride];\n      const v = uvsTemp[stride + 1];\n      uvs.push(u, v);\n    }\n\n    geometry.setAttribute(\"position\", new Float32BufferAttribute(positions, 3));\n    geometry.setAttribute(\"normal\", new Float32BufferAttribute(normals, 3));\n    geometry.setAttribute(\"uv\", new Float32BufferAttribute(uvs, 2));\n    const morphPositions = [];\n    const morphNormals = [];\n\n    for (let i = 0, l = frames.length; i < l; i++) {\n      const frame = frames[i];\n      const attributeName = frame.name;\n\n      if (frame.vertices.length > 0) {\n        const positions2 = [];\n\n        for (let j = 0, jl = vertexIndices.length; j < jl; j++) {\n          const vertexIndex = vertexIndices[j];\n          const stride = vertexIndex * 3;\n          const x = frame.vertices[stride];\n          const y = frame.vertices[stride + 1];\n          const z = frame.vertices[stride + 2];\n          positions2.push(x, y, z);\n        }\n\n        const positionAttribute = new Float32BufferAttribute(positions2, 3);\n        positionAttribute.name = attributeName;\n        morphPositions.push(positionAttribute);\n      }\n\n      if (frame.normals.length > 0) {\n        const normals2 = [];\n\n        for (let j = 0, jl = vertexIndices.length; j < jl; j++) {\n          const vertexIndex = vertexIndices[j];\n          const stride = vertexIndex * 3;\n          const nx = frame.normals[stride];\n          const ny = frame.normals[stride + 1];\n          const nz = frame.normals[stride + 2];\n          normals2.push(nx, ny, nz);\n        }\n\n        const normalAttribute = new Float32BufferAttribute(normals2, 3);\n        normalAttribute.name = attributeName;\n        morphNormals.push(normalAttribute);\n      }\n    }\n\n    geometry.morphAttributes.position = morphPositions;\n    geometry.morphAttributes.normal = morphNormals;\n    geometry.morphTargetsRelative = false;\n    geometry.animations = AnimationClip.CreateClipsFromMorphTargetSequences(frames, 10);\n    return geometry;\n  }\n\n}\n\nexport { MD2Loader };","map":{"version":3,"sources":["/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/three-stdlib/loaders/MD2Loader.js"],"names":["Loader","FileLoader","BufferGeometry","Vector3","Float32BufferAttribute","AnimationClip","_normalData","MD2Loader","constructor","manager","load","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","buffer","parse","e","console","error","itemError","data","DataView","header","headerNames","i","length","getInt32","ident","version","offset_end","byteLength","geometry","uvsTemp","offset","offset_st","l","num_st","u","getInt16","v","push","skinwidth","skinheight","offset_tris","vertexIndices","uvIndices","num_tris","getUint16","translation","scale","string","frames","offset_frames","num_frames","set","getFloat32","j","character","getUint8","frame","name","String","fromCharCode","apply","vertices","normals","num_vertices","x","y","z","n","positions","uvs","verticesTemp","normalsTemp","vertexIndex","stride","nx","ny","nz","uvIndex","setAttribute","morphPositions","morphNormals","attributeName","positions2","jl","positionAttribute","normals2","normalAttribute","morphAttributes","position","normal","morphTargetsRelative","animations","CreateClipsFromMorphTargetSequences"],"mappings":"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","sourcesContent":["import { Loader, FileLoader, BufferGeometry, Vector3, Float32BufferAttribute, AnimationClip } from \"three\";\nconst _normalData = [\n  [-0.525731, 0, 0.850651],\n  [-0.442863, 0.238856, 0.864188],\n  [-0.295242, 0, 0.955423],\n  [-0.309017, 0.5, 0.809017],\n  [-0.16246, 0.262866, 0.951056],\n  [0, 0, 1],\n  [0, 0.850651, 0.525731],\n  [-0.147621, 0.716567, 0.681718],\n  [0.147621, 0.716567, 0.681718],\n  [0, 0.525731, 0.850651],\n  [0.309017, 0.5, 0.809017],\n  [0.525731, 0, 0.850651],\n  [0.295242, 0, 0.955423],\n  [0.442863, 0.238856, 0.864188],\n  [0.16246, 0.262866, 0.951056],\n  [-0.681718, 0.147621, 0.716567],\n  [-0.809017, 0.309017, 0.5],\n  [-0.587785, 0.425325, 0.688191],\n  [-0.850651, 0.525731, 0],\n  [-0.864188, 0.442863, 0.238856],\n  [-0.716567, 0.681718, 0.147621],\n  [-0.688191, 0.587785, 0.425325],\n  [-0.5, 0.809017, 0.309017],\n  [-0.238856, 0.864188, 0.442863],\n  [-0.425325, 0.688191, 0.587785],\n  [-0.716567, 0.681718, -0.147621],\n  [-0.5, 0.809017, -0.309017],\n  [-0.525731, 0.850651, 0],\n  [0, 0.850651, -0.525731],\n  [-0.238856, 0.864188, -0.442863],\n  [0, 0.955423, -0.295242],\n  [-0.262866, 0.951056, -0.16246],\n  [0, 1, 0],\n  [0, 0.955423, 0.295242],\n  [-0.262866, 0.951056, 0.16246],\n  [0.238856, 0.864188, 0.442863],\n  [0.262866, 0.951056, 0.16246],\n  [0.5, 0.809017, 0.309017],\n  [0.238856, 0.864188, -0.442863],\n  [0.262866, 0.951056, -0.16246],\n  [0.5, 0.809017, -0.309017],\n  [0.850651, 0.525731, 0],\n  [0.716567, 0.681718, 0.147621],\n  [0.716567, 0.681718, -0.147621],\n  [0.525731, 0.850651, 0],\n  [0.425325, 0.688191, 0.587785],\n  [0.864188, 0.442863, 0.238856],\n  [0.688191, 0.587785, 0.425325],\n  [0.809017, 0.309017, 0.5],\n  [0.681718, 0.147621, 0.716567],\n  [0.587785, 0.425325, 0.688191],\n  [0.955423, 0.295242, 0],\n  [1, 0, 0],\n  [0.951056, 0.16246, 0.262866],\n  [0.850651, -0.525731, 0],\n  [0.955423, -0.295242, 0],\n  [0.864188, -0.442863, 0.238856],\n  [0.951056, -0.16246, 0.262866],\n  [0.809017, -0.309017, 0.5],\n  [0.681718, -0.147621, 0.716567],\n  [0.850651, 0, 0.525731],\n  [0.864188, 0.442863, -0.238856],\n  [0.809017, 0.309017, -0.5],\n  [0.951056, 0.16246, -0.262866],\n  [0.525731, 0, -0.850651],\n  [0.681718, 0.147621, -0.716567],\n  [0.681718, -0.147621, -0.716567],\n  [0.850651, 0, -0.525731],\n  [0.809017, -0.309017, -0.5],\n  [0.864188, -0.442863, -0.238856],\n  [0.951056, -0.16246, -0.262866],\n  [0.147621, 0.716567, -0.681718],\n  [0.309017, 0.5, -0.809017],\n  [0.425325, 0.688191, -0.587785],\n  [0.442863, 0.238856, -0.864188],\n  [0.587785, 0.425325, -0.688191],\n  [0.688191, 0.587785, -0.425325],\n  [-0.147621, 0.716567, -0.681718],\n  [-0.309017, 0.5, -0.809017],\n  [0, 0.525731, -0.850651],\n  [-0.525731, 0, -0.850651],\n  [-0.442863, 0.238856, -0.864188],\n  [-0.295242, 0, -0.955423],\n  [-0.16246, 0.262866, -0.951056],\n  [0, 0, -1],\n  [0.295242, 0, -0.955423],\n  [0.16246, 0.262866, -0.951056],\n  [-0.442863, -0.238856, -0.864188],\n  [-0.309017, -0.5, -0.809017],\n  [-0.16246, -0.262866, -0.951056],\n  [0, -0.850651, -0.525731],\n  [-0.147621, -0.716567, -0.681718],\n  [0.147621, -0.716567, -0.681718],\n  [0, -0.525731, -0.850651],\n  [0.309017, -0.5, -0.809017],\n  [0.442863, -0.238856, -0.864188],\n  [0.16246, -0.262866, -0.951056],\n  [0.238856, -0.864188, -0.442863],\n  [0.5, -0.809017, -0.309017],\n  [0.425325, -0.688191, -0.587785],\n  [0.716567, -0.681718, -0.147621],\n  [0.688191, -0.587785, -0.425325],\n  [0.587785, -0.425325, -0.688191],\n  [0, -0.955423, -0.295242],\n  [0, -1, 0],\n  [0.262866, -0.951056, -0.16246],\n  [0, -0.850651, 0.525731],\n  [0, -0.955423, 0.295242],\n  [0.238856, -0.864188, 0.442863],\n  [0.262866, -0.951056, 0.16246],\n  [0.5, -0.809017, 0.309017],\n  [0.716567, -0.681718, 0.147621],\n  [0.525731, -0.850651, 0],\n  [-0.238856, -0.864188, -0.442863],\n  [-0.5, -0.809017, -0.309017],\n  [-0.262866, -0.951056, -0.16246],\n  [-0.850651, -0.525731, 0],\n  [-0.716567, -0.681718, -0.147621],\n  [-0.716567, -0.681718, 0.147621],\n  [-0.525731, -0.850651, 0],\n  [-0.5, -0.809017, 0.309017],\n  [-0.238856, -0.864188, 0.442863],\n  [-0.262866, -0.951056, 0.16246],\n  [-0.864188, -0.442863, 0.238856],\n  [-0.809017, -0.309017, 0.5],\n  [-0.688191, -0.587785, 0.425325],\n  [-0.681718, -0.147621, 0.716567],\n  [-0.442863, -0.238856, 0.864188],\n  [-0.587785, -0.425325, 0.688191],\n  [-0.309017, -0.5, 0.809017],\n  [-0.147621, -0.716567, 0.681718],\n  [-0.425325, -0.688191, 0.587785],\n  [-0.16246, -0.262866, 0.951056],\n  [0.442863, -0.238856, 0.864188],\n  [0.16246, -0.262866, 0.951056],\n  [0.309017, -0.5, 0.809017],\n  [0.147621, -0.716567, 0.681718],\n  [0, -0.525731, 0.850651],\n  [0.425325, -0.688191, 0.587785],\n  [0.587785, -0.425325, 0.688191],\n  [0.688191, -0.587785, 0.425325],\n  [-0.955423, 0.295242, 0],\n  [-0.951056, 0.16246, 0.262866],\n  [-1, 0, 0],\n  [-0.850651, 0, 0.525731],\n  [-0.955423, -0.295242, 0],\n  [-0.951056, -0.16246, 0.262866],\n  [-0.864188, 0.442863, -0.238856],\n  [-0.951056, 0.16246, -0.262866],\n  [-0.809017, 0.309017, -0.5],\n  [-0.864188, -0.442863, -0.238856],\n  [-0.951056, -0.16246, -0.262866],\n  [-0.809017, -0.309017, -0.5],\n  [-0.681718, 0.147621, -0.716567],\n  [-0.681718, -0.147621, -0.716567],\n  [-0.850651, 0, -0.525731],\n  [-0.688191, 0.587785, -0.425325],\n  [-0.587785, 0.425325, -0.688191],\n  [-0.425325, 0.688191, -0.587785],\n  [-0.425325, -0.688191, -0.587785],\n  [-0.587785, -0.425325, -0.688191],\n  [-0.688191, -0.587785, -0.425325]\n];\nclass MD2Loader extends Loader {\n  constructor(manager) {\n    super(manager);\n  }\n  load(url, onLoad, onProgress, onError) {\n    const scope = this;\n    const loader = new FileLoader(scope.manager);\n    loader.setPath(scope.path);\n    loader.setResponseType(\"arraybuffer\");\n    loader.setRequestHeader(scope.requestHeader);\n    loader.setWithCredentials(scope.withCredentials);\n    loader.load(\n      url,\n      function(buffer) {\n        try {\n          onLoad(scope.parse(buffer));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n          scope.manager.itemError(url);\n        }\n      },\n      onProgress,\n      onError\n    );\n  }\n  parse(buffer) {\n    const data = new DataView(buffer);\n    const header = {};\n    const headerNames = [\n      \"ident\",\n      \"version\",\n      \"skinwidth\",\n      \"skinheight\",\n      \"framesize\",\n      \"num_skins\",\n      \"num_vertices\",\n      \"num_st\",\n      \"num_tris\",\n      \"num_glcmds\",\n      \"num_frames\",\n      \"offset_skins\",\n      \"offset_st\",\n      \"offset_tris\",\n      \"offset_frames\",\n      \"offset_glcmds\",\n      \"offset_end\"\n    ];\n    for (let i = 0; i < headerNames.length; i++) {\n      header[headerNames[i]] = data.getInt32(i * 4, true);\n    }\n    if (header.ident !== 844121161 || header.version !== 8) {\n      console.error(\"Not a valid MD2 file\");\n      return;\n    }\n    if (header.offset_end !== data.byteLength) {\n      console.error(\"Corrupted MD2 file\");\n      return;\n    }\n    const geometry = new BufferGeometry();\n    const uvsTemp = [];\n    let offset = header.offset_st;\n    for (let i = 0, l = header.num_st; i < l; i++) {\n      const u = data.getInt16(offset + 0, true);\n      const v = data.getInt16(offset + 2, true);\n      uvsTemp.push(u / header.skinwidth, 1 - v / header.skinheight);\n      offset += 4;\n    }\n    offset = header.offset_tris;\n    const vertexIndices = [];\n    const uvIndices = [];\n    for (let i = 0, l = header.num_tris; i < l; i++) {\n      vertexIndices.push(\n        data.getUint16(offset + 0, true),\n        data.getUint16(offset + 2, true),\n        data.getUint16(offset + 4, true)\n      );\n      uvIndices.push(\n        data.getUint16(offset + 6, true),\n        data.getUint16(offset + 8, true),\n        data.getUint16(offset + 10, true)\n      );\n      offset += 12;\n    }\n    const translation = new Vector3();\n    const scale = new Vector3();\n    const string = [];\n    const frames = [];\n    offset = header.offset_frames;\n    for (let i = 0, l = header.num_frames; i < l; i++) {\n      scale.set(data.getFloat32(offset + 0, true), data.getFloat32(offset + 4, true), data.getFloat32(offset + 8, true));\n      translation.set(\n        data.getFloat32(offset + 12, true),\n        data.getFloat32(offset + 16, true),\n        data.getFloat32(offset + 20, true)\n      );\n      offset += 24;\n      for (let j = 0; j < 16; j++) {\n        const character = data.getUint8(offset + j, true);\n        if (character === 0)\n          break;\n        string[j] = character;\n      }\n      const frame = {\n        name: String.fromCharCode.apply(null, string),\n        vertices: [],\n        normals: []\n      };\n      offset += 16;\n      for (let j = 0; j < header.num_vertices; j++) {\n        let x = data.getUint8(offset++, true);\n        let y = data.getUint8(offset++, true);\n        let z = data.getUint8(offset++, true);\n        const n = _normalData[data.getUint8(offset++, true)];\n        x = x * scale.x + translation.x;\n        y = y * scale.y + translation.y;\n        z = z * scale.z + translation.z;\n        frame.vertices.push(x, z, y);\n        frame.normals.push(n[0], n[2], n[1]);\n      }\n      frames.push(frame);\n    }\n    const positions = [];\n    const normals = [];\n    const uvs = [];\n    const verticesTemp = frames[0].vertices;\n    const normalsTemp = frames[0].normals;\n    for (let i = 0, l = vertexIndices.length; i < l; i++) {\n      const vertexIndex = vertexIndices[i];\n      let stride = vertexIndex * 3;\n      const x = verticesTemp[stride];\n      const y = verticesTemp[stride + 1];\n      const z = verticesTemp[stride + 2];\n      positions.push(x, y, z);\n      const nx = normalsTemp[stride];\n      const ny = normalsTemp[stride + 1];\n      const nz = normalsTemp[stride + 2];\n      normals.push(nx, ny, nz);\n      const uvIndex = uvIndices[i];\n      stride = uvIndex * 2;\n      const u = uvsTemp[stride];\n      const v = uvsTemp[stride + 1];\n      uvs.push(u, v);\n    }\n    geometry.setAttribute(\"position\", new Float32BufferAttribute(positions, 3));\n    geometry.setAttribute(\"normal\", new Float32BufferAttribute(normals, 3));\n    geometry.setAttribute(\"uv\", new Float32BufferAttribute(uvs, 2));\n    const morphPositions = [];\n    const morphNormals = [];\n    for (let i = 0, l = frames.length; i < l; i++) {\n      const frame = frames[i];\n      const attributeName = frame.name;\n      if (frame.vertices.length > 0) {\n        const positions2 = [];\n        for (let j = 0, jl = vertexIndices.length; j < jl; j++) {\n          const vertexIndex = vertexIndices[j];\n          const stride = vertexIndex * 3;\n          const x = frame.vertices[stride];\n          const y = frame.vertices[stride + 1];\n          const z = frame.vertices[stride + 2];\n          positions2.push(x, y, z);\n        }\n        const positionAttribute = new Float32BufferAttribute(positions2, 3);\n        positionAttribute.name = attributeName;\n        morphPositions.push(positionAttribute);\n      }\n      if (frame.normals.length > 0) {\n        const normals2 = [];\n        for (let j = 0, jl = vertexIndices.length; j < jl; j++) {\n          const vertexIndex = vertexIndices[j];\n          const stride = vertexIndex * 3;\n          const nx = frame.normals[stride];\n          const ny = frame.normals[stride + 1];\n          const nz = frame.normals[stride + 2];\n          normals2.push(nx, ny, nz);\n        }\n        const normalAttribute = new Float32BufferAttribute(normals2, 3);\n        normalAttribute.name = attributeName;\n        morphNormals.push(normalAttribute);\n      }\n    }\n    geometry.morphAttributes.position = morphPositions;\n    geometry.morphAttributes.normal = morphNormals;\n    geometry.morphTargetsRelative = false;\n    geometry.animations = AnimationClip.CreateClipsFromMorphTargetSequences(frames, 10);\n    return geometry;\n  }\n}\nexport {\n  MD2Loader\n};\n"]},"metadata":{},"sourceType":"module"}