{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _classCallCheck from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar __defProp = Object.defineProperty;\n\nvar __defNormalProp = function __defNormalProp(obj, key, value) {\n  return key in obj ? __defProp(obj, key, {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: value\n  }) : obj[key] = value;\n};\n\nvar __publicField = function __publicField(obj, key, value) {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n\n  return value;\n};\n\nimport { Matrix4, EventDispatcher, Vector2, Vector3, Quaternion, Group, EllipseCurve, BufferGeometry, PerspectiveCamera, MathUtils, OrthographicCamera, Box3, Sphere, GridHelper, LineBasicMaterial, Line, Raycaster } from \"three\";\nvar STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nvar INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n};\nvar _center = {\n  x: 0,\n  y: 0\n};\nvar _transformation = {\n  camera: /* @__PURE__ */new Matrix4(),\n  gizmos: /* @__PURE__ */new Matrix4()\n};\nvar _changeEvent = {\n  type: \"change\"\n};\nvar _startEvent = {\n  type: \"start\"\n};\nvar _endEvent = {\n  type: \"end\"\n};\n\nvar ArcballControls = /*#__PURE__*/function (_EventDispatcher) {\n  _inherits(ArcballControls, _EventDispatcher);\n\n  var _super = _createSuper(ArcballControls);\n\n  function ArcballControls(camera) {\n    var _this;\n\n    var domElement = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var scene = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    _classCallCheck(this, ArcballControls);\n\n    _this = _super.call(this);\n\n    __publicField(_assertThisInitialized(_this), \"camera\");\n\n    __publicField(_assertThisInitialized(_this), \"domElement\");\n\n    __publicField(_assertThisInitialized(_this), \"scene\");\n\n    __publicField(_assertThisInitialized(_this), \"mouseActions\");\n\n    __publicField(_assertThisInitialized(_this), \"_mouseOp\");\n\n    __publicField(_assertThisInitialized(_this), \"_v2_1\");\n\n    __publicField(_assertThisInitialized(_this), \"_v3_1\");\n\n    __publicField(_assertThisInitialized(_this), \"_v3_2\");\n\n    __publicField(_assertThisInitialized(_this), \"_m4_1\");\n\n    __publicField(_assertThisInitialized(_this), \"_m4_2\");\n\n    __publicField(_assertThisInitialized(_this), \"_quat\");\n\n    __publicField(_assertThisInitialized(_this), \"_translationMatrix\");\n\n    __publicField(_assertThisInitialized(_this), \"_rotationMatrix\");\n\n    __publicField(_assertThisInitialized(_this), \"_scaleMatrix\");\n\n    __publicField(_assertThisInitialized(_this), \"_rotationAxis\");\n\n    __publicField(_assertThisInitialized(_this), \"_cameraMatrixState\");\n\n    __publicField(_assertThisInitialized(_this), \"_cameraProjectionState\");\n\n    __publicField(_assertThisInitialized(_this), \"_fovState\");\n\n    __publicField(_assertThisInitialized(_this), \"_upState\");\n\n    __publicField(_assertThisInitialized(_this), \"_zoomState\");\n\n    __publicField(_assertThisInitialized(_this), \"_nearPos\");\n\n    __publicField(_assertThisInitialized(_this), \"_farPos\");\n\n    __publicField(_assertThisInitialized(_this), \"_gizmoMatrixState\");\n\n    __publicField(_assertThisInitialized(_this), \"_up0\");\n\n    __publicField(_assertThisInitialized(_this), \"_zoom0\");\n\n    __publicField(_assertThisInitialized(_this), \"_fov0\");\n\n    __publicField(_assertThisInitialized(_this), \"_initialNear\");\n\n    __publicField(_assertThisInitialized(_this), \"_nearPos0\");\n\n    __publicField(_assertThisInitialized(_this), \"_initialFar\");\n\n    __publicField(_assertThisInitialized(_this), \"_farPos0\");\n\n    __publicField(_assertThisInitialized(_this), \"_cameraMatrixState0\");\n\n    __publicField(_assertThisInitialized(_this), \"_gizmoMatrixState0\");\n\n    __publicField(_assertThisInitialized(_this), \"_button\");\n\n    __publicField(_assertThisInitialized(_this), \"_touchStart\");\n\n    __publicField(_assertThisInitialized(_this), \"_touchCurrent\");\n\n    __publicField(_assertThisInitialized(_this), \"_input\");\n\n    __publicField(_assertThisInitialized(_this), \"_switchSensibility\");\n\n    __publicField(_assertThisInitialized(_this), \"_startFingerDistance\");\n\n    __publicField(_assertThisInitialized(_this), \"_currentFingerDistance\");\n\n    __publicField(_assertThisInitialized(_this), \"_startFingerRotation\");\n\n    __publicField(_assertThisInitialized(_this), \"_currentFingerRotation\");\n\n    __publicField(_assertThisInitialized(_this), \"_devPxRatio\");\n\n    __publicField(_assertThisInitialized(_this), \"_downValid\");\n\n    __publicField(_assertThisInitialized(_this), \"_nclicks\");\n\n    __publicField(_assertThisInitialized(_this), \"_downEvents\");\n\n    __publicField(_assertThisInitialized(_this), \"_clickStart\");\n\n    __publicField(_assertThisInitialized(_this), \"_maxDownTime\");\n\n    __publicField(_assertThisInitialized(_this), \"_maxInterval\");\n\n    __publicField(_assertThisInitialized(_this), \"_posThreshold\");\n\n    __publicField(_assertThisInitialized(_this), \"_movementThreshold\");\n\n    __publicField(_assertThisInitialized(_this), \"_currentCursorPosition\");\n\n    __publicField(_assertThisInitialized(_this), \"_startCursorPosition\");\n\n    __publicField(_assertThisInitialized(_this), \"_grid\");\n\n    __publicField(_assertThisInitialized(_this), \"_gridPosition\");\n\n    __publicField(_assertThisInitialized(_this), \"_gizmos\");\n\n    __publicField(_assertThisInitialized(_this), \"_curvePts\");\n\n    __publicField(_assertThisInitialized(_this), \"_timeStart\");\n\n    __publicField(_assertThisInitialized(_this), \"_animationId\");\n\n    __publicField(_assertThisInitialized(_this), \"focusAnimationTime\");\n\n    __publicField(_assertThisInitialized(_this), \"_timePrev\");\n\n    __publicField(_assertThisInitialized(_this), \"_timeCurrent\");\n\n    __publicField(_assertThisInitialized(_this), \"_anglePrev\");\n\n    __publicField(_assertThisInitialized(_this), \"_angleCurrent\");\n\n    __publicField(_assertThisInitialized(_this), \"_cursorPosPrev\");\n\n    __publicField(_assertThisInitialized(_this), \"_cursorPosCurr\");\n\n    __publicField(_assertThisInitialized(_this), \"_wPrev\");\n\n    __publicField(_assertThisInitialized(_this), \"_wCurr\");\n\n    __publicField(_assertThisInitialized(_this), \"adjustNearFar\");\n\n    __publicField(_assertThisInitialized(_this), \"scaleFactor\");\n\n    __publicField(_assertThisInitialized(_this), \"dampingFactor\");\n\n    __publicField(_assertThisInitialized(_this), \"wMax\");\n\n    __publicField(_assertThisInitialized(_this), \"enableAnimations\");\n\n    __publicField(_assertThisInitialized(_this), \"enableGrid\");\n\n    __publicField(_assertThisInitialized(_this), \"cursorZoom\");\n\n    __publicField(_assertThisInitialized(_this), \"minFov\");\n\n    __publicField(_assertThisInitialized(_this), \"maxFov\");\n\n    __publicField(_assertThisInitialized(_this), \"enabled\");\n\n    __publicField(_assertThisInitialized(_this), \"enablePan\");\n\n    __publicField(_assertThisInitialized(_this), \"enableRotate\");\n\n    __publicField(_assertThisInitialized(_this), \"enableZoom\");\n\n    __publicField(_assertThisInitialized(_this), \"minDistance\");\n\n    __publicField(_assertThisInitialized(_this), \"maxDistance\");\n\n    __publicField(_assertThisInitialized(_this), \"minZoom\");\n\n    __publicField(_assertThisInitialized(_this), \"maxZoom\");\n\n    __publicField(_assertThisInitialized(_this), \"target\");\n\n    __publicField(_assertThisInitialized(_this), \"_currentTarget\");\n\n    __publicField(_assertThisInitialized(_this), \"_tbRadius\");\n\n    __publicField(_assertThisInitialized(_this), \"_state\"); //listeners\n\n\n    __publicField(_assertThisInitialized(_this), \"onWindowResize\", function () {\n      var scale = (_this._gizmos.scale.x + _this._gizmos.scale.y + _this._gizmos.scale.z) / 3;\n\n      if (_this.camera) {\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== void 0) {\n          _this._tbRadius = tbRadius;\n        }\n      }\n\n      var newRadius = _this._tbRadius / scale;\n      var curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      var points = curve.getPoints(_this._curvePts);\n      var curveGeometry = new BufferGeometry().setFromPoints(points);\n\n      for (var gizmo in _this._gizmos.children) {\n        var child = _this._gizmos.children[gizmo];\n        child.geometry = curveGeometry;\n      }\n\n      _this.dispatchEvent(_changeEvent);\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onContextMenu\", function (event) {\n      if (!_this.enabled) {\n        return;\n      }\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        if (_this.mouseActions[i].mouse == 2) {\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onPointerCancel\", function () {\n      _this._touchStart.splice(0, _this._touchStart.length);\n\n      _this._touchCurrent.splice(0, _this._touchCurrent.length);\n\n      _this._input = INPUT.NONE;\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onPointerDown\", function (event) {\n      if (event.button == 0 && event.isPrimary) {\n        _this._downValid = true;\n\n        _this._downEvents.push(event);\n      } else {\n        _this._downValid = false;\n      }\n\n      if (event.pointerType == \"touch\" && _this._input != INPUT.CURSOR) {\n        _this._touchStart.push(event);\n\n        _this._touchCurrent.push(event);\n\n        switch (_this._input) {\n          case INPUT.NONE:\n            _this._input = INPUT.ONE_FINGER;\n\n            _this.onSinglePanStart(event, \"ROTATE\");\n\n            window.addEventListener(\"pointermove\", _this.onPointerMove);\n            window.addEventListener(\"pointerup\", _this.onPointerUp);\n            break;\n\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            _this._input = INPUT.TWO_FINGER;\n\n            _this.onRotateStart();\n\n            _this.onPinchStart();\n\n            _this.onDoublePanStart();\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            _this._input = INPUT.MULT_FINGER;\n\n            _this.onTriplePanStart();\n\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && _this._input == INPUT.NONE) {\n        var modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n\n        _this._mouseOp = _this.getOpFromAction(event.button, modifier);\n\n        if (_this._mouseOp) {\n          window.addEventListener(\"pointermove\", _this.onPointerMove);\n          window.addEventListener(\"pointerup\", _this.onPointerUp);\n          _this._input = INPUT.CURSOR;\n          _this._button = event.button;\n\n          _this.onSinglePanStart(event, _this._mouseOp);\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onPointerMove\", function (event) {\n      if (event.pointerType == \"touch\" && _this._input != INPUT.CURSOR) {\n        switch (_this._input) {\n          case INPUT.ONE_FINGER:\n            _this.updateTouchEvent(event);\n\n            _this.onSinglePanMove(event, STATE.ROTATE);\n\n            break;\n\n          case INPUT.ONE_FINGER_SWITCHED:\n            var movement = _this.calculatePointersDistance(_this._touchCurrent[0], event) * _this._devPxRatio;\n\n            if (movement >= _this._switchSensibility) {\n              _this._input = INPUT.ONE_FINGER;\n\n              _this.updateTouchEvent(event);\n\n              _this.onSinglePanStart(event, \"ROTATE\");\n\n              break;\n            }\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            _this.updateTouchEvent(event);\n\n            _this.onRotateMove();\n\n            _this.onPinchMove();\n\n            _this.onDoublePanMove();\n\n            break;\n\n          case INPUT.MULT_FINGER:\n            _this.updateTouchEvent(event);\n\n            _this.onTriplePanMove();\n\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && _this._input == INPUT.CURSOR) {\n        var modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n\n        var mouseOpState = _this.getOpStateFromAction(_this._button, modifier);\n\n        if (mouseOpState) {\n          _this.onSinglePanMove(event, mouseOpState);\n        }\n      }\n\n      if (_this._downValid) {\n        var _movement = _this.calculatePointersDistance(_this._downEvents[_this._downEvents.length - 1], event) * _this._devPxRatio;\n\n        if (_movement > _this._movementThreshold) {\n          _this._downValid = false;\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onPointerUp\", function (event) {\n      if (event.pointerType == \"touch\" && _this._input != INPUT.CURSOR) {\n        var nTouch = _this._touchCurrent.length;\n\n        for (var i = 0; i < nTouch; i++) {\n          if (_this._touchCurrent[i].pointerId == event.pointerId) {\n            _this._touchCurrent.splice(i, 1);\n\n            _this._touchStart.splice(i, 1);\n\n            break;\n          }\n        }\n\n        switch (_this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            window.removeEventListener(\"pointermove\", _this.onPointerMove);\n            window.removeEventListener(\"pointerup\", _this.onPointerUp);\n            _this._input = INPUT.NONE;\n\n            _this.onSinglePanEnd();\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            _this.onDoublePanEnd();\n\n            _this.onPinchEnd();\n\n            _this.onRotateEnd();\n\n            _this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n\n          case INPUT.MULT_FINGER:\n            if (_this._touchCurrent.length == 0) {\n              window.removeEventListener(\"pointermove\", _this.onPointerMove);\n              window.removeEventListener(\"pointerup\", _this.onPointerUp);\n              _this._input = INPUT.NONE;\n\n              _this.onTriplePanEnd();\n            }\n\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && _this._input == INPUT.CURSOR) {\n        window.removeEventListener(\"pointermove\", _this.onPointerMove);\n        window.removeEventListener(\"pointerup\", _this.onPointerUp);\n        _this._input = INPUT.NONE;\n\n        _this.onSinglePanEnd();\n\n        _this._button = -1;\n      }\n\n      if (event.isPrimary) {\n        if (_this._downValid) {\n          var downTime = event.timeStamp - _this._downEvents[_this._downEvents.length - 1].timeStamp;\n\n          if (downTime <= _this._maxDownTime) {\n            if (_this._nclicks == 0) {\n              _this._nclicks = 1;\n              _this._clickStart = performance.now();\n            } else {\n              var clickInterval = event.timeStamp - _this._clickStart;\n\n              var movement = _this.calculatePointersDistance(_this._downEvents[1], _this._downEvents[0]) * _this._devPxRatio;\n\n              if (clickInterval <= _this._maxInterval && movement <= _this._posThreshold) {\n                _this._nclicks = 0;\n\n                _this._downEvents.splice(0, _this._downEvents.length);\n\n                _this.onDoubleTap(event);\n              } else {\n                _this._nclicks = 1;\n\n                _this._downEvents.shift();\n\n                _this._clickStart = performance.now();\n              }\n            }\n          } else {\n            _this._downValid = false;\n            _this._nclicks = 0;\n\n            _this._downEvents.splice(0, _this._downEvents.length);\n          }\n        } else {\n          _this._nclicks = 0;\n\n          _this._downEvents.splice(0, _this._downEvents.length);\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onWheel\", function (event) {\n      var _a, _b;\n\n      if (_this.enabled && _this.enableZoom && _this.domElement) {\n        var modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n\n        var mouseOp = _this.getOpFromAction(\"WHEEL\", modifier);\n\n        if (mouseOp) {\n          event.preventDefault();\n\n          _this.dispatchEvent(_startEvent);\n\n          var notchDeltaY = 125;\n          var sgn = event.deltaY / notchDeltaY;\n          var size = 1;\n\n          if (sgn > 0) {\n            size = 1 / _this.scaleFactor;\n          } else if (sgn < 0) {\n            size = _this.scaleFactor;\n          }\n\n          switch (mouseOp) {\n            case \"ZOOM\":\n              _this.updateTbState(STATE.SCALE, true);\n\n              if (sgn > 0) {\n                size = 1 / Math.pow(_this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(_this.scaleFactor, -sgn);\n              }\n\n              if (_this.cursorZoom && _this.enablePan) {\n                var scalePoint;\n\n                if (_this.camera instanceof OrthographicCamera) {\n                  scalePoint = (_a = _this.unprojectOnTbPlane(_this.camera, event.clientX, event.clientY, _this.domElement)) == null ? void 0 : _a.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._gizmos.position);\n                }\n\n                if (_this.camera instanceof PerspectiveCamera) {\n                  scalePoint = (_b = _this.unprojectOnTbPlane(_this.camera, event.clientX, event.clientY, _this.domElement)) == null ? void 0 : _b.applyQuaternion(_this.camera.quaternion).add(_this._gizmos.position);\n                }\n\n                if (scalePoint !== void 0) _this.applyTransformMatrix(_this.applyScale(size, scalePoint));\n              } else {\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n              }\n\n              if (_this._grid) {\n                _this.disposeGrid();\n\n                _this.drawGrid();\n              }\n\n              _this.updateTbState(STATE.IDLE, false);\n\n              _this.dispatchEvent(_changeEvent);\n\n              _this.dispatchEvent(_endEvent);\n\n              break;\n\n            case \"FOV\":\n              if (_this.camera instanceof PerspectiveCamera) {\n                _this.updateTbState(STATE.FOV, true);\n\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(_this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(_this.scaleFactor, -sgn);\n                  }\n                }\n\n                _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n                var x = _this._v3_1.distanceTo(_this._gizmos.position);\n\n                var xNew = x / size;\n                xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n                var y = x * Math.tan(MathUtils.DEG2RAD * _this.camera.fov * 0.5);\n                var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n\n                if (newFov > _this.maxFov) {\n                  newFov = _this.maxFov;\n                } else if (newFov < _this.minFov) {\n                  newFov = _this.minFov;\n                }\n\n                var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n\n                _this.setFov(newFov);\n\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position, false));\n              }\n\n              if (_this._grid) {\n                _this.disposeGrid();\n\n                _this.drawGrid();\n              }\n\n              _this.updateTbState(STATE.IDLE, false);\n\n              _this.dispatchEvent(_changeEvent);\n\n              _this.dispatchEvent(_endEvent);\n\n              break;\n          }\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onSinglePanStart\", function (event, operation) {\n      if (_this.enabled && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.setCenter(event.clientX, event.clientY);\n\n        switch (operation) {\n          case \"PAN\":\n            if (!_this.enablePan) return;\n\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n\n              _this.activateGizmos(false);\n\n              _this.dispatchEvent(_changeEvent);\n            }\n\n            if (_this.camera) {\n              _this.updateTbState(STATE.PAN, true);\n\n              var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n\n              if (rayDir !== void 0) {\n                _this._startCursorPosition.copy(rayDir);\n              }\n\n              if (_this.enableGrid) {\n                _this.drawGrid();\n\n                _this.dispatchEvent(_changeEvent);\n              }\n            }\n\n            break;\n\n          case \"ROTATE\":\n            if (!_this.enableRotate) return;\n\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n            }\n\n            if (_this.camera) {\n              _this.updateTbState(STATE.ROTATE, true);\n\n              var _rayDir = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n\n              if (_rayDir !== void 0) {\n                _this._startCursorPosition.copy(_rayDir);\n              }\n\n              _this.activateGizmos(true);\n\n              if (_this.enableAnimations) {\n                _this._timePrev = _this._timeCurrent = performance.now();\n                _this._angleCurrent = _this._anglePrev = 0;\n\n                _this._cursorPosPrev.copy(_this._startCursorPosition);\n\n                _this._cursorPosCurr.copy(_this._cursorPosPrev);\n\n                _this._wCurr = 0;\n                _this._wPrev = _this._wCurr;\n              }\n            }\n\n            _this.dispatchEvent(_changeEvent);\n\n            break;\n\n          case \"FOV\":\n            if (!_this.enableZoom) return;\n\n            if (_this.camera instanceof PerspectiveCamera) {\n              if (_this._animationId != -1) {\n                cancelAnimationFrame(_this._animationId);\n                _this._animationId = -1;\n                _this._timeStart = -1;\n\n                _this.activateGizmos(false);\n\n                _this.dispatchEvent(_changeEvent);\n              }\n\n              _this.updateTbState(STATE.FOV, true);\n\n              _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n              _this._currentCursorPosition.copy(_this._startCursorPosition);\n            }\n\n            break;\n\n          case \"ZOOM\":\n            if (!_this.enableZoom) return;\n\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n\n              _this.activateGizmos(false);\n\n              _this.dispatchEvent(_changeEvent);\n            }\n\n            _this.updateTbState(STATE.SCALE, true);\n\n            _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n            _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n            break;\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onSinglePanMove\", function (event, opState) {\n      if (_this.enabled && _this.domElement) {\n        var restart = opState != _this._state;\n\n        _this.setCenter(event.clientX, event.clientY);\n\n        switch (opState) {\n          case STATE.PAN:\n            if (_this.enablePan && _this.camera) {\n              if (restart) {\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n\n                if (rayDir !== void 0) {\n                  _this._startCursorPosition.copy(rayDir);\n                }\n\n                if (_this.enableGrid) {\n                  _this.drawGrid();\n                }\n\n                _this.activateGizmos(false);\n              } else {\n                var _rayDir2 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n\n                if (_rayDir2 !== void 0) {\n                  _this._currentCursorPosition.copy(_rayDir2);\n                }\n\n                _this.applyTransformMatrix(_this.pan(_this._startCursorPosition, _this._currentCursorPosition));\n              }\n            }\n\n            break;\n\n          case STATE.ROTATE:\n            if (_this.enableRotate && _this.camera) {\n              if (restart) {\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                var _rayDir3 = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n\n                if (_rayDir3 !== void 0) {\n                  _this._startCursorPosition.copy(_rayDir3);\n                }\n\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n\n                _this.activateGizmos(true);\n              } else {\n                var _rayDir4 = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n\n                if (_rayDir4 !== void 0) {\n                  _this._currentCursorPosition.copy(_rayDir4);\n                }\n\n                var distance = _this._startCursorPosition.distanceTo(_this._currentCursorPosition);\n\n                var angle = _this._startCursorPosition.angleTo(_this._currentCursorPosition);\n\n                var amount = Math.max(distance / _this._tbRadius, angle);\n\n                _this.applyTransformMatrix(_this.rotate(_this.calculateRotationAxis(_this._startCursorPosition, _this._currentCursorPosition), amount));\n\n                if (_this.enableAnimations) {\n                  _this._timePrev = _this._timeCurrent;\n                  _this._timeCurrent = performance.now();\n                  _this._anglePrev = _this._angleCurrent;\n                  _this._angleCurrent = amount;\n\n                  _this._cursorPosPrev.copy(_this._cursorPosCurr);\n\n                  _this._cursorPosCurr.copy(_this._currentCursorPosition);\n\n                  _this._wPrev = _this._wCurr;\n                  _this._wCurr = _this.calculateAngularSpeed(_this._anglePrev, _this._angleCurrent, _this._timePrev, _this._timeCurrent);\n                }\n              }\n            }\n\n            break;\n\n          case STATE.SCALE:\n            if (_this.enableZoom) {\n              if (restart) {\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n\n                _this.activateGizmos(false);\n              } else {\n                var screenNotches = 8;\n\n                _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                var movement = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n                var size = 1;\n\n                if (movement < 0) {\n                  size = 1 / Math.pow(_this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(_this.scaleFactor, movement * screenNotches);\n                }\n\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n              }\n            }\n\n            break;\n\n          case STATE.FOV:\n            if (_this.enableZoom && _this.camera instanceof PerspectiveCamera) {\n              if (restart) {\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n\n                _this.activateGizmos(false);\n              } else {\n                var _screenNotches = 8;\n\n                _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                var _movement2 = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n\n                var _size = 1;\n\n                if (_movement2 < 0) {\n                  _size = 1 / Math.pow(_this.scaleFactor, -_movement2 * _screenNotches);\n                } else if (_movement2 > 0) {\n                  _size = Math.pow(_this.scaleFactor, _movement2 * _screenNotches);\n                }\n\n                _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n                var x = _this._v3_1.distanceTo(_this._gizmos.position);\n\n                var xNew = x / _size;\n                xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n                var y = x * Math.tan(MathUtils.DEG2RAD * _this._fovState * 0.5);\n                var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n                newFov = MathUtils.clamp(newFov, _this.minFov, _this.maxFov);\n                var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                _size = x / newDistance;\n\n                _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n\n                _this.setFov(newFov);\n\n                _this.applyTransformMatrix(_this.applyScale(_size, _this._v3_2, false));\n\n                var direction = _this._gizmos.position.clone().sub(_this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n                _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n\n            break;\n        }\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onSinglePanEnd\", function () {\n      if (_this._state == STATE.ROTATE) {\n        if (!_this.enableRotate) {\n          return;\n        }\n\n        if (_this.enableAnimations) {\n          var deltaTime = performance.now() - _this._timeCurrent;\n\n          if (deltaTime < 120) {\n            var w = Math.abs((_this._wPrev + _this._wCurr) / 2);\n\n            var self = _assertThisInitialized(_this);\n\n            _this._animationId = window.requestAnimationFrame(function (t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              var rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            _this.updateTbState(STATE.IDLE, false);\n\n            _this.activateGizmos(false);\n\n            _this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      } else if (_this._state == STATE.PAN || _this._state == STATE.IDLE) {\n        _this.updateTbState(STATE.IDLE, false);\n\n        if (_this.enableGrid) {\n          _this.disposeGrid();\n        }\n\n        _this.activateGizmos(false);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onDoubleTap\", function (event) {\n      if (_this.enabled && _this.enablePan && _this.scene && _this.camera && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.setCenter(event.clientX, event.clientY);\n\n        var hitP = _this.unprojectOnObj(_this.getCursorNDC(_center.x, _center.y, _this.domElement), _this.camera);\n\n        if (hitP && _this.enableAnimations) {\n          var self = _assertThisInitialized(_this);\n\n          if (_this._animationId != -1) {\n            window.cancelAnimationFrame(_this._animationId);\n          }\n\n          _this._timeStart = -1;\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP && !_this.enableAnimations) {\n          _this.updateTbState(STATE.FOCUS, true);\n\n          _this.focus(hitP, _this.scaleFactor);\n\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      }\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onDoublePanStart\", function () {\n      if (_this.enabled && _this.enablePan && _this.camera && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.PAN, true);\n\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement, true);\n\n        if (rayDir !== void 0) {\n          _this._startCursorPosition.copy(rayDir);\n        }\n\n        _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n        _this.activateGizmos(false);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onDoublePanMove\", function () {\n      if (_this.enabled && _this.enablePan && _this.camera && _this.domElement) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        if (_this._state != STATE.PAN) {\n          _this.updateTbState(STATE.PAN, true);\n\n          _this._startCursorPosition.copy(_this._currentCursorPosition);\n        }\n\n        var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement, true);\n\n        if (rayDir !== void 0) _this._currentCursorPosition.copy(rayDir);\n\n        _this.applyTransformMatrix(_this.pan(_this._startCursorPosition, _this._currentCursorPosition, true));\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onDoublePanEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onRotateStart\", function () {\n      var _a;\n\n      if (_this.enabled && _this.enableRotate) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.ZROTATE, true);\n\n        _this._startFingerRotation = _this.getAngle(_this._touchCurrent[1], _this._touchCurrent[0]) + _this.getAngle(_this._touchStart[1], _this._touchStart[0]);\n        _this._currentFingerRotation = _this._startFingerRotation;\n        (_a = _this.camera) == null ? void 0 : _a.getWorldDirection(_this._rotationAxis);\n\n        if (!_this.enablePan && !_this.enableZoom) {\n          _this.activateGizmos(true);\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onRotateMove\", function () {\n      var _a;\n\n      if (_this.enabled && _this.enableRotate && _this.camera && _this.domElement) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        var rotationPoint;\n\n        if (_this._state != STATE.ZROTATE) {\n          _this.updateTbState(STATE.ZROTATE, true);\n\n          _this._startFingerRotation = _this._currentFingerRotation;\n        }\n\n        _this._currentFingerRotation = _this.getAngle(_this._touchCurrent[1], _this._touchCurrent[0]) + _this.getAngle(_this._touchStart[1], _this._touchStart[0]);\n\n        if (!_this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(_this._gizmoMatrixState);\n        } else if (_this.camera) {\n          _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n\n          rotationPoint = (_a = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) == null ? void 0 : _a.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._v3_2);\n        }\n\n        var amount = MathUtils.DEG2RAD * (_this._startFingerRotation - _this._currentFingerRotation);\n\n        if (rotationPoint !== void 0) {\n          _this.applyTransformMatrix(_this.zRotate(rotationPoint, amount));\n        }\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onRotateEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.activateGizmos(false);\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onPinchStart\", function () {\n      if (_this.enabled && _this.enableZoom) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.SCALE, true);\n\n        _this._startFingerDistance = _this.calculatePointersDistance(_this._touchCurrent[0], _this._touchCurrent[1]);\n        _this._currentFingerDistance = _this._startFingerDistance;\n\n        _this.activateGizmos(false);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onPinchMove\", function () {\n      var _a, _b;\n\n      if (_this.enabled && _this.enableZoom && _this.domElement) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        var minDistance = 12;\n\n        if (_this._state != STATE.SCALE) {\n          _this._startFingerDistance = _this._currentFingerDistance;\n\n          _this.updateTbState(STATE.SCALE, true);\n        }\n\n        _this._currentFingerDistance = Math.max(_this.calculatePointersDistance(_this._touchCurrent[0], _this._touchCurrent[1]), minDistance * _this._devPxRatio);\n        var amount = _this._currentFingerDistance / _this._startFingerDistance;\n        var scalePoint;\n\n        if (!_this.enablePan) {\n          scalePoint = _this._gizmos.position;\n        } else {\n          if (_this.camera instanceof OrthographicCamera) {\n            scalePoint = (_a = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) == null ? void 0 : _a.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._gizmos.position);\n          } else if (_this.camera instanceof PerspectiveCamera) {\n            scalePoint = (_b = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) == null ? void 0 : _b.applyQuaternion(_this.camera.quaternion).add(_this._gizmos.position);\n          }\n        }\n\n        if (scalePoint !== void 0) {\n          _this.applyTransformMatrix(_this.applyScale(amount, scalePoint));\n        }\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onPinchEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onTriplePanStart\", function () {\n      if (_this.enabled && _this.enableZoom && _this.domElement) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.SCALE, true);\n\n        var clientX = 0;\n        var clientY = 0;\n        var nFingers = _this._touchCurrent.length;\n\n        for (var i = 0; i < nFingers; i++) {\n          clientX += _this._touchCurrent[i].clientX;\n          clientY += _this._touchCurrent[i].clientY;\n        }\n\n        _this.setCenter(clientX / nFingers, clientY / nFingers);\n\n        _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n        _this._currentCursorPosition.copy(_this._startCursorPosition);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onTriplePanMove\", function () {\n      if (_this.enabled && _this.enableZoom && _this.camera && _this.domElement) {\n        var clientX = 0;\n        var clientY = 0;\n        var nFingers = _this._touchCurrent.length;\n\n        for (var i = 0; i < nFingers; i++) {\n          clientX += _this._touchCurrent[i].clientX;\n          clientY += _this._touchCurrent[i].clientY;\n        }\n\n        _this.setCenter(clientX / nFingers, clientY / nFingers);\n\n        var screenNotches = 8;\n\n        _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n        var movement = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n        var size = 1;\n\n        if (movement < 0) {\n          size = 1 / Math.pow(_this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(_this.scaleFactor, movement * screenNotches);\n        }\n\n        _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n        var x = _this._v3_1.distanceTo(_this._gizmos.position);\n\n        var xNew = x / size;\n        xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n        var y = x * Math.tan(MathUtils.DEG2RAD * _this._fovState * 0.5);\n        var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n        newFov = MathUtils.clamp(newFov, _this.minFov, _this.maxFov);\n        var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n\n        _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n\n        _this.setFov(newFov);\n\n        _this.applyTransformMatrix(_this.applyScale(size, _this._v3_2, false));\n\n        var direction = _this._gizmos.position.clone().sub(_this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n        _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"onTriplePanEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.dispatchEvent(_endEvent);\n    });\n    /**\n     * Set _center's x/y coordinates\n     * @param {Number} clientX\n     * @param {Number} clientY\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"setCenter\", function (clientX, clientY) {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n    /**\n     * Set default mouse actions\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"initializeMouseActions\", function () {\n      _this.setMouseAction(\"PAN\", 0, \"CTRL\");\n\n      _this.setMouseAction(\"PAN\", 2);\n\n      _this.setMouseAction(\"ROTATE\", 0);\n\n      _this.setMouseAction(\"ZOOM\", \"WHEEL\");\n\n      _this.setMouseAction(\"ZOOM\", 1);\n\n      _this.setMouseAction(\"FOV\", \"WHEEL\", \"SHIFT\");\n\n      _this.setMouseAction(\"FOV\", 1, \"SHIFT\");\n    });\n    /**\n     * Set a new mouse action by specifying the operation to be performed and a mouse/key combination. In case of conflict, replaces the existing one\n     * @param {String} operation The operation to be performed ('PAN', 'ROTATE', 'ZOOM', 'FOV)\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns {Boolean} True if the mouse action has been successfully added, false otherwise\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"setMouseAction\", function (operation, mouse) {\n      var key = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var operationInput = [\"PAN\", \"ROTATE\", \"ZOOM\", \"FOV\"];\n      var mouseInput = [0, 1, 2, \"WHEEL\"];\n      var keyInput = [\"CTRL\", \"SHIFT\", null];\n      var state;\n\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        return false;\n      }\n\n      if (mouse == \"WHEEL\") {\n        if (operation != \"ZOOM\" && operation != \"FOV\") {\n          return false;\n        }\n      }\n\n      switch (operation) {\n        case \"PAN\":\n          state = STATE.PAN;\n          break;\n\n        case \"ROTATE\":\n          state = STATE.ROTATE;\n          break;\n\n        case \"ZOOM\":\n          state = STATE.SCALE;\n          break;\n\n        case \"FOV\":\n          state = STATE.FOV;\n          break;\n      }\n\n      var action = {\n        operation: operation,\n        mouse: mouse,\n        key: key,\n        state: state\n      };\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        if (_this.mouseActions[i].mouse == action.mouse && _this.mouseActions[i].key == action.key) {\n          _this.mouseActions.splice(i, 1, action);\n\n          return true;\n        }\n      }\n\n      _this.mouseActions.push(action);\n\n      return true;\n    });\n    /**\n     * Return the operation associated to a mouse/keyboard combination\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns The operation if it has been found, null otherwise\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"getOpFromAction\", function (mouse, key) {\n      var action;\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        action = _this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n\n      if (key) {\n        for (var _i = 0; _i < _this.mouseActions.length; _i++) {\n          action = _this.mouseActions[_i];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n\n      return null;\n    });\n    /**\n     * Get the operation associated to mouse and key combination and returns the corresponding FSA state\n     * @param {Number} mouse Mouse button\n     * @param {String} key Keyboard modifier\n     * @returns The FSA state obtained from the operation associated to mouse/keyboard combination\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"getOpStateFromAction\", function (mouse, key) {\n      var action;\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        action = _this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n\n      if (key) {\n        for (var _i2 = 0; _i2 < _this.mouseActions.length; _i2++) {\n          action = _this.mouseActions[_i2];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n\n      return null;\n    });\n    /**\n     * Calculate the angle between two pointers\n     * @param {PointerEvent} p1\n     * @param {PointerEvent} p2\n     * @returns {Number} The angle between two pointers in degrees\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"getAngle\", function (p1, p2) {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n    /**\n     * Update a PointerEvent inside current pointerevents array\n     * @param {PointerEvent} event\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"updateTouchEvent\", function (event) {\n      for (var i = 0; i < _this._touchCurrent.length; i++) {\n        if (_this._touchCurrent[i].pointerId == event.pointerId) {\n          _this._touchCurrent.splice(i, 1, event);\n\n          break;\n        }\n      }\n    });\n    /**\n     * Calculate the angular speed\n     * @param {Number} p0 Position at t0\n     * @param {Number} p1 Position at t1\n     * @param {Number} t0 Initial time in milliseconds\n     * @param {Number} t1 Ending time in milliseconds\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"calculateAngularSpeed\", function (p0, p1, t0, t1) {\n      var s = p1 - p0;\n      var t = (t1 - t0) / 1e3;\n\n      if (t == 0) {\n        return 0;\n      }\n\n      return s / t;\n    });\n    /**\n     * Calculate the distance between two pointers\n     * @param {PointerEvent} p0 The first pointer\n     * @param {PointerEvent} p1 The second pointer\n     * @returns {number} The distance between the two pointers\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"calculatePointersDistance\", function (p0, p1) {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n    /**\n     * Calculate the rotation axis as the vector perpendicular between two vectors\n     * @param {Vector3} vec1 The first vector\n     * @param {Vector3} vec2 The second vector\n     * @returns {Vector3} The normalized rotation axis\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"calculateRotationAxis\", function (vec1, vec2) {\n      _this._rotationMatrix.extractRotation(_this._cameraMatrixState);\n\n      _this._quat.setFromRotationMatrix(_this._rotationMatrix);\n\n      _this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(_this._quat);\n\n      return _this._rotationAxis.normalize().clone();\n    });\n    /**\n     * Calculate the trackball radius so that gizmo's diamater will be 2/3 of the minimum side of the camera frustum\n     * @param {Camera} camera\n     * @returns {Number} The trackball radius\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"calculateTbRadius\", function (camera) {\n      var factor = 0.67;\n      var distance = camera.position.distanceTo(_this._gizmos.position);\n\n      if (camera instanceof PerspectiveCamera) {\n        var halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5;\n        var halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV));\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera instanceof OrthographicCamera) {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n    /**\n     * Focus operation consist of positioning the point of interest in front of the camera and a slightly zoom in\n     * @param {Vector3} point The point of interest\n     * @param {Number} size Scale factor\n     * @param {Number} amount Amount of operation to be completed (used for focus animations, default is complete full operation)\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"focus\", function (point, size) {\n      var amount = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n      if (_this.camera) {\n        var focusPoint = point.clone();\n        focusPoint.sub(_this._gizmos.position).multiplyScalar(amount);\n\n        _this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n\n        var gizmoStateTemp = _this._gizmoMatrixState.clone();\n\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix);\n\n        _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n        var cameraStateTemp = _this._cameraMatrixState.clone();\n\n        _this._cameraMatrixState.premultiply(_this._translationMatrix);\n\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale);\n\n        if (_this.enableZoom) {\n          _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n        }\n\n        _this._gizmoMatrixState.copy(gizmoStateTemp);\n\n        _this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n    /**\n     * Draw a grid and add it to the scene\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"drawGrid\", function () {\n      if (_this.scene) {\n        var color = 8947848;\n        var multiplier = 3;\n        var size, divisions, maxLength, tick;\n\n        if (_this.camera instanceof OrthographicCamera) {\n          var width = _this.camera.right - _this.camera.left;\n          var height = _this.camera.bottom - _this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / _this.camera.zoom * multiplier;\n          divisions = size / tick * _this.camera.zoom;\n        } else if (_this.camera instanceof PerspectiveCamera) {\n          var distance = _this.camera.position.distanceTo(_this._gizmos.position);\n\n          var halfFovV = MathUtils.DEG2RAD * _this.camera.fov * 0.5;\n          var halfFovH = Math.atan(_this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n\n        if (_this._grid == null && _this.camera) {\n          _this._grid = new GridHelper(size, divisions, color, color);\n\n          _this._grid.position.copy(_this._gizmos.position);\n\n          _this._gridPosition.copy(_this._grid.position);\n\n          _this._grid.quaternion.copy(_this.camera.quaternion);\n\n          _this._grid.rotateX(Math.PI * 0.5);\n\n          _this.scene.add(_this._grid);\n        }\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"connect\", function (domElement) {\n      if (domElement === document) {\n        console.error('THREE.ArcballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n      }\n\n      _this.domElement = domElement;\n      _this.domElement.style.touchAction = \"none\";\n\n      _this.domElement.addEventListener(\"contextmenu\", _this.onContextMenu);\n\n      _this.domElement.addEventListener(\"pointerdown\", _this.onPointerDown);\n\n      _this.domElement.addEventListener(\"pointercancel\", _this.onPointerCancel);\n\n      _this.domElement.addEventListener(\"wheel\", _this.onWheel);\n    });\n    /**\n     * Remove all listeners, stop animations and clean scene\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"dispose\", function () {\n      var _a, _b, _c, _d, _e;\n\n      if (_this._animationId != -1) {\n        window.cancelAnimationFrame(_this._animationId);\n      }\n\n      (_a = _this.domElement) == null ? void 0 : _a.removeEventListener(\"pointerdown\", _this.onPointerDown);\n      (_b = _this.domElement) == null ? void 0 : _b.removeEventListener(\"pointercancel\", _this.onPointerCancel);\n      (_c = _this.domElement) == null ? void 0 : _c.removeEventListener(\"wheel\", _this.onWheel);\n      (_d = _this.domElement) == null ? void 0 : _d.removeEventListener(\"contextmenu\", _this.onContextMenu);\n      window.removeEventListener(\"pointermove\", _this.onPointerMove);\n      window.removeEventListener(\"pointerup\", _this.onPointerUp);\n      window.removeEventListener(\"resize\", _this.onWindowResize);\n      (_e = _this.scene) == null ? void 0 : _e.remove(_this._gizmos);\n\n      _this.disposeGrid();\n    });\n    /**\n     * remove the grid from the scene\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"disposeGrid\", function () {\n      if (_this._grid && _this.scene) {\n        _this.scene.remove(_this._grid);\n\n        _this._grid = null;\n      }\n    });\n    /**\n     * Compute the easing out cubic function for ease out effect in animation\n     * @param {Number} t The absolute progress of the animation in the bound of 0 (beginning of the) and 1 (ending of animation)\n     * @returns {Number} Result of easing out cubic at time t\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"easeOutCubic\", function (t) {\n      return 1 - Math.pow(1 - t, 3);\n    });\n    /**\n     * Make rotation gizmos more or less visible\n     * @param {Boolean} isActive If true, make gizmos more visible\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"activateGizmos\", function (isActive) {\n      var _iterator = _createForOfIteratorHelper(_this._gizmos.children),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var gizmo = _step.value;\n          ;\n          gizmo.material.setValues({\n            opacity: isActive ? 1 : 0.6\n          });\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    });\n    /**\n     * Calculate the cursor position in NDC\n     * @param {number} x Cursor horizontal coordinate within the canvas\n     * @param {number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor normalized position inside the canvas\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"getCursorNDC\", function (cursorX, cursorY, canvas) {\n      var canvasRect = canvas.getBoundingClientRect();\n\n      _this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n\n      _this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n\n      return _this._v2_1.clone();\n    });\n    /**\n     * Calculate the cursor position inside the canvas x/y coordinates with the origin being in the center of the canvas\n     * @param {Number} x Cursor horizontal coordinate within the canvas\n     * @param {Number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor position inside the canvas\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"getCursorPosition\", function (cursorX, cursorY, canvas) {\n      _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas));\n\n      if (_this.camera instanceof OrthographicCamera) {\n        _this._v2_1.x *= (_this.camera.right - _this.camera.left) * 0.5;\n        _this._v2_1.y *= (_this.camera.top - _this.camera.bottom) * 0.5;\n      }\n\n      return _this._v2_1.clone();\n    });\n    /**\n     * Set the camera to be controlled\n     * @param {Camera} camera The virtual camera to be controlled\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"setCamera\", function (camera) {\n      if (camera) {\n        camera.lookAt(_this.target);\n        camera.updateMatrix();\n\n        if (camera instanceof PerspectiveCamera) {\n          _this._fov0 = camera.fov;\n          _this._fovState = camera.fov;\n        }\n\n        _this._cameraMatrixState0.copy(camera.matrix);\n\n        _this._cameraMatrixState.copy(_this._cameraMatrixState0);\n\n        _this._cameraProjectionState.copy(camera.projectionMatrix);\n\n        _this._zoom0 = camera.zoom;\n        _this._zoomState = _this._zoom0;\n        _this._initialNear = camera.near;\n        _this._nearPos0 = camera.position.distanceTo(_this.target) - camera.near;\n        _this._nearPos = _this._initialNear;\n        _this._initialFar = camera.far;\n        _this._farPos0 = camera.position.distanceTo(_this.target) - camera.far;\n        _this._farPos = _this._initialFar;\n\n        _this._up0.copy(camera.up);\n\n        _this._upState.copy(camera.up);\n\n        _this.camera = camera;\n\n        _this.camera.updateProjectionMatrix();\n\n        var tbRadius = _this.calculateTbRadius(camera);\n\n        if (tbRadius !== void 0) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this.target, _this._tbRadius);\n      }\n    });\n    /**\n     * Creates the rotation gizmos matching trackball center and radius\n     * @param {Vector3} tbCenter The trackball center\n     * @param {number} tbRadius The trackball radius\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"makeGizmos\", function (tbCenter, tbRadius) {\n      var curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      var points = curve.getPoints(_this._curvePts);\n      var curveGeometry = new BufferGeometry().setFromPoints(points);\n      var curveMaterialX = new LineBasicMaterial({\n        color: 16744576,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      var curveMaterialY = new LineBasicMaterial({\n        color: 8454016,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      var curveMaterialZ = new LineBasicMaterial({\n        color: 8421631,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      var gizmoX = new Line(curveGeometry, curveMaterialX);\n      var gizmoY = new Line(curveGeometry, curveMaterialY);\n      var gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      var rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation;\n\n      _this._gizmoMatrixState0.identity().setPosition(tbCenter);\n\n      _this._gizmoMatrixState.copy(_this._gizmoMatrixState0);\n\n      if (_this.camera && _this.camera.zoom != 1) {\n        var size = 1 / _this.camera.zoom;\n\n        _this._scaleMatrix.makeScale(size, size, size);\n\n        _this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix).premultiply(_this._scaleMatrix);\n\n        _this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix);\n      }\n\n      _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n      _this._gizmos.clear();\n\n      _this._gizmos.add(gizmoX);\n\n      _this._gizmos.add(gizmoY);\n\n      _this._gizmos.add(gizmoZ);\n    });\n    /**\n     * Perform animation for focus operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} point Point of interest for focus operation\n     * @param {Matrix4} cameraMatrix Camera matrix\n     * @param {Matrix4} gizmoMatrix Gizmos matrix\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"onFocusAnim\", function (time, point, cameraMatrix, gizmoMatrix) {\n      if (_this._timeStart == -1) {\n        _this._timeStart = time;\n      }\n\n      if (_this._state == STATE.ANIMATION_FOCUS) {\n        var deltaTime = time - _this._timeStart;\n        var animTime = deltaTime / _this.focusAnimationTime;\n\n        _this._gizmoMatrixState.copy(gizmoMatrix);\n\n        if (animTime >= 1) {\n          _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n          _this.focus(point, _this.scaleFactor);\n\n          _this._timeStart = -1;\n\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        } else {\n          var amount = _this.easeOutCubic(animTime);\n\n          var size = 1 - amount + _this.scaleFactor * amount;\n\n          _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n          _this.focus(point, size, amount);\n\n          _this.dispatchEvent(_changeEvent);\n\n          var self = _assertThisInitialized(_this);\n\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        _this._animationId = -1;\n        _this._timeStart = -1;\n      }\n    });\n    /**\n     * Perform animation for rotation operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} rotationAxis Rotation axis\n     * @param {number} w0 Initial angular velocity\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"onRotationAnim\", function (time, rotationAxis, w0) {\n      if (_this._timeStart == -1) {\n        _this._anglePrev = 0;\n        _this._angleCurrent = 0;\n        _this._timeStart = time;\n      }\n\n      if (_this._state == STATE.ANIMATION_ROTATE) {\n        var deltaTime = (time - _this._timeStart) / 1e3;\n        var w = w0 + -_this.dampingFactor * deltaTime;\n\n        if (w > 0) {\n          _this._angleCurrent = 0.5 * -_this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n\n          _this.applyTransformMatrix(_this.rotate(rotationAxis, _this._angleCurrent));\n\n          _this.dispatchEvent(_changeEvent);\n\n          var self = _assertThisInitialized(_this);\n\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          _this._animationId = -1;\n          _this._timeStart = -1;\n\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        _this._animationId = -1;\n        _this._timeStart = -1;\n\n        if (_this._state != STATE.ROTATE) {\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n    /**\n     * Perform pan operation moving camera between two points\n     * @param {Vector3} p0 Initial point\n     * @param {Vector3} p1 Ending point\n     * @param {Boolean} adjust If movement should be adjusted considering camera distance (Perspective only)\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"pan\", function (p0, p1) {\n      var adjust = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      if (_this.camera) {\n        var movement = p0.clone().sub(p1);\n\n        if (_this.camera instanceof OrthographicCamera) {\n          movement.multiplyScalar(1 / _this.camera.zoom);\n        }\n\n        if (_this.camera instanceof PerspectiveCamera && adjust) {\n          _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState0);\n\n          _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState0);\n\n          var distanceFactor = _this._v3_1.distanceTo(_this._v3_2) / _this.camera.position.distanceTo(_this._gizmos.position);\n\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n\n        _this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(_this.camera.quaternion);\n\n        _this._m4_1.makeTranslation(_this._v3_1.x, _this._v3_1.y, _this._v3_1.z);\n\n        _this.setTransformationMatrices(_this._m4_1, _this._m4_1);\n      }\n\n      return _transformation;\n    });\n    /**\n     * Reset trackball\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"reset\", function () {\n      if (_this.camera) {\n        _this.camera.zoom = _this._zoom0;\n\n        if (_this.camera instanceof PerspectiveCamera) {\n          _this.camera.fov = _this._fov0;\n        }\n\n        _this.camera.near = _this._nearPos;\n        _this.camera.far = _this._farPos;\n\n        _this._cameraMatrixState.copy(_this._cameraMatrixState0);\n\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale);\n\n        _this.camera.up.copy(_this._up0);\n\n        _this.camera.updateMatrix();\n\n        _this.camera.updateProjectionMatrix();\n\n        _this._gizmoMatrixState.copy(_this._gizmoMatrixState0);\n\n        _this._gizmoMatrixState0.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n        _this._gizmos.updateMatrix();\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== void 0) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this._gizmos.position, _this._tbRadius);\n\n        _this.camera.lookAt(_this._gizmos.position);\n\n        _this.updateTbState(STATE.IDLE, false);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n    /**\n     * Rotate the camera around an axis passing by trackball's center\n     * @param {Vector3} axis Rotation axis\n     * @param {number} angle Angle in radians\n     * @returns {Object} Object with 'camera' field containing transformation matrix resulting from the operation to be applied to the camera\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"rotate\", function (axis, angle) {\n      var point = _this._gizmos.position;\n\n      _this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      _this._rotationMatrix.makeRotationAxis(axis, -angle);\n\n      _this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      _this._m4_1.multiply(_this._rotationMatrix);\n\n      _this._m4_1.multiply(_this._translationMatrix);\n\n      _this.setTransformationMatrices(_this._m4_1);\n\n      return _transformation;\n    });\n\n    __publicField(_assertThisInitialized(_this), \"copyState\", function () {\n      if (_this.camera) {\n        var state = JSON.stringify(_this.camera instanceof OrthographicCamera ? {\n          arcballState: {\n            cameraFar: _this.camera.far,\n            cameraMatrix: _this.camera.matrix,\n            cameraNear: _this.camera.near,\n            cameraUp: _this.camera.up,\n            cameraZoom: _this.camera.zoom,\n            gizmoMatrix: _this._gizmos.matrix\n          }\n        } : {\n          arcballState: {\n            cameraFar: _this.camera.far,\n            cameraFov: _this.camera.fov,\n            cameraMatrix: _this.camera.matrix,\n            cameraNear: _this.camera.near,\n            cameraUp: _this.camera.up,\n            cameraZoom: _this.camera.zoom,\n            gizmoMatrix: _this._gizmos.matrix\n          }\n        });\n        navigator.clipboard.writeText(state);\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"pasteState\", function () {\n      var self = _assertThisInitialized(_this);\n\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n    /**\n     * Save the current state of the control. This can later be recovered with .reset\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"saveState\", function () {\n      if (!_this.camera) return;\n\n      _this._cameraMatrixState0.copy(_this.camera.matrix);\n\n      _this._gizmoMatrixState0.copy(_this._gizmos.matrix);\n\n      _this._nearPos = _this.camera.near;\n      _this._farPos = _this.camera.far;\n      _this._zoom0 = _this.camera.zoom;\n\n      _this._up0.copy(_this.camera.up);\n\n      if (_this.camera instanceof PerspectiveCamera) {\n        _this._fov0 = _this.camera.fov;\n      }\n    });\n    /**\n     * Perform uniform scale operation around a given point\n     * @param {Number} size Scale factor\n     * @param {Vector3} point Point around which scale\n     * @param {Boolean} scaleGizmos If gizmos should be scaled (Perspective only)\n     * @returns {Object} Object with 'camera' and 'gizmo' fields containing transformation matrices resulting from the operation to be applied to the camera and gizmos\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"applyScale\", function (size, point) {\n      var scaleGizmos = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      if (!_this.camera) return;\n      var scalePoint = point.clone();\n      var sizeInverse = 1 / size;\n\n      if (_this.camera instanceof OrthographicCamera) {\n        _this.camera.zoom = _this._zoomState;\n        _this.camera.zoom *= size;\n\n        if (_this.camera.zoom > _this.maxZoom) {\n          _this.camera.zoom = _this.maxZoom;\n          sizeInverse = _this._zoomState / _this.maxZoom;\n        } else if (_this.camera.zoom < _this.minZoom) {\n          _this.camera.zoom = _this.minZoom;\n          sizeInverse = _this._zoomState / _this.minZoom;\n        }\n\n        _this.camera.updateProjectionMatrix();\n\n        _this._v3_1.setFromMatrixPosition(_this._gizmoMatrixState);\n\n        _this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n        _this._translationMatrix.makeTranslation(-_this._v3_1.x, -_this._v3_1.y, -_this._v3_1.z);\n\n        _this._m4_2.makeTranslation(_this._v3_1.x, _this._v3_1.y, _this._v3_1.z).multiply(_this._scaleMatrix);\n\n        _this._m4_2.multiply(_this._translationMatrix);\n\n        scalePoint.sub(_this._v3_1);\n        var amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n\n        _this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n\n        _this._m4_2.premultiply(_this._m4_1);\n\n        _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n\n        return _transformation;\n      }\n\n      if (_this.camera instanceof PerspectiveCamera) {\n        _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n        _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n\n        var distance = _this._v3_1.distanceTo(scalePoint);\n\n        var _amount = distance - distance * sizeInverse;\n\n        var newDistance = distance - _amount;\n\n        if (newDistance < _this.minDistance) {\n          sizeInverse = _this.minDistance / distance;\n          _amount = distance - distance * sizeInverse;\n        } else if (newDistance > _this.maxDistance) {\n          sizeInverse = _this.maxDistance / distance;\n          _amount = distance - distance * sizeInverse;\n        }\n\n        var direction = scalePoint.clone().sub(_this._v3_1).normalize().multiplyScalar(_amount);\n\n        _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        if (scaleGizmos) {\n          var pos = _this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          _amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(_this._v3_2).normalize().multiplyScalar(_amount);\n\n          _this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n\n          _this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n          _this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(_this._translationMatrix);\n\n          _this._m4_2.multiply(_this._scaleMatrix);\n\n          _this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n\n          _this._m4_2.multiply(_this._translationMatrix);\n\n          _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n        } else {\n          _this.setTransformationMatrices(_this._m4_1);\n        }\n\n        return _transformation;\n      }\n    });\n    /**\n     * Set camera fov\n     * @param {Number} value fov to be setted\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"setFov\", function (value) {\n      if (_this.camera instanceof PerspectiveCamera) {\n        _this.camera.fov = MathUtils.clamp(value, _this.minFov, _this.maxFov);\n\n        _this.camera.updateProjectionMatrix();\n      }\n    });\n    /**\n     * Set the trackball's center point\n     * @param {Number} x X coordinate\n     * @param {Number} y Y coordinate\n     * @param {Number} z Z coordinate\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"setTarget\", function (x, y, z) {\n      if (_this.camera) {\n        _this.target.set(x, y, z);\n\n        _this._gizmos.position.set(x, y, z);\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== void 0) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this.target, _this._tbRadius);\n\n        _this.camera.lookAt(_this.target);\n      }\n    });\n    /**\n     * Rotate camera around its direction axis passing by a given point by a given angle\n     * @param {Vector3} point The point where the rotation axis is passing trough\n     * @param {Number} angle Angle in radians\n     * @returns The computed transormation matix\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"zRotate\", function (point, angle) {\n      _this._rotationMatrix.makeRotationAxis(_this._rotationAxis, angle);\n\n      _this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      _this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      _this._m4_1.multiply(_this._rotationMatrix);\n\n      _this._m4_1.multiply(_this._translationMatrix);\n\n      _this._v3_1.setFromMatrixPosition(_this._gizmoMatrixState).sub(point);\n\n      _this._v3_2.copy(_this._v3_1).applyAxisAngle(_this._rotationAxis, angle);\n\n      _this._v3_2.sub(_this._v3_1);\n\n      _this._m4_2.makeTranslation(_this._v3_2.x, _this._v3_2.y, _this._v3_2.z);\n\n      _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n\n      return _transformation;\n    });\n    /**\n     * Unproject the cursor on the 3D object surface\n     * @param {Vector2} cursor Cursor coordinates in NDC\n     * @param {Camera} camera Virtual camera\n     * @returns {Vector3} The point of intersection with the model, if exist, null otherwise\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"unprojectOnObj\", function (cursor, camera) {\n      if (!_this.scene) return null;\n      var raycaster = new Raycaster();\n      raycaster.near = camera.near;\n      raycaster.far = camera.far;\n      raycaster.setFromCamera(cursor, camera);\n      var intersect = raycaster.intersectObjects(_this.scene.children, true);\n\n      for (var i = 0; i < intersect.length; i++) {\n        if (intersect[i].object.uuid != _this._gizmos.uuid && intersect[i].face) {\n          return intersect[i].point.clone();\n        }\n      }\n\n      return null;\n    });\n    /**\n     * Unproject the cursor on the trackball surface\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {number} tbRadius The trackball radius\n     * @returns {Vector3} The unprojected point on the trackball surface\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"unprojectOnTbSurface\", function (camera, cursorX, cursorY, canvas, tbRadius) {\n      if (camera instanceof OrthographicCamera) {\n        _this._v2_1.copy(_this.getCursorPosition(cursorX, cursorY, canvas));\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, 0);\n\n        var x2 = Math.pow(_this._v2_1.x, 2);\n        var y2 = Math.pow(_this._v2_1.y, 2);\n        var r2 = Math.pow(_this._tbRadius, 2);\n\n        if (x2 + y2 <= r2 * 0.5) {\n          _this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          _this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n\n        return _this._v3_1;\n      }\n\n      if (camera instanceof PerspectiveCamera) {\n        _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas));\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, -1);\n\n        _this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        var rayDir = _this._v3_1.clone().normalize();\n\n        var cameraGizmoDistance = camera.position.distanceTo(_this._gizmos.position);\n        var radius2 = Math.pow(tbRadius, 2);\n        var h = _this._v3_1.z;\n        var l = Math.sqrt(Math.pow(_this._v3_1.x, 2) + Math.pow(_this._v3_1.y, 2));\n\n        if (l == 0) {\n          rayDir.set(_this._v3_1.x, _this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n\n        var m = h / l;\n        var q = cameraGizmoDistance;\n        var a = Math.pow(m, 2) + 1;\n        var b = 2 * m * q;\n        var c = Math.pow(q, 2) - radius2;\n        var delta = Math.pow(b, 2) - 4 * a * c;\n\n        if (delta >= 0) {\n          _this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n          _this._v2_1.setY(m * _this._v2_1.x + q);\n\n          var angle = MathUtils.RAD2DEG * _this._v2_1.angle();\n\n          if (angle >= 45) {\n            var rayLength2 = Math.sqrt(Math.pow(_this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - _this._v2_1.y, 2));\n            rayDir.multiplyScalar(rayLength2);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        }\n\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n\n        _this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n        _this._v2_1.setY(m * _this._v2_1.x + q);\n\n        var rayLength = Math.sqrt(Math.pow(_this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - _this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n    /**\n     * Unproject the cursor on the plane passing through the center of the trackball orthogonal to the camera\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {Boolean} initialDistance If initial distance between camera and gizmos should be used for calculations instead of current (Perspective only)\n     * @returns {Vector3} The unprojected point on the trackball plane\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"unprojectOnTbPlane\", function (camera, cursorX, cursorY, canvas) {\n      var initialDistance = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n      if (camera instanceof OrthographicCamera) {\n        _this._v2_1.copy(_this.getCursorPosition(cursorX, cursorY, canvas));\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, 0);\n\n        return _this._v3_1.clone();\n      }\n\n      if (camera instanceof PerspectiveCamera) {\n        _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas));\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, -1);\n\n        _this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        var rayDir = _this._v3_1.clone().normalize();\n\n        var h = _this._v3_1.z;\n        var l = Math.sqrt(Math.pow(_this._v3_1.x, 2) + Math.pow(_this._v3_1.y, 2));\n        var cameraGizmoDistance;\n\n        if (initialDistance) {\n          cameraGizmoDistance = _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState0).distanceTo(_this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(_this._gizmos.position);\n        }\n\n        if (l == 0) {\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n\n        var m = h / l;\n        var q = cameraGizmoDistance;\n        var x = -q / m;\n        var rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n    /**\n     * Update camera and gizmos state\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"updateMatrixState\", function () {\n      if (!_this.camera) return;\n\n      _this._cameraMatrixState.copy(_this.camera.matrix);\n\n      _this._gizmoMatrixState.copy(_this._gizmos.matrix);\n\n      if (_this.camera instanceof OrthographicCamera) {\n        _this._cameraProjectionState.copy(_this.camera.projectionMatrix);\n\n        _this.camera.updateProjectionMatrix();\n\n        _this._zoomState = _this.camera.zoom;\n      }\n\n      if (_this.camera instanceof PerspectiveCamera) {\n        _this._fovState = _this.camera.fov;\n      }\n    });\n    /**\n     * Update the trackball FSA\n     * @param {STATE} newState New state of the FSA\n     * @param {Boolean} updateMatrices If matriices state should be updated\n     */\n\n\n    __publicField(_assertThisInitialized(_this), \"updateTbState\", function (newState, updateMatrices) {\n      _this._state = newState;\n\n      if (updateMatrices) {\n        _this.updateMatrixState();\n      }\n    });\n\n    __publicField(_assertThisInitialized(_this), \"update\", function () {\n      var EPS = 1e-6;\n\n      if (!_this.target.equals(_this._currentTarget) && _this.camera) {\n        _this._gizmos.position.set(_this.target.x, _this.target.y, _this.target.z);\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== void 0) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this.target, _this._tbRadius);\n\n        _this._currentTarget.copy(_this.target);\n      }\n\n      if (!_this.camera) return;\n\n      if (_this.camera instanceof OrthographicCamera) {\n        if (_this.camera.zoom > _this.maxZoom || _this.camera.zoom < _this.minZoom) {\n          var newZoom = MathUtils.clamp(_this.camera.zoom, _this.minZoom, _this.maxZoom);\n\n          _this.applyTransformMatrix(_this.applyScale(newZoom / _this.camera.zoom, _this._gizmos.position, true));\n        }\n      }\n\n      if (_this.camera instanceof PerspectiveCamera) {\n        var distance = _this.camera.position.distanceTo(_this._gizmos.position);\n\n        if (distance > _this.maxDistance + EPS || distance < _this.minDistance - EPS) {\n          var newDistance = MathUtils.clamp(distance, _this.minDistance, _this.maxDistance);\n\n          _this.applyTransformMatrix(_this.applyScale(newDistance / distance, _this._gizmos.position));\n\n          _this.updateMatrixState();\n        }\n\n        if (_this.camera.fov < _this.minFov || _this.camera.fov > _this.maxFov) {\n          _this.camera.fov = MathUtils.clamp(_this.camera.fov, _this.minFov, _this.maxFov);\n\n          _this.camera.updateProjectionMatrix();\n        }\n\n        var oldRadius = _this._tbRadius;\n\n        var _tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (_tbRadius !== void 0) {\n          _this._tbRadius = _tbRadius;\n        }\n\n        if (oldRadius < _this._tbRadius - EPS || oldRadius > _this._tbRadius + EPS) {\n          var scale = (_this._gizmos.scale.x + _this._gizmos.scale.y + _this._gizmos.scale.z) / 3;\n          var newRadius = _this._tbRadius / scale;\n          var curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          var points = curve.getPoints(_this._curvePts);\n          var curveGeometry = new BufferGeometry().setFromPoints(points);\n\n          for (var gizmo in _this._gizmos.children) {\n            var child = _this._gizmos.children[gizmo];\n            child.geometry = curveGeometry;\n          }\n        }\n      }\n\n      _this.camera.lookAt(_this._gizmos.position);\n    });\n\n    __publicField(_assertThisInitialized(_this), \"setStateFromJSON\", function (json) {\n      var state = JSON.parse(json);\n\n      if (state.arcballState && _this.camera) {\n        _this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale);\n\n        _this.camera.up.copy(state.arcballState.cameraUp);\n\n        _this.camera.near = state.arcballState.cameraNear;\n        _this.camera.far = state.arcballState.cameraFar;\n        _this.camera.zoom = state.arcballState.cameraZoom;\n\n        if (_this.camera instanceof PerspectiveCamera) {\n          _this.camera.fov = state.arcballState.cameraFov;\n        }\n\n        _this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n\n        _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n        _this.camera.updateMatrix();\n\n        _this.camera.updateProjectionMatrix();\n\n        _this._gizmos.updateMatrix();\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== void 0) {\n          _this._tbRadius = tbRadius;\n        }\n\n        var gizmoTmp = new Matrix4().copy(_this._gizmoMatrixState0);\n\n        _this.makeGizmos(_this._gizmos.position, _this._tbRadius);\n\n        _this._gizmoMatrixState0.copy(gizmoTmp);\n\n        _this.camera.lookAt(_this._gizmos.position);\n\n        _this.updateTbState(STATE.IDLE, false);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _this.camera = null;\n    _this.domElement = domElement;\n    _this.scene = scene;\n    _this.mouseActions = [];\n    _this._mouseOp = null;\n    _this._v2_1 = new Vector2();\n    _this._v3_1 = new Vector3();\n    _this._v3_2 = new Vector3();\n    _this._m4_1 = new Matrix4();\n    _this._m4_2 = new Matrix4();\n    _this._quat = new Quaternion();\n    _this._translationMatrix = new Matrix4();\n    _this._rotationMatrix = new Matrix4();\n    _this._scaleMatrix = new Matrix4();\n    _this._rotationAxis = new Vector3();\n    _this._cameraMatrixState = new Matrix4();\n    _this._cameraProjectionState = new Matrix4();\n    _this._fovState = 1;\n    _this._upState = new Vector3();\n    _this._zoomState = 1;\n    _this._nearPos = 0;\n    _this._farPos = 0;\n    _this._gizmoMatrixState = new Matrix4();\n    _this._up0 = new Vector3();\n    _this._zoom0 = 1;\n    _this._fov0 = 0;\n    _this._initialNear = 0;\n    _this._nearPos0 = 0;\n    _this._initialFar = 0;\n    _this._farPos0 = 0;\n    _this._cameraMatrixState0 = new Matrix4();\n    _this._gizmoMatrixState0 = new Matrix4();\n    _this._button = -1;\n    _this._touchStart = [];\n    _this._touchCurrent = [];\n    _this._input = INPUT.NONE;\n    _this._switchSensibility = 32;\n    _this._startFingerDistance = 0;\n    _this._currentFingerDistance = 0;\n    _this._startFingerRotation = 0;\n    _this._currentFingerRotation = 0;\n    _this._devPxRatio = 0;\n    _this._downValid = true;\n    _this._nclicks = 0;\n    _this._downEvents = [];\n    _this._clickStart = 0;\n    _this._maxDownTime = 250;\n    _this._maxInterval = 300;\n    _this._posThreshold = 24;\n    _this._movementThreshold = 24;\n    _this._currentCursorPosition = new Vector3();\n    _this._startCursorPosition = new Vector3();\n    _this._grid = null;\n    _this._gridPosition = new Vector3();\n    _this._gizmos = new Group();\n    _this._curvePts = 128;\n    _this._timeStart = -1;\n    _this._animationId = -1;\n    _this.focusAnimationTime = 500;\n    _this._timePrev = 0;\n    _this._timeCurrent = 0;\n    _this._anglePrev = 0;\n    _this._angleCurrent = 0;\n    _this._cursorPosPrev = new Vector3();\n    _this._cursorPosCurr = new Vector3();\n    _this._wPrev = 0;\n    _this._wCurr = 0;\n    _this.adjustNearFar = false;\n    _this.scaleFactor = 1.1;\n    _this.dampingFactor = 25;\n    _this.wMax = 20;\n    _this.enableAnimations = true;\n    _this.enableGrid = false;\n    _this.cursorZoom = false;\n    _this.minFov = 5;\n    _this.maxFov = 90;\n    _this.enabled = true;\n    _this.enablePan = true;\n    _this.enableRotate = true;\n    _this.enableZoom = true;\n    _this.minDistance = 0;\n    _this.maxDistance = Infinity;\n    _this.minZoom = 0;\n    _this.maxZoom = Infinity;\n    _this.target = new Vector3(0, 0, 0);\n    _this._currentTarget = new Vector3(0, 0, 0);\n    _this._tbRadius = 1;\n    _this._state = STATE.IDLE;\n\n    _this.setCamera(camera);\n\n    if (_this.scene) {\n      _this.scene.add(_this._gizmos);\n    }\n\n    _this._devPxRatio = window.devicePixelRatio;\n\n    _this.initializeMouseActions();\n\n    if (_this.domElement) _this.connect(_this.domElement);\n    window.addEventListener(\"resize\", _this.onWindowResize);\n    return _this;\n  }\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n\n\n  _createClass(ArcballControls, [{\n    key: \"applyTransformMatrix\",\n    value: function applyTransformMatrix(transformation) {\n      if ((transformation == null ? void 0 : transformation.camera) && this.camera) {\n        this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n\n        this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n        this.camera.updateMatrix();\n\n        if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n          this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n        }\n      }\n\n      if (transformation == null ? void 0 : transformation.gizmos) {\n        this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n\n        this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        this._gizmos.updateMatrix();\n      }\n\n      if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && this.camera) {\n        var tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n\n        if (this.adjustNearFar) {\n          var cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n          var bb = new Box3();\n          bb.setFromObject(this._gizmos);\n          var sphere = new Sphere();\n          bb.getBoundingSphere(sphere);\n          var adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n          var regularNearPosition = cameraDistance - this._initialNear;\n          var minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n          this.camera.near = cameraDistance - minNearPos;\n          var adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n          var regularFarPosition = cameraDistance - this._initialFar;\n          var minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n          this.camera.far = cameraDistance - minFarPos;\n          this.camera.updateProjectionMatrix();\n        } else {\n          var update = false;\n\n          if (this.camera.near != this._initialNear) {\n            this.camera.near = this._initialNear;\n            update = true;\n          }\n\n          if (this.camera.far != this._initialFar) {\n            this.camera.far = this._initialFar;\n            update = true;\n          }\n\n          if (update) {\n            this.camera.updateProjectionMatrix();\n          }\n        }\n      }\n    }\n    /**\n     * Set gizmos visibility\n     * @param {Boolean} value Value of gizmos visibility\n     */\n\n  }, {\n    key: \"setGizmosVisible\",\n    value: function setGizmosVisible(value) {\n      this._gizmos.visible = value;\n      this.dispatchEvent(_changeEvent);\n    }\n    /**\n     * Set values in transformation object\n     * @param {Matrix4} camera Transformation to be applied to the camera\n     * @param {Matrix4} gizmos Transformation to be applied to gizmos\n     */\n\n  }, {\n    key: \"setTransformationMatrices\",\n    value: function setTransformationMatrices() {\n      var camera = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var gizmos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      if (camera) {\n        if (_transformation.camera) {\n          _transformation.camera.copy(camera);\n        } else {\n          _transformation.camera = camera.clone();\n        }\n      } else {\n        _transformation.camera = null;\n      }\n\n      if (gizmos) {\n        if (_transformation.gizmos) {\n          _transformation.gizmos.copy(gizmos);\n        } else {\n          _transformation.gizmos = gizmos.clone();\n        }\n      } else {\n        _transformation.gizmos = null;\n      }\n    }\n  }]);\n\n  return ArcballControls;\n}(EventDispatcher);\n\nexport { ArcballControls };","map":{"version":3,"sources":["/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/three-stdlib/controls/ArcballControls.js"],"names":["__defProp","Object","defineProperty","__defNormalProp","obj","key","value","enumerable","configurable","writable","__publicField","Matrix4","EventDispatcher","Vector2","Vector3","Quaternion","Group","EllipseCurve","BufferGeometry","PerspectiveCamera","MathUtils","OrthographicCamera","Box3","Sphere","GridHelper","LineBasicMaterial","Line","Raycaster","STATE","IDLE","Symbol","ROTATE","PAN","SCALE","FOV","FOCUS","ZROTATE","TOUCH_MULTI","ANIMATION_FOCUS","ANIMATION_ROTATE","INPUT","NONE","ONE_FINGER","ONE_FINGER_SWITCHED","TWO_FINGER","MULT_FINGER","CURSOR","_center","x","y","_transformation","camera","gizmos","_changeEvent","type","_startEvent","_endEvent","ArcballControls","domElement","scene","scale","_gizmos","z","tbRadius","calculateTbRadius","_tbRadius","newRadius","curve","points","getPoints","_curvePts","curveGeometry","setFromPoints","gizmo","children","child","geometry","dispatchEvent","event","enabled","i","mouseActions","length","mouse","preventDefault","_touchStart","splice","_touchCurrent","_input","button","isPrimary","_downValid","_downEvents","push","pointerType","onSinglePanStart","window","addEventListener","onPointerMove","onPointerUp","onRotateStart","onPinchStart","onDoublePanStart","onTriplePanStart","modifier","ctrlKey","metaKey","shiftKey","_mouseOp","getOpFromAction","_button","updateTouchEvent","onSinglePanMove","movement","calculatePointersDistance","_devPxRatio","_switchSensibility","onRotateMove","onPinchMove","onDoublePanMove","onTriplePanMove","mouseOpState","getOpStateFromAction","_movementThreshold","nTouch","pointerId","removeEventListener","onSinglePanEnd","onDoublePanEnd","onPinchEnd","onRotateEnd","onTriplePanEnd","downTime","timeStamp","_maxDownTime","_nclicks","_clickStart","performance","now","clickInterval","_maxInterval","_posThreshold","onDoubleTap","shift","_a","_b","enableZoom","mouseOp","notchDeltaY","sgn","deltaY","size","scaleFactor","updateTbState","Math","pow","cursorZoom","enablePan","scalePoint","unprojectOnTbPlane","clientX","clientY","applyQuaternion","quaternion","multiplyScalar","zoom","add","position","applyTransformMatrix","applyScale","_grid","disposeGrid","drawGrid","deltaX","_v3_1","setFromMatrixPosition","_cameraMatrixState","distanceTo","xNew","clamp","minDistance","maxDistance","tan","DEG2RAD","fov","newFov","RAD2DEG","atan","maxFov","minFov","newDistance","setFov","operation","setCenter","_animationId","cancelAnimationFrame","_timeStart","activateGizmos","rayDir","_startCursorPosition","copy","enableGrid","enableRotate","unprojectOnTbSurface","enableAnimations","_timePrev","_timeCurrent","_angleCurrent","_anglePrev","_cursorPosPrev","_cursorPosCurr","_wCurr","_wPrev","setY","getCursorNDC","_currentCursorPosition","opState","restart","_state","pan","distance","angle","angleTo","amount","max","rotate","calculateRotationAxis","calculateAngularSpeed","screenNotches","_fovState","_v3_2","_gizmoMatrixState","direction","clone","sub","normalize","_m4_1","makeTranslation","deltaTime","w","abs","self","requestAnimationFrame","t","rotationAxis","onRotationAnim","min","wMax","hitP","unprojectOnObj","onFocusAnim","focus","_startFingerRotation","getAngle","_currentFingerRotation","getWorldDirection","_rotationAxis","rotationPoint","zRotate","_startFingerDistance","_currentFingerDistance","nFingers","setMouseAction","operationInput","mouseInput","keyInput","state","includes","action","p1","p2","atan2","PI","p0","t0","t1","s","sqrt","vec1","vec2","_rotationMatrix","extractRotation","_quat","setFromRotationMatrix","crossVectors","factor","halfFovV","halfFovH","aspect","top","right","point","focusPoint","_translationMatrix","gizmoStateTemp","premultiply","decompose","cameraStateTemp","color","multiplier","divisions","maxLength","tick","width","left","height","bottom","_gridPosition","rotateX","document","console","error","style","touchAction","onContextMenu","onPointerDown","onPointerCancel","onWheel","_c","_d","_e","onWindowResize","remove","isActive","material","setValues","opacity","cursorX","cursorY","canvas","canvasRect","getBoundingClientRect","_v2_1","setX","lookAt","target","updateMatrix","_fov0","_cameraMatrixState0","matrix","_cameraProjectionState","projectionMatrix","_zoom0","_zoomState","_initialNear","near","_nearPos0","_nearPos","_initialFar","far","_farPos0","_farPos","_up0","up","_upState","updateProjectionMatrix","makeGizmos","tbCenter","curveMaterialX","fog","transparent","curveMaterialY","curveMaterialZ","gizmoX","gizmoY","gizmoZ","rotation","_gizmoMatrixState0","identity","setPosition","_scaleMatrix","makeScale","clear","time","cameraMatrix","gizmoMatrix","animTime","focusAnimationTime","easeOutCubic","w0","dampingFactor","adjust","distanceFactor","set","setTransformationMatrices","axis","makeRotationAxis","multiply","JSON","stringify","arcballState","cameraFar","cameraNear","cameraUp","cameraZoom","cameraFov","navigator","clipboard","writeText","readText","then","resolved","setStateFromJSON","scaleGizmos","sizeInverse","maxZoom","minZoom","_m4_2","pos","applyAxisAngle","cursor","raycaster","setFromCamera","intersect","intersectObjects","object","uuid","face","getCursorPosition","x2","y2","r2","setZ","applyMatrix4","projectionMatrixInverse","cameraGizmoDistance","radius2","h","l","m","q","a","b","c","delta","rayLength2","rayLength","initialDistance","newState","updateMatrices","updateMatrixState","EPS","equals","_currentTarget","newZoom","oldRadius","json","parse","fromArray","elements","gizmoTmp","adjustNearFar","Infinity","setCamera","devicePixelRatio","initializeMouseActions","connect","transformation","cameraDistance","bb","setFromObject","sphere","getBoundingSphere","adjustedNearPosition","radius","center","regularNearPosition","minNearPos","adjustedFarPosition","regularFarPosition","minFarPos","update","visible"],"mappings":"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","sourcesContent":["var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nimport { Matrix4, EventDispatcher, Vector2, Vector3, Quaternion, Group, EllipseCurve, BufferGeometry, PerspectiveCamera, MathUtils, OrthographicCamera, Box3, Sphere, GridHelper, LineBasicMaterial, Line, Raycaster } from \"three\";\nconst STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nconst INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n};\nconst _center = {\n  x: 0,\n  y: 0\n};\nconst _transformation = {\n  camera: /* @__PURE__ */ new Matrix4(),\n  gizmos: /* @__PURE__ */ new Matrix4()\n};\nconst _changeEvent = { type: \"change\" };\nconst _startEvent = { type: \"start\" };\nconst _endEvent = { type: \"end\" };\nclass ArcballControls extends EventDispatcher {\n  constructor(camera, domElement = null, scene = null) {\n    super();\n    __publicField(this, \"camera\");\n    __publicField(this, \"domElement\");\n    __publicField(this, \"scene\");\n    __publicField(this, \"mouseActions\");\n    __publicField(this, \"_mouseOp\");\n    __publicField(this, \"_v2_1\");\n    __publicField(this, \"_v3_1\");\n    __publicField(this, \"_v3_2\");\n    __publicField(this, \"_m4_1\");\n    __publicField(this, \"_m4_2\");\n    __publicField(this, \"_quat\");\n    __publicField(this, \"_translationMatrix\");\n    __publicField(this, \"_rotationMatrix\");\n    __publicField(this, \"_scaleMatrix\");\n    __publicField(this, \"_rotationAxis\");\n    __publicField(this, \"_cameraMatrixState\");\n    __publicField(this, \"_cameraProjectionState\");\n    __publicField(this, \"_fovState\");\n    __publicField(this, \"_upState\");\n    __publicField(this, \"_zoomState\");\n    __publicField(this, \"_nearPos\");\n    __publicField(this, \"_farPos\");\n    __publicField(this, \"_gizmoMatrixState\");\n    __publicField(this, \"_up0\");\n    __publicField(this, \"_zoom0\");\n    __publicField(this, \"_fov0\");\n    __publicField(this, \"_initialNear\");\n    __publicField(this, \"_nearPos0\");\n    __publicField(this, \"_initialFar\");\n    __publicField(this, \"_farPos0\");\n    __publicField(this, \"_cameraMatrixState0\");\n    __publicField(this, \"_gizmoMatrixState0\");\n    __publicField(this, \"_button\");\n    __publicField(this, \"_touchStart\");\n    __publicField(this, \"_touchCurrent\");\n    __publicField(this, \"_input\");\n    __publicField(this, \"_switchSensibility\");\n    __publicField(this, \"_startFingerDistance\");\n    __publicField(this, \"_currentFingerDistance\");\n    __publicField(this, \"_startFingerRotation\");\n    __publicField(this, \"_currentFingerRotation\");\n    __publicField(this, \"_devPxRatio\");\n    __publicField(this, \"_downValid\");\n    __publicField(this, \"_nclicks\");\n    __publicField(this, \"_downEvents\");\n    __publicField(this, \"_clickStart\");\n    __publicField(this, \"_maxDownTime\");\n    __publicField(this, \"_maxInterval\");\n    __publicField(this, \"_posThreshold\");\n    __publicField(this, \"_movementThreshold\");\n    __publicField(this, \"_currentCursorPosition\");\n    __publicField(this, \"_startCursorPosition\");\n    __publicField(this, \"_grid\");\n    __publicField(this, \"_gridPosition\");\n    __publicField(this, \"_gizmos\");\n    __publicField(this, \"_curvePts\");\n    __publicField(this, \"_timeStart\");\n    __publicField(this, \"_animationId\");\n    __publicField(this, \"focusAnimationTime\");\n    __publicField(this, \"_timePrev\");\n    __publicField(this, \"_timeCurrent\");\n    __publicField(this, \"_anglePrev\");\n    __publicField(this, \"_angleCurrent\");\n    __publicField(this, \"_cursorPosPrev\");\n    __publicField(this, \"_cursorPosCurr\");\n    __publicField(this, \"_wPrev\");\n    __publicField(this, \"_wCurr\");\n    __publicField(this, \"adjustNearFar\");\n    __publicField(this, \"scaleFactor\");\n    __publicField(this, \"dampingFactor\");\n    __publicField(this, \"wMax\");\n    __publicField(this, \"enableAnimations\");\n    __publicField(this, \"enableGrid\");\n    __publicField(this, \"cursorZoom\");\n    __publicField(this, \"minFov\");\n    __publicField(this, \"maxFov\");\n    __publicField(this, \"enabled\");\n    __publicField(this, \"enablePan\");\n    __publicField(this, \"enableRotate\");\n    __publicField(this, \"enableZoom\");\n    __publicField(this, \"minDistance\");\n    __publicField(this, \"maxDistance\");\n    __publicField(this, \"minZoom\");\n    __publicField(this, \"maxZoom\");\n    __publicField(this, \"target\");\n    __publicField(this, \"_currentTarget\");\n    __publicField(this, \"_tbRadius\");\n    __publicField(this, \"_state\");\n    //listeners\n    __publicField(this, \"onWindowResize\", () => {\n      const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n      if (this.camera) {\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n      }\n      const newRadius = this._tbRadius / scale;\n      const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n      for (const gizmo in this._gizmos.children) {\n        const child = this._gizmos.children[gizmo];\n        child.geometry = curveGeometry;\n      }\n      this.dispatchEvent(_changeEvent);\n    });\n    __publicField(this, \"onContextMenu\", (event) => {\n      if (!this.enabled) {\n        return;\n      }\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == 2) {\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n    __publicField(this, \"onPointerCancel\", () => {\n      this._touchStart.splice(0, this._touchStart.length);\n      this._touchCurrent.splice(0, this._touchCurrent.length);\n      this._input = INPUT.NONE;\n    });\n    __publicField(this, \"onPointerDown\", (event) => {\n      if (event.button == 0 && event.isPrimary) {\n        this._downValid = true;\n        this._downEvents.push(event);\n      } else {\n        this._downValid = false;\n      }\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        this._touchStart.push(event);\n        this._touchCurrent.push(event);\n        switch (this._input) {\n          case INPUT.NONE:\n            this._input = INPUT.ONE_FINGER;\n            this.onSinglePanStart(event, \"ROTATE\");\n            window.addEventListener(\"pointermove\", this.onPointerMove);\n            window.addEventListener(\"pointerup\", this.onPointerUp);\n            break;\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            this._input = INPUT.TWO_FINGER;\n            this.onRotateStart();\n            this.onPinchStart();\n            this.onDoublePanStart();\n            break;\n          case INPUT.TWO_FINGER:\n            this._input = INPUT.MULT_FINGER;\n            this.onTriplePanStart();\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.NONE) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        this._mouseOp = this.getOpFromAction(event.button, modifier);\n        if (this._mouseOp) {\n          window.addEventListener(\"pointermove\", this.onPointerMove);\n          window.addEventListener(\"pointerup\", this.onPointerUp);\n          this._input = INPUT.CURSOR;\n          this._button = event.button;\n          this.onSinglePanStart(event, this._mouseOp);\n        }\n      }\n    });\n    __publicField(this, \"onPointerMove\", (event) => {\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n            this.updateTouchEvent(event);\n            this.onSinglePanMove(event, STATE.ROTATE);\n            break;\n          case INPUT.ONE_FINGER_SWITCHED:\n            const movement = this.calculatePointersDistance(this._touchCurrent[0], event) * this._devPxRatio;\n            if (movement >= this._switchSensibility) {\n              this._input = INPUT.ONE_FINGER;\n              this.updateTouchEvent(event);\n              this.onSinglePanStart(event, \"ROTATE\");\n              break;\n            }\n            break;\n          case INPUT.TWO_FINGER:\n            this.updateTouchEvent(event);\n            this.onRotateMove();\n            this.onPinchMove();\n            this.onDoublePanMove();\n            break;\n          case INPUT.MULT_FINGER:\n            this.updateTouchEvent(event);\n            this.onTriplePanMove();\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.CURSOR) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        const mouseOpState = this.getOpStateFromAction(this._button, modifier);\n        if (mouseOpState) {\n          this.onSinglePanMove(event, mouseOpState);\n        }\n      }\n      if (this._downValid) {\n        const movement = this.calculatePointersDistance(this._downEvents[this._downEvents.length - 1], event) * this._devPxRatio;\n        if (movement > this._movementThreshold) {\n          this._downValid = false;\n        }\n      }\n    });\n    __publicField(this, \"onPointerUp\", (event) => {\n      if (event.pointerType == \"touch\" && this._input != INPUT.CURSOR) {\n        const nTouch = this._touchCurrent.length;\n        for (let i = 0; i < nTouch; i++) {\n          if (this._touchCurrent[i].pointerId == event.pointerId) {\n            this._touchCurrent.splice(i, 1);\n            this._touchStart.splice(i, 1);\n            break;\n          }\n        }\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            window.removeEventListener(\"pointermove\", this.onPointerMove);\n            window.removeEventListener(\"pointerup\", this.onPointerUp);\n            this._input = INPUT.NONE;\n            this.onSinglePanEnd();\n            break;\n          case INPUT.TWO_FINGER:\n            this.onDoublePanEnd();\n            this.onPinchEnd();\n            this.onRotateEnd();\n            this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n          case INPUT.MULT_FINGER:\n            if (this._touchCurrent.length == 0) {\n              window.removeEventListener(\"pointermove\", this.onPointerMove);\n              window.removeEventListener(\"pointerup\", this.onPointerUp);\n              this._input = INPUT.NONE;\n              this.onTriplePanEnd();\n            }\n            break;\n        }\n      } else if (event.pointerType != \"touch\" && this._input == INPUT.CURSOR) {\n        window.removeEventListener(\"pointermove\", this.onPointerMove);\n        window.removeEventListener(\"pointerup\", this.onPointerUp);\n        this._input = INPUT.NONE;\n        this.onSinglePanEnd();\n        this._button = -1;\n      }\n      if (event.isPrimary) {\n        if (this._downValid) {\n          const downTime = event.timeStamp - this._downEvents[this._downEvents.length - 1].timeStamp;\n          if (downTime <= this._maxDownTime) {\n            if (this._nclicks == 0) {\n              this._nclicks = 1;\n              this._clickStart = performance.now();\n            } else {\n              const clickInterval = event.timeStamp - this._clickStart;\n              const movement = this.calculatePointersDistance(this._downEvents[1], this._downEvents[0]) * this._devPxRatio;\n              if (clickInterval <= this._maxInterval && movement <= this._posThreshold) {\n                this._nclicks = 0;\n                this._downEvents.splice(0, this._downEvents.length);\n                this.onDoubleTap(event);\n              } else {\n                this._nclicks = 1;\n                this._downEvents.shift();\n                this._clickStart = performance.now();\n              }\n            }\n          } else {\n            this._downValid = false;\n            this._nclicks = 0;\n            this._downEvents.splice(0, this._downEvents.length);\n          }\n        } else {\n          this._nclicks = 0;\n          this._downEvents.splice(0, this._downEvents.length);\n        }\n      }\n    });\n    __publicField(this, \"onWheel\", (event) => {\n      var _a, _b;\n      if (this.enabled && this.enableZoom && this.domElement) {\n        let modifier = null;\n        if (event.ctrlKey || event.metaKey) {\n          modifier = \"CTRL\";\n        } else if (event.shiftKey) {\n          modifier = \"SHIFT\";\n        }\n        const mouseOp = this.getOpFromAction(\"WHEEL\", modifier);\n        if (mouseOp) {\n          event.preventDefault();\n          this.dispatchEvent(_startEvent);\n          const notchDeltaY = 125;\n          let sgn = event.deltaY / notchDeltaY;\n          let size = 1;\n          if (sgn > 0) {\n            size = 1 / this.scaleFactor;\n          } else if (sgn < 0) {\n            size = this.scaleFactor;\n          }\n          switch (mouseOp) {\n            case \"ZOOM\":\n              this.updateTbState(STATE.SCALE, true);\n              if (sgn > 0) {\n                size = 1 / Math.pow(this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(this.scaleFactor, -sgn);\n              }\n              if (this.cursorZoom && this.enablePan) {\n                let scalePoint;\n                if (this.camera instanceof OrthographicCamera) {\n                  scalePoint = (_a = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n                }\n                if (this.camera instanceof PerspectiveCamera) {\n                  scalePoint = (_b = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) == null ? void 0 : _b.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n                }\n                if (scalePoint !== void 0)\n                  this.applyTransformMatrix(this.applyScale(size, scalePoint));\n              } else {\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n            case \"FOV\":\n              if (this.camera instanceof PerspectiveCamera) {\n                this.updateTbState(STATE.FOV, true);\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(this.scaleFactor, -sgn);\n                  }\n                }\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n                let xNew = x / size;\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this.camera.fov * 0.5);\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n                if (newFov > this.maxFov) {\n                  newFov = this.maxFov;\n                } else if (newFov < this.minFov) {\n                  newFov = this.minFov;\n                }\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position, false));\n              }\n              if (this._grid) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n          }\n        }\n      }\n    });\n    __publicField(this, \"onSinglePanStart\", (event, operation) => {\n      if (this.enabled && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        switch (operation) {\n          case \"PAN\":\n            if (!this.enablePan)\n              return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n            if (this.camera) {\n              this.updateTbState(STATE.PAN, true);\n              const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n              if (rayDir !== void 0) {\n                this._startCursorPosition.copy(rayDir);\n              }\n              if (this.enableGrid) {\n                this.drawGrid();\n                this.dispatchEvent(_changeEvent);\n              }\n            }\n            break;\n          case \"ROTATE\":\n            if (!this.enableRotate)\n              return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n            }\n            if (this.camera) {\n              this.updateTbState(STATE.ROTATE, true);\n              const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n              if (rayDir !== void 0) {\n                this._startCursorPosition.copy(rayDir);\n              }\n              this.activateGizmos(true);\n              if (this.enableAnimations) {\n                this._timePrev = this._timeCurrent = performance.now();\n                this._angleCurrent = this._anglePrev = 0;\n                this._cursorPosPrev.copy(this._startCursorPosition);\n                this._cursorPosCurr.copy(this._cursorPosPrev);\n                this._wCurr = 0;\n                this._wPrev = this._wCurr;\n              }\n            }\n            this.dispatchEvent(_changeEvent);\n            break;\n          case \"FOV\":\n            if (!this.enableZoom)\n              return;\n            if (this.camera instanceof PerspectiveCamera) {\n              if (this._animationId != -1) {\n                cancelAnimationFrame(this._animationId);\n                this._animationId = -1;\n                this._timeStart = -1;\n                this.activateGizmos(false);\n                this.dispatchEvent(_changeEvent);\n              }\n              this.updateTbState(STATE.FOV, true);\n              this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n              this._currentCursorPosition.copy(this._startCursorPosition);\n            }\n            break;\n          case \"ZOOM\":\n            if (!this.enableZoom)\n              return;\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n            this.updateTbState(STATE.SCALE, true);\n            this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n            this._currentCursorPosition.copy(this._startCursorPosition);\n            break;\n        }\n      }\n    });\n    __publicField(this, \"onSinglePanMove\", (event, opState) => {\n      if (this.enabled && this.domElement) {\n        const restart = opState != this._state;\n        this.setCenter(event.clientX, event.clientY);\n        switch (opState) {\n          case STATE.PAN:\n            if (this.enablePan && this.camera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n                if (rayDir !== void 0) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n                if (this.enableGrid) {\n                  this.drawGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n                if (rayDir !== void 0) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n                this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition));\n              }\n            }\n            break;\n          case STATE.ROTATE:\n            if (this.enableRotate && this.camera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbSurface(\n                  this.camera,\n                  _center.x,\n                  _center.y,\n                  this.domElement,\n                  this._tbRadius\n                );\n                if (rayDir !== void 0) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(true);\n              } else {\n                const rayDir = this.unprojectOnTbSurface(\n                  this.camera,\n                  _center.x,\n                  _center.y,\n                  this.domElement,\n                  this._tbRadius\n                );\n                if (rayDir !== void 0) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n                const distance = this._startCursorPosition.distanceTo(this._currentCursorPosition);\n                const angle = this._startCursorPosition.angleTo(this._currentCursorPosition);\n                const amount = Math.max(distance / this._tbRadius, angle);\n                this.applyTransformMatrix(\n                  this.rotate(this.calculateRotationAxis(this._startCursorPosition, this._currentCursorPosition), amount)\n                );\n                if (this.enableAnimations) {\n                  this._timePrev = this._timeCurrent;\n                  this._timeCurrent = performance.now();\n                  this._anglePrev = this._angleCurrent;\n                  this._angleCurrent = amount;\n                  this._cursorPosPrev.copy(this._cursorPosCurr);\n                  this._cursorPosCurr.copy(this._currentCursorPosition);\n                  this._wPrev = this._wCurr;\n                  this._wCurr = this.calculateAngularSpeed(\n                    this._anglePrev,\n                    this._angleCurrent,\n                    this._timePrev,\n                    this._timeCurrent\n                  );\n                }\n              }\n            }\n            break;\n          case STATE.SCALE:\n            if (this.enableZoom) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                this._currentCursorPosition.copy(this._startCursorPosition);\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const screenNotches = 8;\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n            }\n            break;\n          case STATE.FOV:\n            if (this.enableZoom && this.camera instanceof PerspectiveCamera) {\n              if (restart) {\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                this._currentCursorPosition.copy(this._startCursorPosition);\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n                this.activateGizmos(false);\n              } else {\n                const screenNotches = 8;\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n                let xNew = x / size;\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5);\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n                newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._v3_2, false));\n                const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n                this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n            break;\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onSinglePanEnd\", () => {\n      if (this._state == STATE.ROTATE) {\n        if (!this.enableRotate) {\n          return;\n        }\n        if (this.enableAnimations) {\n          const deltaTime = performance.now() - this._timeCurrent;\n          if (deltaTime < 120) {\n            const w = Math.abs((this._wPrev + this._wCurr) / 2);\n            const self = this;\n            this._animationId = window.requestAnimationFrame(function(t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              const rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            this.updateTbState(STATE.IDLE, false);\n            this.activateGizmos(false);\n            this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else if (this._state == STATE.PAN || this._state == STATE.IDLE) {\n        this.updateTbState(STATE.IDLE, false);\n        if (this.enableGrid) {\n          this.disposeGrid();\n        }\n        this.activateGizmos(false);\n        this.dispatchEvent(_changeEvent);\n      }\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onDoubleTap\", (event) => {\n      if (this.enabled && this.enablePan && this.scene && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        const hitP = this.unprojectOnObj(this.getCursorNDC(_center.x, _center.y, this.domElement), this.camera);\n        if (hitP && this.enableAnimations) {\n          const self = this;\n          if (this._animationId != -1) {\n            window.cancelAnimationFrame(this._animationId);\n          }\n          this._timeStart = -1;\n          this._animationId = window.requestAnimationFrame(function(t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP && !this.enableAnimations) {\n          this.updateTbState(STATE.FOCUS, true);\n          this.focus(hitP, this.scaleFactor);\n          this.updateTbState(STATE.IDLE, false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onDoublePanStart\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.PAN, true);\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== void 0) {\n          this._startCursorPosition.copy(rayDir);\n        }\n        this._currentCursorPosition.copy(this._startCursorPosition);\n        this.activateGizmos(false);\n      }\n    });\n    __publicField(this, \"onDoublePanMove\", () => {\n      if (this.enabled && this.enablePan && this.camera && this.domElement) {\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        if (this._state != STATE.PAN) {\n          this.updateTbState(STATE.PAN, true);\n          this._startCursorPosition.copy(this._currentCursorPosition);\n        }\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== void 0)\n          this._currentCursorPosition.copy(rayDir);\n        this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition, true));\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onDoublePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onRotateStart\", () => {\n      var _a;\n      if (this.enabled && this.enableRotate) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.ZROTATE, true);\n        this._startFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        this._currentFingerRotation = this._startFingerRotation;\n        (_a = this.camera) == null ? void 0 : _a.getWorldDirection(this._rotationAxis);\n        if (!this.enablePan && !this.enableZoom) {\n          this.activateGizmos(true);\n        }\n      }\n    });\n    __publicField(this, \"onRotateMove\", () => {\n      var _a;\n      if (this.enabled && this.enableRotate && this.camera && this.domElement) {\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        let rotationPoint;\n        if (this._state != STATE.ZROTATE) {\n          this.updateTbState(STATE.ZROTATE, true);\n          this._startFingerRotation = this._currentFingerRotation;\n        }\n        this._currentFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        if (!this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(this._gizmoMatrixState);\n        } else if (this.camera) {\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n          rotationPoint = (_a = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._v3_2);\n        }\n        const amount = MathUtils.DEG2RAD * (this._startFingerRotation - this._currentFingerRotation);\n        if (rotationPoint !== void 0) {\n          this.applyTransformMatrix(this.zRotate(rotationPoint, amount));\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onRotateEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.activateGizmos(false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onPinchStart\", () => {\n      if (this.enabled && this.enableZoom) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        this._startFingerDistance = this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]);\n        this._currentFingerDistance = this._startFingerDistance;\n        this.activateGizmos(false);\n      }\n    });\n    __publicField(this, \"onPinchMove\", () => {\n      var _a, _b;\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.setCenter(\n          (this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2,\n          (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2\n        );\n        const minDistance = 12;\n        if (this._state != STATE.SCALE) {\n          this._startFingerDistance = this._currentFingerDistance;\n          this.updateTbState(STATE.SCALE, true);\n        }\n        this._currentFingerDistance = Math.max(\n          this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]),\n          minDistance * this._devPxRatio\n        );\n        const amount = this._currentFingerDistance / this._startFingerDistance;\n        let scalePoint;\n        if (!this.enablePan) {\n          scalePoint = this._gizmos.position;\n        } else {\n          if (this.camera instanceof OrthographicCamera) {\n            scalePoint = (_a = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _a.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n          } else if (this.camera instanceof PerspectiveCamera) {\n            scalePoint = (_b = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) == null ? void 0 : _b.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n          }\n        }\n        if (scalePoint !== void 0) {\n          this.applyTransformMatrix(this.applyScale(amount, scalePoint));\n        }\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onPinchEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    __publicField(this, \"onTriplePanStart\", () => {\n      if (this.enabled && this.enableZoom && this.domElement) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n        this._currentCursorPosition.copy(this._startCursorPosition);\n      }\n    });\n    __publicField(this, \"onTriplePanMove\", () => {\n      if (this.enabled && this.enableZoom && this.camera && this.domElement) {\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        const screenNotches = 8;\n        this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n        const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n        let size = 1;\n        if (movement < 0) {\n          size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(this.scaleFactor, movement * screenNotches);\n        }\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n        const x = this._v3_1.distanceTo(this._gizmos.position);\n        let xNew = x / size;\n        xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n        const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5);\n        let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2);\n        newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n        const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n        this.setFov(newFov);\n        this.applyTransformMatrix(this.applyScale(size, this._v3_2, false));\n        const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    __publicField(this, \"onTriplePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n    /**\n     * Set _center's x/y coordinates\n     * @param {Number} clientX\n     * @param {Number} clientY\n     */\n    __publicField(this, \"setCenter\", (clientX, clientY) => {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n    /**\n     * Set default mouse actions\n     */\n    __publicField(this, \"initializeMouseActions\", () => {\n      this.setMouseAction(\"PAN\", 0, \"CTRL\");\n      this.setMouseAction(\"PAN\", 2);\n      this.setMouseAction(\"ROTATE\", 0);\n      this.setMouseAction(\"ZOOM\", \"WHEEL\");\n      this.setMouseAction(\"ZOOM\", 1);\n      this.setMouseAction(\"FOV\", \"WHEEL\", \"SHIFT\");\n      this.setMouseAction(\"FOV\", 1, \"SHIFT\");\n    });\n    /**\n     * Set a new mouse action by specifying the operation to be performed and a mouse/key combination. In case of conflict, replaces the existing one\n     * @param {String} operation The operation to be performed ('PAN', 'ROTATE', 'ZOOM', 'FOV)\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns {Boolean} True if the mouse action has been successfully added, false otherwise\n     */\n    __publicField(this, \"setMouseAction\", (operation, mouse, key = null) => {\n      const operationInput = [\"PAN\", \"ROTATE\", \"ZOOM\", \"FOV\"];\n      const mouseInput = [0, 1, 2, \"WHEEL\"];\n      const keyInput = [\"CTRL\", \"SHIFT\", null];\n      let state;\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        return false;\n      }\n      if (mouse == \"WHEEL\") {\n        if (operation != \"ZOOM\" && operation != \"FOV\") {\n          return false;\n        }\n      }\n      switch (operation) {\n        case \"PAN\":\n          state = STATE.PAN;\n          break;\n        case \"ROTATE\":\n          state = STATE.ROTATE;\n          break;\n        case \"ZOOM\":\n          state = STATE.SCALE;\n          break;\n        case \"FOV\":\n          state = STATE.FOV;\n          break;\n      }\n      const action = {\n        operation,\n        mouse,\n        key,\n        state\n      };\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == action.mouse && this.mouseActions[i].key == action.key) {\n          this.mouseActions.splice(i, 1, action);\n          return true;\n        }\n      }\n      this.mouseActions.push(action);\n      return true;\n    });\n    /**\n     * Return the operation associated to a mouse/keyboard combination\n     * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\n     * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\n     * @returns The operation if it has been found, null otherwise\n     */\n    __publicField(this, \"getOpFromAction\", (mouse, key) => {\n      let action;\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n      return null;\n    });\n    /**\n     * Get the operation associated to mouse and key combination and returns the corresponding FSA state\n     * @param {Number} mouse Mouse button\n     * @param {String} key Keyboard modifier\n     * @returns The FSA state obtained from the operation associated to mouse/keyboard combination\n     */\n    __publicField(this, \"getOpStateFromAction\", (mouse, key) => {\n      let action;\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n      if (key) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n      return null;\n    });\n    /**\n     * Calculate the angle between two pointers\n     * @param {PointerEvent} p1\n     * @param {PointerEvent} p2\n     * @returns {Number} The angle between two pointers in degrees\n     */\n    __publicField(this, \"getAngle\", (p1, p2) => {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n    /**\n     * Update a PointerEvent inside current pointerevents array\n     * @param {PointerEvent} event\n     */\n    __publicField(this, \"updateTouchEvent\", (event) => {\n      for (let i = 0; i < this._touchCurrent.length; i++) {\n        if (this._touchCurrent[i].pointerId == event.pointerId) {\n          this._touchCurrent.splice(i, 1, event);\n          break;\n        }\n      }\n    });\n    /**\n     * Calculate the angular speed\n     * @param {Number} p0 Position at t0\n     * @param {Number} p1 Position at t1\n     * @param {Number} t0 Initial time in milliseconds\n     * @param {Number} t1 Ending time in milliseconds\n     */\n    __publicField(this, \"calculateAngularSpeed\", (p0, p1, t0, t1) => {\n      const s = p1 - p0;\n      const t = (t1 - t0) / 1e3;\n      if (t == 0) {\n        return 0;\n      }\n      return s / t;\n    });\n    /**\n     * Calculate the distance between two pointers\n     * @param {PointerEvent} p0 The first pointer\n     * @param {PointerEvent} p1 The second pointer\n     * @returns {number} The distance between the two pointers\n     */\n    __publicField(this, \"calculatePointersDistance\", (p0, p1) => {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n    /**\n     * Calculate the rotation axis as the vector perpendicular between two vectors\n     * @param {Vector3} vec1 The first vector\n     * @param {Vector3} vec2 The second vector\n     * @returns {Vector3} The normalized rotation axis\n     */\n    __publicField(this, \"calculateRotationAxis\", (vec1, vec2) => {\n      this._rotationMatrix.extractRotation(this._cameraMatrixState);\n      this._quat.setFromRotationMatrix(this._rotationMatrix);\n      this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(this._quat);\n      return this._rotationAxis.normalize().clone();\n    });\n    /**\n     * Calculate the trackball radius so that gizmo's diamater will be 2/3 of the minimum side of the camera frustum\n     * @param {Camera} camera\n     * @returns {Number} The trackball radius\n     */\n    __publicField(this, \"calculateTbRadius\", (camera) => {\n      const factor = 0.67;\n      const distance = camera.position.distanceTo(this._gizmos.position);\n      if (camera instanceof PerspectiveCamera) {\n        const halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5;\n        const halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV));\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera instanceof OrthographicCamera) {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n    /**\n     * Focus operation consist of positioning the point of interest in front of the camera and a slightly zoom in\n     * @param {Vector3} point The point of interest\n     * @param {Number} size Scale factor\n     * @param {Number} amount Amount of operation to be completed (used for focus animations, default is complete full operation)\n     */\n    __publicField(this, \"focus\", (point, size, amount = 1) => {\n      if (this.camera) {\n        const focusPoint = point.clone();\n        focusPoint.sub(this._gizmos.position).multiplyScalar(amount);\n        this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n        const gizmoStateTemp = this._gizmoMatrixState.clone();\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        const cameraStateTemp = this._cameraMatrixState.clone();\n        this._cameraMatrixState.premultiply(this._translationMatrix);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        if (this.enableZoom) {\n          this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n        }\n        this._gizmoMatrixState.copy(gizmoStateTemp);\n        this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n    /**\n     * Draw a grid and add it to the scene\n     */\n    __publicField(this, \"drawGrid\", () => {\n      if (this.scene) {\n        const color = 8947848;\n        const multiplier = 3;\n        let size, divisions, maxLength, tick;\n        if (this.camera instanceof OrthographicCamera) {\n          const width = this.camera.right - this.camera.left;\n          const height = this.camera.bottom - this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / this.camera.zoom * multiplier;\n          divisions = size / tick * this.camera.zoom;\n        } else if (this.camera instanceof PerspectiveCamera) {\n          const distance = this.camera.position.distanceTo(this._gizmos.position);\n          const halfFovV = MathUtils.DEG2RAD * this.camera.fov * 0.5;\n          const halfFovH = Math.atan(this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n        if (this._grid == null && this.camera) {\n          this._grid = new GridHelper(size, divisions, color, color);\n          this._grid.position.copy(this._gizmos.position);\n          this._gridPosition.copy(this._grid.position);\n          this._grid.quaternion.copy(this.camera.quaternion);\n          this._grid.rotateX(Math.PI * 0.5);\n          this.scene.add(this._grid);\n        }\n      }\n    });\n    __publicField(this, \"connect\", (domElement) => {\n      if (domElement === document) {\n        console.error(\n          'THREE.ArcballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.'\n        );\n      }\n      this.domElement = domElement;\n      this.domElement.style.touchAction = \"none\";\n      this.domElement.addEventListener(\"contextmenu\", this.onContextMenu);\n      this.domElement.addEventListener(\"pointerdown\", this.onPointerDown);\n      this.domElement.addEventListener(\"pointercancel\", this.onPointerCancel);\n      this.domElement.addEventListener(\"wheel\", this.onWheel);\n    });\n    /**\n     * Remove all listeners, stop animations and clean scene\n     */\n    __publicField(this, \"dispose\", () => {\n      var _a, _b, _c, _d, _e;\n      if (this._animationId != -1) {\n        window.cancelAnimationFrame(this._animationId);\n      }\n      (_a = this.domElement) == null ? void 0 : _a.removeEventListener(\"pointerdown\", this.onPointerDown);\n      (_b = this.domElement) == null ? void 0 : _b.removeEventListener(\"pointercancel\", this.onPointerCancel);\n      (_c = this.domElement) == null ? void 0 : _c.removeEventListener(\"wheel\", this.onWheel);\n      (_d = this.domElement) == null ? void 0 : _d.removeEventListener(\"contextmenu\", this.onContextMenu);\n      window.removeEventListener(\"pointermove\", this.onPointerMove);\n      window.removeEventListener(\"pointerup\", this.onPointerUp);\n      window.removeEventListener(\"resize\", this.onWindowResize);\n      (_e = this.scene) == null ? void 0 : _e.remove(this._gizmos);\n      this.disposeGrid();\n    });\n    /**\n     * remove the grid from the scene\n     */\n    __publicField(this, \"disposeGrid\", () => {\n      if (this._grid && this.scene) {\n        this.scene.remove(this._grid);\n        this._grid = null;\n      }\n    });\n    /**\n     * Compute the easing out cubic function for ease out effect in animation\n     * @param {Number} t The absolute progress of the animation in the bound of 0 (beginning of the) and 1 (ending of animation)\n     * @returns {Number} Result of easing out cubic at time t\n     */\n    __publicField(this, \"easeOutCubic\", (t) => {\n      return 1 - Math.pow(1 - t, 3);\n    });\n    /**\n     * Make rotation gizmos more or less visible\n     * @param {Boolean} isActive If true, make gizmos more visible\n     */\n    __publicField(this, \"activateGizmos\", (isActive) => {\n      for (const gizmo of this._gizmos.children) {\n        ;\n        gizmo.material.setValues({ opacity: isActive ? 1 : 0.6 });\n      }\n    });\n    /**\n     * Calculate the cursor position in NDC\n     * @param {number} x Cursor horizontal coordinate within the canvas\n     * @param {number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor normalized position inside the canvas\n     */\n    __publicField(this, \"getCursorNDC\", (cursorX, cursorY, canvas) => {\n      const canvasRect = canvas.getBoundingClientRect();\n      this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n      this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n      return this._v2_1.clone();\n    });\n    /**\n     * Calculate the cursor position inside the canvas x/y coordinates with the origin being in the center of the canvas\n     * @param {Number} x Cursor horizontal coordinate within the canvas\n     * @param {Number} y Cursor vertical coordinate within the canvas\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @returns {Vector2} Cursor position inside the canvas\n     */\n    __publicField(this, \"getCursorPosition\", (cursorX, cursorY, canvas) => {\n      this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n      if (this.camera instanceof OrthographicCamera) {\n        this._v2_1.x *= (this.camera.right - this.camera.left) * 0.5;\n        this._v2_1.y *= (this.camera.top - this.camera.bottom) * 0.5;\n      }\n      return this._v2_1.clone();\n    });\n    /**\n     * Set the camera to be controlled\n     * @param {Camera} camera The virtual camera to be controlled\n     */\n    __publicField(this, \"setCamera\", (camera) => {\n      if (camera) {\n        camera.lookAt(this.target);\n        camera.updateMatrix();\n        if (camera instanceof PerspectiveCamera) {\n          this._fov0 = camera.fov;\n          this._fovState = camera.fov;\n        }\n        this._cameraMatrixState0.copy(camera.matrix);\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n        this._cameraProjectionState.copy(camera.projectionMatrix);\n        this._zoom0 = camera.zoom;\n        this._zoomState = this._zoom0;\n        this._initialNear = camera.near;\n        this._nearPos0 = camera.position.distanceTo(this.target) - camera.near;\n        this._nearPos = this._initialNear;\n        this._initialFar = camera.far;\n        this._farPos0 = camera.position.distanceTo(this.target) - camera.far;\n        this._farPos = this._initialFar;\n        this._up0.copy(camera.up);\n        this._upState.copy(camera.up);\n        this.camera = camera;\n        this.camera.updateProjectionMatrix();\n        const tbRadius = this.calculateTbRadius(camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n      }\n    });\n    /**\n     * Creates the rotation gizmos matching trackball center and radius\n     * @param {Vector3} tbCenter The trackball center\n     * @param {number} tbRadius The trackball radius\n     */\n    __publicField(this, \"makeGizmos\", (tbCenter, tbRadius) => {\n      const curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n      const curveMaterialX = new LineBasicMaterial({ color: 16744576, fog: false, transparent: true, opacity: 0.6 });\n      const curveMaterialY = new LineBasicMaterial({ color: 8454016, fog: false, transparent: true, opacity: 0.6 });\n      const curveMaterialZ = new LineBasicMaterial({ color: 8421631, fog: false, transparent: true, opacity: 0.6 });\n      const gizmoX = new Line(curveGeometry, curveMaterialX);\n      const gizmoY = new Line(curveGeometry, curveMaterialY);\n      const gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      const rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation;\n      this._gizmoMatrixState0.identity().setPosition(tbCenter);\n      this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n      if (this.camera && this.camera.zoom != 1) {\n        const size = 1 / this.camera.zoom;\n        this._scaleMatrix.makeScale(size, size, size);\n        this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n        this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix);\n        this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n      }\n      this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n      this._gizmos.clear();\n      this._gizmos.add(gizmoX);\n      this._gizmos.add(gizmoY);\n      this._gizmos.add(gizmoZ);\n    });\n    /**\n     * Perform animation for focus operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} point Point of interest for focus operation\n     * @param {Matrix4} cameraMatrix Camera matrix\n     * @param {Matrix4} gizmoMatrix Gizmos matrix\n     */\n    __publicField(this, \"onFocusAnim\", (time, point, cameraMatrix, gizmoMatrix) => {\n      if (this._timeStart == -1) {\n        this._timeStart = time;\n      }\n      if (this._state == STATE.ANIMATION_FOCUS) {\n        const deltaTime = time - this._timeStart;\n        const animTime = deltaTime / this.focusAnimationTime;\n        this._gizmoMatrixState.copy(gizmoMatrix);\n        if (animTime >= 1) {\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n          this.focus(point, this.scaleFactor);\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        } else {\n          const amount = this.easeOutCubic(animTime);\n          const size = 1 - amount + this.scaleFactor * amount;\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n          this.focus(point, size, amount);\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function(t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        this._animationId = -1;\n        this._timeStart = -1;\n      }\n    });\n    /**\n     * Perform animation for rotation operation\n     * @param {Number} time Instant in which this function is called as performance.now()\n     * @param {Vector3} rotationAxis Rotation axis\n     * @param {number} w0 Initial angular velocity\n     */\n    __publicField(this, \"onRotationAnim\", (time, rotationAxis, w0) => {\n      if (this._timeStart == -1) {\n        this._anglePrev = 0;\n        this._angleCurrent = 0;\n        this._timeStart = time;\n      }\n      if (this._state == STATE.ANIMATION_ROTATE) {\n        const deltaTime = (time - this._timeStart) / 1e3;\n        const w = w0 + -this.dampingFactor * deltaTime;\n        if (w > 0) {\n          this._angleCurrent = 0.5 * -this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n          this.applyTransformMatrix(this.rotate(rotationAxis, this._angleCurrent));\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function(t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          this._animationId = -1;\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        this._animationId = -1;\n        this._timeStart = -1;\n        if (this._state != STATE.ROTATE) {\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n    /**\n     * Perform pan operation moving camera between two points\n     * @param {Vector3} p0 Initial point\n     * @param {Vector3} p1 Ending point\n     * @param {Boolean} adjust If movement should be adjusted considering camera distance (Perspective only)\n     */\n    __publicField(this, \"pan\", (p0, p1, adjust = false) => {\n      if (this.camera) {\n        const movement = p0.clone().sub(p1);\n        if (this.camera instanceof OrthographicCamera) {\n          movement.multiplyScalar(1 / this.camera.zoom);\n        }\n        if (this.camera instanceof PerspectiveCamera && adjust) {\n          this._v3_1.setFromMatrixPosition(this._cameraMatrixState0);\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);\n          const distanceFactor = this._v3_1.distanceTo(this._v3_2) / this.camera.position.distanceTo(this._gizmos.position);\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n        this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(this.camera.quaternion);\n        this._m4_1.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z);\n        this.setTransformationMatrices(this._m4_1, this._m4_1);\n      }\n      return _transformation;\n    });\n    /**\n     * Reset trackball\n     */\n    __publicField(this, \"reset\", () => {\n      if (this.camera) {\n        this.camera.zoom = this._zoom0;\n        if (this.camera instanceof PerspectiveCamera) {\n          this.camera.fov = this._fov0;\n        }\n        this.camera.near = this._nearPos;\n        this.camera.far = this._farPos;\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        this.camera.up.copy(this._up0);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n        this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n        this._gizmoMatrixState0.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        this._gizmos.updateMatrix();\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    /**\n     * Rotate the camera around an axis passing by trackball's center\n     * @param {Vector3} axis Rotation axis\n     * @param {number} angle Angle in radians\n     * @returns {Object} Object with 'camera' field containing transformation matrix resulting from the operation to be applied to the camera\n     */\n    __publicField(this, \"rotate\", (axis, angle) => {\n      const point = this._gizmos.position;\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      this._rotationMatrix.makeRotationAxis(axis, -angle);\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n      this._m4_1.multiply(this._rotationMatrix);\n      this._m4_1.multiply(this._translationMatrix);\n      this.setTransformationMatrices(this._m4_1);\n      return _transformation;\n    });\n    __publicField(this, \"copyState\", () => {\n      if (this.camera) {\n        const state = JSON.stringify(\n          this.camera instanceof OrthographicCamera ? {\n            arcballState: {\n              cameraFar: this.camera.far,\n              cameraMatrix: this.camera.matrix,\n              cameraNear: this.camera.near,\n              cameraUp: this.camera.up,\n              cameraZoom: this.camera.zoom,\n              gizmoMatrix: this._gizmos.matrix\n            }\n          } : {\n            arcballState: {\n              cameraFar: this.camera.far,\n              cameraFov: this.camera.fov,\n              cameraMatrix: this.camera.matrix,\n              cameraNear: this.camera.near,\n              cameraUp: this.camera.up,\n              cameraZoom: this.camera.zoom,\n              gizmoMatrix: this._gizmos.matrix\n            }\n          }\n        );\n        navigator.clipboard.writeText(state);\n      }\n    });\n    __publicField(this, \"pasteState\", () => {\n      const self = this;\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n    /**\n     * Save the current state of the control. This can later be recovered with .reset\n     */\n    __publicField(this, \"saveState\", () => {\n      if (!this.camera)\n        return;\n      this._cameraMatrixState0.copy(this.camera.matrix);\n      this._gizmoMatrixState0.copy(this._gizmos.matrix);\n      this._nearPos = this.camera.near;\n      this._farPos = this.camera.far;\n      this._zoom0 = this.camera.zoom;\n      this._up0.copy(this.camera.up);\n      if (this.camera instanceof PerspectiveCamera) {\n        this._fov0 = this.camera.fov;\n      }\n    });\n    /**\n     * Perform uniform scale operation around a given point\n     * @param {Number} size Scale factor\n     * @param {Vector3} point Point around which scale\n     * @param {Boolean} scaleGizmos If gizmos should be scaled (Perspective only)\n     * @returns {Object} Object with 'camera' and 'gizmo' fields containing transformation matrices resulting from the operation to be applied to the camera and gizmos\n     */\n    __publicField(this, \"applyScale\", (size, point, scaleGizmos = true) => {\n      if (!this.camera)\n        return;\n      const scalePoint = point.clone();\n      let sizeInverse = 1 / size;\n      if (this.camera instanceof OrthographicCamera) {\n        this.camera.zoom = this._zoomState;\n        this.camera.zoom *= size;\n        if (this.camera.zoom > this.maxZoom) {\n          this.camera.zoom = this.maxZoom;\n          sizeInverse = this._zoomState / this.maxZoom;\n        } else if (this.camera.zoom < this.minZoom) {\n          this.camera.zoom = this.minZoom;\n          sizeInverse = this._zoomState / this.minZoom;\n        }\n        this.camera.updateProjectionMatrix();\n        this._v3_1.setFromMatrixPosition(this._gizmoMatrixState);\n        this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n        this._translationMatrix.makeTranslation(-this._v3_1.x, -this._v3_1.y, -this._v3_1.z);\n        this._m4_2.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z).multiply(this._scaleMatrix);\n        this._m4_2.multiply(this._translationMatrix);\n        scalePoint.sub(this._v3_1);\n        const amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n        this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n        this._m4_2.premultiply(this._m4_1);\n        this.setTransformationMatrices(this._m4_1, this._m4_2);\n        return _transformation;\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n        let distance = this._v3_1.distanceTo(scalePoint);\n        let amount = distance - distance * sizeInverse;\n        const newDistance = distance - amount;\n        if (newDistance < this.minDistance) {\n          sizeInverse = this.minDistance / distance;\n          amount = distance - distance * sizeInverse;\n        } else if (newDistance > this.maxDistance) {\n          sizeInverse = this.maxDistance / distance;\n          amount = distance - distance * sizeInverse;\n        }\n        let direction = scalePoint.clone().sub(this._v3_1).normalize().multiplyScalar(amount);\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n        if (scaleGizmos) {\n          const pos = this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(this._v3_2).normalize().multiplyScalar(amount);\n          this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n          this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n          this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(this._translationMatrix);\n          this._m4_2.multiply(this._scaleMatrix);\n          this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n          this._m4_2.multiply(this._translationMatrix);\n          this.setTransformationMatrices(this._m4_1, this._m4_2);\n        } else {\n          this.setTransformationMatrices(this._m4_1);\n        }\n        return _transformation;\n      }\n    });\n    /**\n     * Set camera fov\n     * @param {Number} value fov to be setted\n     */\n    __publicField(this, \"setFov\", (value) => {\n      if (this.camera instanceof PerspectiveCamera) {\n        this.camera.fov = MathUtils.clamp(value, this.minFov, this.maxFov);\n        this.camera.updateProjectionMatrix();\n      }\n    });\n    /**\n     * Set the trackball's center point\n     * @param {Number} x X coordinate\n     * @param {Number} y Y coordinate\n     * @param {Number} z Z coordinate\n     */\n    __publicField(this, \"setTarget\", (x, y, z) => {\n      if (this.camera) {\n        this.target.set(x, y, z);\n        this._gizmos.position.set(x, y, z);\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n        this.camera.lookAt(this.target);\n      }\n    });\n    /**\n     * Rotate camera around its direction axis passing by a given point by a given angle\n     * @param {Vector3} point The point where the rotation axis is passing trough\n     * @param {Number} angle Angle in radians\n     * @returns The computed transormation matix\n     */\n    __publicField(this, \"zRotate\", (point, angle) => {\n      this._rotationMatrix.makeRotationAxis(this._rotationAxis, angle);\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n      this._m4_1.multiply(this._rotationMatrix);\n      this._m4_1.multiply(this._translationMatrix);\n      this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(point);\n      this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis, angle);\n      this._v3_2.sub(this._v3_1);\n      this._m4_2.makeTranslation(this._v3_2.x, this._v3_2.y, this._v3_2.z);\n      this.setTransformationMatrices(this._m4_1, this._m4_2);\n      return _transformation;\n    });\n    /**\n     * Unproject the cursor on the 3D object surface\n     * @param {Vector2} cursor Cursor coordinates in NDC\n     * @param {Camera} camera Virtual camera\n     * @returns {Vector3} The point of intersection with the model, if exist, null otherwise\n     */\n    __publicField(this, \"unprojectOnObj\", (cursor, camera) => {\n      if (!this.scene)\n        return null;\n      const raycaster = new Raycaster();\n      raycaster.near = camera.near;\n      raycaster.far = camera.far;\n      raycaster.setFromCamera(cursor, camera);\n      const intersect = raycaster.intersectObjects(this.scene.children, true);\n      for (let i = 0; i < intersect.length; i++) {\n        if (intersect[i].object.uuid != this._gizmos.uuid && intersect[i].face) {\n          return intersect[i].point.clone();\n        }\n      }\n      return null;\n    });\n    /**\n     * Unproject the cursor on the trackball surface\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {number} tbRadius The trackball radius\n     * @returns {Vector3} The unprojected point on the trackball surface\n     */\n    __publicField(this, \"unprojectOnTbSurface\", (camera, cursorX, cursorY, canvas, tbRadius) => {\n      if (camera instanceof OrthographicCamera) {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n        const x2 = Math.pow(this._v2_1.x, 2);\n        const y2 = Math.pow(this._v2_1.y, 2);\n        const r2 = Math.pow(this._tbRadius, 2);\n        if (x2 + y2 <= r2 * 0.5) {\n          this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n        return this._v3_1;\n      }\n      if (camera instanceof PerspectiveCamera) {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        const rayDir = this._v3_1.clone().normalize();\n        const cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        const radius2 = Math.pow(tbRadius, 2);\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        if (l == 0) {\n          rayDir.set(this._v3_1.x, this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        let a = Math.pow(m, 2) + 1;\n        let b = 2 * m * q;\n        let c = Math.pow(q, 2) - radius2;\n        let delta = Math.pow(b, 2) - 4 * a * c;\n        if (delta >= 0) {\n          this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n          this._v2_1.setY(m * this._v2_1.x + q);\n          const angle = MathUtils.RAD2DEG * this._v2_1.angle();\n          if (angle >= 45) {\n            const rayLength2 = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n            rayDir.multiplyScalar(rayLength2);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        }\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n        this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n        this._v2_1.setY(m * this._v2_1.x + q);\n        const rayLength = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n    /**\n     * Unproject the cursor on the plane passing through the center of the trackball orthogonal to the camera\n     * @param {Camera} camera The virtual camera\n     * @param {Number} cursorX Cursor horizontal coordinate on screen\n     * @param {Number} cursorY Cursor vertical coordinate on screen\n     * @param {HTMLElement} canvas The canvas where the renderer draws its output\n     * @param {Boolean} initialDistance If initial distance between camera and gizmos should be used for calculations instead of current (Perspective only)\n     * @returns {Vector3} The unprojected point on the trackball plane\n     */\n    __publicField(this, \"unprojectOnTbPlane\", (camera, cursorX, cursorY, canvas, initialDistance = false) => {\n      if (camera instanceof OrthographicCamera) {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n        return this._v3_1.clone();\n      }\n      if (camera instanceof PerspectiveCamera) {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n        const rayDir = this._v3_1.clone().normalize();\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        let cameraGizmoDistance;\n        if (initialDistance) {\n          cameraGizmoDistance = this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        }\n        if (l == 0) {\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        const x = -q / m;\n        const rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n    /**\n     * Update camera and gizmos state\n     */\n    __publicField(this, \"updateMatrixState\", () => {\n      if (!this.camera)\n        return;\n      this._cameraMatrixState.copy(this.camera.matrix);\n      this._gizmoMatrixState.copy(this._gizmos.matrix);\n      if (this.camera instanceof OrthographicCamera) {\n        this._cameraProjectionState.copy(this.camera.projectionMatrix);\n        this.camera.updateProjectionMatrix();\n        this._zoomState = this.camera.zoom;\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        this._fovState = this.camera.fov;\n      }\n    });\n    /**\n     * Update the trackball FSA\n     * @param {STATE} newState New state of the FSA\n     * @param {Boolean} updateMatrices If matriices state should be updated\n     */\n    __publicField(this, \"updateTbState\", (newState, updateMatrices) => {\n      this._state = newState;\n      if (updateMatrices) {\n        this.updateMatrixState();\n      }\n    });\n    __publicField(this, \"update\", () => {\n      const EPS = 1e-6;\n      if (!this.target.equals(this._currentTarget) && this.camera) {\n        this._gizmos.position.set(this.target.x, this.target.y, this.target.z);\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        this.makeGizmos(this.target, this._tbRadius);\n        this._currentTarget.copy(this.target);\n      }\n      if (!this.camera)\n        return;\n      if (this.camera instanceof OrthographicCamera) {\n        if (this.camera.zoom > this.maxZoom || this.camera.zoom < this.minZoom) {\n          const newZoom = MathUtils.clamp(this.camera.zoom, this.minZoom, this.maxZoom);\n          this.applyTransformMatrix(this.applyScale(newZoom / this.camera.zoom, this._gizmos.position, true));\n        }\n      }\n      if (this.camera instanceof PerspectiveCamera) {\n        const distance = this.camera.position.distanceTo(this._gizmos.position);\n        if (distance > this.maxDistance + EPS || distance < this.minDistance - EPS) {\n          const newDistance = MathUtils.clamp(distance, this.minDistance, this.maxDistance);\n          this.applyTransformMatrix(this.applyScale(newDistance / distance, this._gizmos.position));\n          this.updateMatrixState();\n        }\n        if (this.camera.fov < this.minFov || this.camera.fov > this.maxFov) {\n          this.camera.fov = MathUtils.clamp(this.camera.fov, this.minFov, this.maxFov);\n          this.camera.updateProjectionMatrix();\n        }\n        const oldRadius = this._tbRadius;\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        if (oldRadius < this._tbRadius - EPS || oldRadius > this._tbRadius + EPS) {\n          const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n          const newRadius = this._tbRadius / scale;\n          const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          const points = curve.getPoints(this._curvePts);\n          const curveGeometry = new BufferGeometry().setFromPoints(points);\n          for (const gizmo in this._gizmos.children) {\n            const child = this._gizmos.children[gizmo];\n            child.geometry = curveGeometry;\n          }\n        }\n      }\n      this.camera.lookAt(this._gizmos.position);\n    });\n    __publicField(this, \"setStateFromJSON\", (json) => {\n      const state = JSON.parse(json);\n      if (state.arcballState && this.camera) {\n        this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n        this.camera.up.copy(state.arcballState.cameraUp);\n        this.camera.near = state.arcballState.cameraNear;\n        this.camera.far = state.arcballState.cameraFar;\n        this.camera.zoom = state.arcballState.cameraZoom;\n        if (this.camera instanceof PerspectiveCamera) {\n          this.camera.fov = state.arcballState.cameraFov;\n        }\n        this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n        this._gizmos.updateMatrix();\n        const tbRadius = this.calculateTbRadius(this.camera);\n        if (tbRadius !== void 0) {\n          this._tbRadius = tbRadius;\n        }\n        const gizmoTmp = new Matrix4().copy(this._gizmoMatrixState0);\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this._gizmoMatrixState0.copy(gizmoTmp);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n    this.camera = null;\n    this.domElement = domElement;\n    this.scene = scene;\n    this.mouseActions = [];\n    this._mouseOp = null;\n    this._v2_1 = new Vector2();\n    this._v3_1 = new Vector3();\n    this._v3_2 = new Vector3();\n    this._m4_1 = new Matrix4();\n    this._m4_2 = new Matrix4();\n    this._quat = new Quaternion();\n    this._translationMatrix = new Matrix4();\n    this._rotationMatrix = new Matrix4();\n    this._scaleMatrix = new Matrix4();\n    this._rotationAxis = new Vector3();\n    this._cameraMatrixState = new Matrix4();\n    this._cameraProjectionState = new Matrix4();\n    this._fovState = 1;\n    this._upState = new Vector3();\n    this._zoomState = 1;\n    this._nearPos = 0;\n    this._farPos = 0;\n    this._gizmoMatrixState = new Matrix4();\n    this._up0 = new Vector3();\n    this._zoom0 = 1;\n    this._fov0 = 0;\n    this._initialNear = 0;\n    this._nearPos0 = 0;\n    this._initialFar = 0;\n    this._farPos0 = 0;\n    this._cameraMatrixState0 = new Matrix4();\n    this._gizmoMatrixState0 = new Matrix4();\n    this._button = -1;\n    this._touchStart = [];\n    this._touchCurrent = [];\n    this._input = INPUT.NONE;\n    this._switchSensibility = 32;\n    this._startFingerDistance = 0;\n    this._currentFingerDistance = 0;\n    this._startFingerRotation = 0;\n    this._currentFingerRotation = 0;\n    this._devPxRatio = 0;\n    this._downValid = true;\n    this._nclicks = 0;\n    this._downEvents = [];\n    this._clickStart = 0;\n    this._maxDownTime = 250;\n    this._maxInterval = 300;\n    this._posThreshold = 24;\n    this._movementThreshold = 24;\n    this._currentCursorPosition = new Vector3();\n    this._startCursorPosition = new Vector3();\n    this._grid = null;\n    this._gridPosition = new Vector3();\n    this._gizmos = new Group();\n    this._curvePts = 128;\n    this._timeStart = -1;\n    this._animationId = -1;\n    this.focusAnimationTime = 500;\n    this._timePrev = 0;\n    this._timeCurrent = 0;\n    this._anglePrev = 0;\n    this._angleCurrent = 0;\n    this._cursorPosPrev = new Vector3();\n    this._cursorPosCurr = new Vector3();\n    this._wPrev = 0;\n    this._wCurr = 0;\n    this.adjustNearFar = false;\n    this.scaleFactor = 1.1;\n    this.dampingFactor = 25;\n    this.wMax = 20;\n    this.enableAnimations = true;\n    this.enableGrid = false;\n    this.cursorZoom = false;\n    this.minFov = 5;\n    this.maxFov = 90;\n    this.enabled = true;\n    this.enablePan = true;\n    this.enableRotate = true;\n    this.enableZoom = true;\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n    this.target = new Vector3(0, 0, 0);\n    this._currentTarget = new Vector3(0, 0, 0);\n    this._tbRadius = 1;\n    this._state = STATE.IDLE;\n    this.setCamera(camera);\n    if (this.scene) {\n      this.scene.add(this._gizmos);\n    }\n    this._devPxRatio = window.devicePixelRatio;\n    this.initializeMouseActions();\n    if (this.domElement)\n      this.connect(this.domElement);\n    window.addEventListener(\"resize\", this.onWindowResize);\n  }\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n  applyTransformMatrix(transformation) {\n    if ((transformation == null ? void 0 : transformation.camera) && this.camera) {\n      this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n      this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n      this.camera.updateMatrix();\n      if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n        this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n      }\n    }\n    if (transformation == null ? void 0 : transformation.gizmos) {\n      this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n      this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n      this._gizmos.updateMatrix();\n    }\n    if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && this.camera) {\n      const tbRadius = this.calculateTbRadius(this.camera);\n      if (tbRadius !== void 0) {\n        this._tbRadius = tbRadius;\n      }\n      if (this.adjustNearFar) {\n        const cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n        const bb = new Box3();\n        bb.setFromObject(this._gizmos);\n        const sphere = new Sphere();\n        bb.getBoundingSphere(sphere);\n        const adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n        const regularNearPosition = cameraDistance - this._initialNear;\n        const minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n        this.camera.near = cameraDistance - minNearPos;\n        const adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n        const regularFarPosition = cameraDistance - this._initialFar;\n        const minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n        this.camera.far = cameraDistance - minFarPos;\n        this.camera.updateProjectionMatrix();\n      } else {\n        let update = false;\n        if (this.camera.near != this._initialNear) {\n          this.camera.near = this._initialNear;\n          update = true;\n        }\n        if (this.camera.far != this._initialFar) {\n          this.camera.far = this._initialFar;\n          update = true;\n        }\n        if (update) {\n          this.camera.updateProjectionMatrix();\n        }\n      }\n    }\n  }\n  /**\n   * Set gizmos visibility\n   * @param {Boolean} value Value of gizmos visibility\n   */\n  setGizmosVisible(value) {\n    this._gizmos.visible = value;\n    this.dispatchEvent(_changeEvent);\n  }\n  /**\n   * Set values in transformation object\n   * @param {Matrix4} camera Transformation to be applied to the camera\n   * @param {Matrix4} gizmos Transformation to be applied to gizmos\n   */\n  setTransformationMatrices(camera = null, gizmos = null) {\n    if (camera) {\n      if (_transformation.camera) {\n        _transformation.camera.copy(camera);\n      } else {\n        _transformation.camera = camera.clone();\n      }\n    } else {\n      _transformation.camera = null;\n    }\n    if (gizmos) {\n      if (_transformation.gizmos) {\n        _transformation.gizmos.copy(gizmos);\n      } else {\n        _transformation.gizmos = gizmos.clone();\n      }\n    } else {\n      _transformation.gizmos = null;\n    }\n  }\n}\nexport {\n  ArcballControls\n};\n"]},"metadata":{},"sourceType":"module"}