{"ast":null,"code":"import _classCallCheck from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { Vector3, Color, SphericalHarmonics3, LightProbe } from \"three\";\n\nvar LightProbeGenerator = /*#__PURE__*/function () {\n  function LightProbeGenerator() {\n    _classCallCheck(this, LightProbeGenerator);\n  }\n\n  _createClass(LightProbeGenerator, null, [{\n    key: \"fromCubeTexture\",\n    value: // https://www.ppsloan.org/publications/StupidSH36.pdf\n    function fromCubeTexture(cubeTexture) {\n      var totalWeight = 0;\n      var coord = new Vector3();\n      var dir = new Vector3();\n      var color = new Color();\n      var shBasis = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n      var sh = new SphericalHarmonics3();\n      var shCoefficients = sh.coefficients;\n\n      for (var faceIndex = 0; faceIndex < 6; faceIndex++) {\n        var image = cubeTexture.image[faceIndex];\n        var width = image.width;\n        var height = image.height;\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = width;\n        canvas.height = height;\n        var context = canvas.getContext(\"2d\");\n        context.drawImage(image, 0, 0, width, height);\n        var imageData = context.getImageData(0, 0, width, height);\n        var data = imageData.data;\n        var imageWidth = imageData.width;\n        var pixelSize = 2 / imageWidth;\n\n        for (var i = 0, il = data.length; i < il; i += 4) {\n          color.setRGB(data[i] / 255, data[i + 1] / 255, data[i + 2] / 255);\n\n          if (\"colorSpace\" in cubeTexture) {\n            if (cubeTexture.colorSpace === \"srgb\") {\n              color.convertSRGBToLinear();\n            }\n          } else if (cubeTexture.encoding === 3001) {\n            color.convertSRGBToLinear();\n          }\n\n          var pixelIndex = i / 4;\n          var col = -1 + (pixelIndex % imageWidth + 0.5) * pixelSize;\n          var row = 1 - (Math.floor(pixelIndex / imageWidth) + 0.5) * pixelSize;\n\n          switch (faceIndex) {\n            case 0:\n              coord.set(-1, row, -col);\n              break;\n\n            case 1:\n              coord.set(1, row, col);\n              break;\n\n            case 2:\n              coord.set(-col, 1, -row);\n              break;\n\n            case 3:\n              coord.set(-col, -1, row);\n              break;\n\n            case 4:\n              coord.set(-col, row, 1);\n              break;\n\n            case 5:\n              coord.set(col, row, -1);\n              break;\n          }\n\n          var lengthSq = coord.lengthSq();\n          var weight = 4 / (Math.sqrt(lengthSq) * lengthSq);\n          totalWeight += weight;\n          dir.copy(coord).normalize();\n          SphericalHarmonics3.getBasisAt(dir, shBasis);\n\n          for (var j = 0; j < 9; j++) {\n            shCoefficients[j].x += shBasis[j] * color.r * weight;\n            shCoefficients[j].y += shBasis[j] * color.g * weight;\n            shCoefficients[j].z += shBasis[j] * color.b * weight;\n          }\n        }\n      }\n\n      var norm = 4 * Math.PI / totalWeight;\n\n      for (var _j = 0; _j < 9; _j++) {\n        shCoefficients[_j].x *= norm;\n        shCoefficients[_j].y *= norm;\n        shCoefficients[_j].z *= norm;\n      }\n\n      return new LightProbe(sh);\n    }\n  }, {\n    key: \"fromCubeRenderTarget\",\n    value: function fromCubeRenderTarget(renderer, cubeRenderTarget) {\n      var totalWeight = 0;\n      var coord = new Vector3();\n      var dir = new Vector3();\n      var color = new Color();\n      var shBasis = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n      var sh = new SphericalHarmonics3();\n      var shCoefficients = sh.coefficients;\n\n      for (var faceIndex = 0; faceIndex < 6; faceIndex++) {\n        var imageWidth = cubeRenderTarget.width;\n        var data = new Uint8Array(imageWidth * imageWidth * 4);\n        renderer.readRenderTargetPixels(cubeRenderTarget, 0, 0, imageWidth, imageWidth, data, faceIndex);\n        var pixelSize = 2 / imageWidth;\n\n        for (var i = 0, il = data.length; i < il; i += 4) {\n          color.setRGB(data[i] / 255, data[i + 1] / 255, data[i + 2] / 255);\n\n          if (\"colorSpace\" in cubeRenderTarget.texture) {\n            if (cubeRenderTarget.texture.colorSpace === \"srgb\") {\n              color.convertSRGBToLinear();\n            }\n          } else if (cubeRenderTarget.texture.encoding === 3001) {\n            color.convertSRGBToLinear();\n          }\n\n          var pixelIndex = i / 4;\n          var col = -1 + (pixelIndex % imageWidth + 0.5) * pixelSize;\n          var row = 1 - (Math.floor(pixelIndex / imageWidth) + 0.5) * pixelSize;\n\n          switch (faceIndex) {\n            case 0:\n              coord.set(1, row, -col);\n              break;\n\n            case 1:\n              coord.set(-1, row, col);\n              break;\n\n            case 2:\n              coord.set(col, 1, -row);\n              break;\n\n            case 3:\n              coord.set(col, -1, row);\n              break;\n\n            case 4:\n              coord.set(col, row, 1);\n              break;\n\n            case 5:\n              coord.set(-col, row, -1);\n              break;\n          }\n\n          var lengthSq = coord.lengthSq();\n          var weight = 4 / (Math.sqrt(lengthSq) * lengthSq);\n          totalWeight += weight;\n          dir.copy(coord).normalize();\n          SphericalHarmonics3.getBasisAt(dir, shBasis);\n\n          for (var j = 0; j < 9; j++) {\n            shCoefficients[j].x += shBasis[j] * color.r * weight;\n            shCoefficients[j].y += shBasis[j] * color.g * weight;\n            shCoefficients[j].z += shBasis[j] * color.b * weight;\n          }\n        }\n      }\n\n      var norm = 4 * Math.PI / totalWeight;\n\n      for (var _j2 = 0; _j2 < 9; _j2++) {\n        shCoefficients[_j2].x *= norm;\n        shCoefficients[_j2].y *= norm;\n        shCoefficients[_j2].z *= norm;\n      }\n\n      return new LightProbe(sh);\n    }\n  }]);\n\n  return LightProbeGenerator;\n}();\n\nexport { LightProbeGenerator };","map":{"version":3,"sources":["/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/three-stdlib/lights/LightProbeGenerator.js"],"names":["Vector3","Color","SphericalHarmonics3","LightProbe","LightProbeGenerator","cubeTexture","totalWeight","coord","dir","color","shBasis","sh","shCoefficients","coefficients","faceIndex","image","width","height","canvas","document","createElement","context","getContext","drawImage","imageData","getImageData","data","imageWidth","pixelSize","i","il","length","setRGB","colorSpace","convertSRGBToLinear","encoding","pixelIndex","col","row","Math","floor","set","lengthSq","weight","sqrt","copy","normalize","getBasisAt","j","x","r","y","g","z","b","norm","PI","renderer","cubeRenderTarget","Uint8Array","readRenderTargetPixels","texture"],"mappings":"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","sourcesContent":["import { Vector3, Color, SphericalHarmonics3, LightProbe } from \"three\";\nclass LightProbeGenerator {\n  // https://www.ppsloan.org/publications/StupidSH36.pdf\n  static fromCubeTexture(cubeTexture) {\n    let totalWeight = 0;\n    const coord = new Vector3();\n    const dir = new Vector3();\n    const color = new Color();\n    const shBasis = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n    const sh = new SphericalHarmonics3();\n    const shCoefficients = sh.coefficients;\n    for (let faceIndex = 0; faceIndex < 6; faceIndex++) {\n      const image = cubeTexture.image[faceIndex];\n      const width = image.width;\n      const height = image.height;\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = width;\n      canvas.height = height;\n      const context = canvas.getContext(\"2d\");\n      context.drawImage(image, 0, 0, width, height);\n      const imageData = context.getImageData(0, 0, width, height);\n      const data = imageData.data;\n      const imageWidth = imageData.width;\n      const pixelSize = 2 / imageWidth;\n      for (let i = 0, il = data.length; i < il; i += 4) {\n        color.setRGB(data[i] / 255, data[i + 1] / 255, data[i + 2] / 255);\n        if (\"colorSpace\" in cubeTexture) {\n          if (cubeTexture.colorSpace === \"srgb\") {\n            color.convertSRGBToLinear();\n          }\n        } else if (cubeTexture.encoding === 3001) {\n          color.convertSRGBToLinear();\n        }\n        const pixelIndex = i / 4;\n        const col = -1 + (pixelIndex % imageWidth + 0.5) * pixelSize;\n        const row = 1 - (Math.floor(pixelIndex / imageWidth) + 0.5) * pixelSize;\n        switch (faceIndex) {\n          case 0:\n            coord.set(-1, row, -col);\n            break;\n          case 1:\n            coord.set(1, row, col);\n            break;\n          case 2:\n            coord.set(-col, 1, -row);\n            break;\n          case 3:\n            coord.set(-col, -1, row);\n            break;\n          case 4:\n            coord.set(-col, row, 1);\n            break;\n          case 5:\n            coord.set(col, row, -1);\n            break;\n        }\n        const lengthSq = coord.lengthSq();\n        const weight = 4 / (Math.sqrt(lengthSq) * lengthSq);\n        totalWeight += weight;\n        dir.copy(coord).normalize();\n        SphericalHarmonics3.getBasisAt(dir, shBasis);\n        for (let j = 0; j < 9; j++) {\n          shCoefficients[j].x += shBasis[j] * color.r * weight;\n          shCoefficients[j].y += shBasis[j] * color.g * weight;\n          shCoefficients[j].z += shBasis[j] * color.b * weight;\n        }\n      }\n    }\n    const norm = 4 * Math.PI / totalWeight;\n    for (let j = 0; j < 9; j++) {\n      shCoefficients[j].x *= norm;\n      shCoefficients[j].y *= norm;\n      shCoefficients[j].z *= norm;\n    }\n    return new LightProbe(sh);\n  }\n  static fromCubeRenderTarget(renderer, cubeRenderTarget) {\n    let totalWeight = 0;\n    const coord = new Vector3();\n    const dir = new Vector3();\n    const color = new Color();\n    const shBasis = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n    const sh = new SphericalHarmonics3();\n    const shCoefficients = sh.coefficients;\n    for (let faceIndex = 0; faceIndex < 6; faceIndex++) {\n      const imageWidth = cubeRenderTarget.width;\n      const data = new Uint8Array(imageWidth * imageWidth * 4);\n      renderer.readRenderTargetPixels(cubeRenderTarget, 0, 0, imageWidth, imageWidth, data, faceIndex);\n      const pixelSize = 2 / imageWidth;\n      for (let i = 0, il = data.length; i < il; i += 4) {\n        color.setRGB(data[i] / 255, data[i + 1] / 255, data[i + 2] / 255);\n        if (\"colorSpace\" in cubeRenderTarget.texture) {\n          if (cubeRenderTarget.texture.colorSpace === \"srgb\") {\n            color.convertSRGBToLinear();\n          }\n        } else if (cubeRenderTarget.texture.encoding === 3001) {\n          color.convertSRGBToLinear();\n        }\n        const pixelIndex = i / 4;\n        const col = -1 + (pixelIndex % imageWidth + 0.5) * pixelSize;\n        const row = 1 - (Math.floor(pixelIndex / imageWidth) + 0.5) * pixelSize;\n        switch (faceIndex) {\n          case 0:\n            coord.set(1, row, -col);\n            break;\n          case 1:\n            coord.set(-1, row, col);\n            break;\n          case 2:\n            coord.set(col, 1, -row);\n            break;\n          case 3:\n            coord.set(col, -1, row);\n            break;\n          case 4:\n            coord.set(col, row, 1);\n            break;\n          case 5:\n            coord.set(-col, row, -1);\n            break;\n        }\n        const lengthSq = coord.lengthSq();\n        const weight = 4 / (Math.sqrt(lengthSq) * lengthSq);\n        totalWeight += weight;\n        dir.copy(coord).normalize();\n        SphericalHarmonics3.getBasisAt(dir, shBasis);\n        for (let j = 0; j < 9; j++) {\n          shCoefficients[j].x += shBasis[j] * color.r * weight;\n          shCoefficients[j].y += shBasis[j] * color.g * weight;\n          shCoefficients[j].z += shBasis[j] * color.b * weight;\n        }\n      }\n    }\n    const norm = 4 * Math.PI / totalWeight;\n    for (let j = 0; j < 9; j++) {\n      shCoefficients[j].x *= norm;\n      shCoefficients[j].y *= norm;\n      shCoefficients[j].z *= norm;\n    }\n    return new LightProbe(sh);\n  }\n}\nexport {\n  LightProbeGenerator\n};\n"]},"metadata":{},"sourceType":"module"}