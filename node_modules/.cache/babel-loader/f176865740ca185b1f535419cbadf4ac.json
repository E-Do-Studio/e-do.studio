{"ast":null,"code":"import _classCallCheck from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nvar __defProp = Object.defineProperty;\n\nvar __defNormalProp = function __defNormalProp(obj, key, value) {\n  return key in obj ? __defProp(obj, key, {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: value\n  }) : obj[key] = value;\n};\n\nvar __publicField = function __publicField(obj, key, value) {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n\n  return value;\n};\n\nimport { Vector3, Color, Vector2, BufferGeometry, Float32BufferAttribute } from \"three\";\n\nvar TessellateModifier = function TessellateModifier() {\n  var _this = this;\n\n  var maxEdgeLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0.1;\n  var maxIterations = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 6;\n\n  _classCallCheck(this, TessellateModifier);\n\n  __publicField(this, \"maxEdgeLength\");\n\n  __publicField(this, \"maxIterations\");\n\n  __publicField(this, \"modify\", function (geometry) {\n    if (geometry.index !== null) {\n      geometry = geometry.toNonIndexed();\n    }\n\n    var maxIterations = _this.maxIterations;\n    var maxEdgeLengthSquared = _this.maxEdgeLength * _this.maxEdgeLength;\n    var va = new Vector3();\n    var vb = new Vector3();\n    var vc = new Vector3();\n    var vm = new Vector3();\n    var vs = [va, vb, vc, vm];\n    var na = new Vector3();\n    var nb = new Vector3();\n    var nc = new Vector3();\n    var nm = new Vector3();\n    var ns = [na, nb, nc, nm];\n    var ca = new Color();\n    var cb = new Color();\n    var cc = new Color();\n    var cm = new Color();\n    var cs = [ca, cb, cc, cm];\n    var ua = new Vector2();\n    var ub = new Vector2();\n    var uc = new Vector2();\n    var um = new Vector2();\n    var us = [ua, ub, uc, um];\n    var u2a = new Vector2();\n    var u2b = new Vector2();\n    var u2c = new Vector2();\n    var u2m = new Vector2();\n    var u2s = [u2a, u2b, u2c, u2m];\n    var attributes = geometry.attributes;\n    var hasNormals = attributes.normal !== void 0;\n    var hasColors = attributes.color !== void 0;\n    var hasUVs = attributes.uv !== void 0;\n    var hasUV2s = attributes.uv2 !== void 0;\n    var positions = attributes.position.array;\n    var normals = hasNormals ? attributes.normal.array : null;\n    var colors = hasColors ? attributes.color.array : null;\n    var uvs = hasUVs ? attributes.uv.array : null;\n    var uv2s = hasUV2s ? attributes.uv2.array : null;\n    var positions2 = positions;\n    var normals2 = normals;\n    var colors2 = colors;\n    var uvs2 = uvs;\n    var uv2s2 = uv2s;\n    var iteration = 0;\n    var tessellating = true;\n\n    function addTriangle(a, b, c) {\n      var v1 = vs[a];\n      var v2 = vs[b];\n      var v3 = vs[c];\n      positions2.push(v1.x, v1.y, v1.z);\n      positions2.push(v2.x, v2.y, v2.z);\n      positions2.push(v3.x, v3.y, v3.z);\n\n      if (hasNormals) {\n        var n1 = ns[a];\n        var n2 = ns[b];\n        var n3 = ns[c];\n        normals2.push(n1.x, n1.y, n1.z);\n        normals2.push(n2.x, n2.y, n2.z);\n        normals2.push(n3.x, n3.y, n3.z);\n      }\n\n      if (hasColors) {\n        var c1 = cs[a];\n        var c2 = cs[b];\n        var c3 = cs[c];\n        colors2.push(c1.r, c1.g, c1.b);\n        colors2.push(c2.r, c2.g, c2.b);\n        colors2.push(c3.r, c3.g, c3.b);\n      }\n\n      if (hasUVs) {\n        var u1 = us[a];\n        var u2 = us[b];\n        var u3 = us[c];\n        uvs2.push(u1.x, u1.y);\n        uvs2.push(u2.x, u2.y);\n        uvs2.push(u3.x, u3.y);\n      }\n\n      if (hasUV2s) {\n        var u21 = u2s[a];\n        var u22 = u2s[b];\n        var u23 = u2s[c];\n        uv2s2.push(u21.x, u21.y);\n        uv2s2.push(u22.x, u22.y);\n        uv2s2.push(u23.x, u23.y);\n      }\n    }\n\n    while (tessellating && iteration < maxIterations) {\n      iteration++;\n      tessellating = false;\n      positions = positions2;\n      positions2 = [];\n\n      if (hasNormals) {\n        normals = normals2;\n        normals2 = [];\n      }\n\n      if (hasColors) {\n        colors = colors2;\n        colors2 = [];\n      }\n\n      if (hasUVs) {\n        uvs = uvs2;\n        uvs2 = [];\n      }\n\n      if (hasUV2s) {\n        uv2s = uv2s2;\n        uv2s2 = [];\n      }\n\n      for (var i = 0, i2 = 0, il = positions.length; i < il; i += 9, i2 += 6) {\n        va.fromArray(positions, i + 0);\n        vb.fromArray(positions, i + 3);\n        vc.fromArray(positions, i + 6);\n\n        if (hasNormals && normals) {\n          na.fromArray(normals, i + 0);\n          nb.fromArray(normals, i + 3);\n          nc.fromArray(normals, i + 6);\n        }\n\n        if (hasColors && colors) {\n          ca.fromArray(colors, i + 0);\n          cb.fromArray(colors, i + 3);\n          cc.fromArray(colors, i + 6);\n        }\n\n        if (hasUVs && uvs) {\n          ua.fromArray(uvs, i2 + 0);\n          ub.fromArray(uvs, i2 + 2);\n          uc.fromArray(uvs, i2 + 4);\n        }\n\n        if (hasUV2s && uv2s) {\n          u2a.fromArray(uv2s, i2 + 0);\n          u2b.fromArray(uv2s, i2 + 2);\n          u2c.fromArray(uv2s, i2 + 4);\n        }\n\n        var dab = va.distanceToSquared(vb);\n        var dbc = vb.distanceToSquared(vc);\n        var dac = va.distanceToSquared(vc);\n\n        if (dab > maxEdgeLengthSquared || dbc > maxEdgeLengthSquared || dac > maxEdgeLengthSquared) {\n          tessellating = true;\n\n          if (dab >= dbc && dab >= dac) {\n            vm.lerpVectors(va, vb, 0.5);\n            if (hasNormals) nm.lerpVectors(na, nb, 0.5);\n            if (hasColors) cm.lerpColors(ca, cb, 0.5);\n            if (hasUVs) um.lerpVectors(ua, ub, 0.5);\n            if (hasUV2s) u2m.lerpVectors(u2a, u2b, 0.5);\n            addTriangle(0, 3, 2);\n            addTriangle(3, 1, 2);\n          } else if (dbc >= dab && dbc >= dac) {\n            vm.lerpVectors(vb, vc, 0.5);\n            if (hasNormals) nm.lerpVectors(nb, nc, 0.5);\n            if (hasColors) cm.lerpColors(cb, cc, 0.5);\n            if (hasUVs) um.lerpVectors(ub, uc, 0.5);\n            if (hasUV2s) u2m.lerpVectors(u2b, u2c, 0.5);\n            addTriangle(0, 1, 3);\n            addTriangle(3, 2, 0);\n          } else {\n            vm.lerpVectors(va, vc, 0.5);\n            if (hasNormals) nm.lerpVectors(na, nc, 0.5);\n            if (hasColors) cm.lerpColors(ca, cc, 0.5);\n            if (hasUVs) um.lerpVectors(ua, uc, 0.5);\n            if (hasUV2s) u2m.lerpVectors(u2a, u2c, 0.5);\n            addTriangle(0, 1, 3);\n            addTriangle(3, 1, 2);\n          }\n        } else {\n          addTriangle(0, 1, 2);\n        }\n      }\n    }\n\n    var geometry2 = new BufferGeometry();\n    geometry2.setAttribute(\"position\", new Float32BufferAttribute(positions2, 3));\n\n    if (hasNormals) {\n      geometry2.setAttribute(\"normal\", new Float32BufferAttribute(normals2, 3));\n    }\n\n    if (hasColors) {\n      geometry2.setAttribute(\"color\", new Float32BufferAttribute(colors2, 3));\n    }\n\n    if (hasUVs) {\n      geometry2.setAttribute(\"uv\", new Float32BufferAttribute(uvs2, 2));\n    }\n\n    if (hasUV2s) {\n      geometry2.setAttribute(\"uv2\", new Float32BufferAttribute(uv2s2, 2));\n    }\n\n    return geometry2;\n  });\n\n  this.maxEdgeLength = maxEdgeLength;\n  this.maxIterations = maxIterations;\n};\n\nexport { TessellateModifier };","map":{"version":3,"sources":["/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/three-stdlib/modifiers/TessellateModifier.js"],"names":["__defProp","Object","defineProperty","__defNormalProp","obj","key","value","enumerable","configurable","writable","__publicField","Vector3","Color","Vector2","BufferGeometry","Float32BufferAttribute","TessellateModifier","maxEdgeLength","maxIterations","geometry","index","toNonIndexed","maxEdgeLengthSquared","va","vb","vc","vm","vs","na","nb","nc","nm","ns","ca","cb","cc","cm","cs","ua","ub","uc","um","us","u2a","u2b","u2c","u2m","u2s","attributes","hasNormals","normal","hasColors","color","hasUVs","uv","hasUV2s","uv2","positions","position","array","normals","colors","uvs","uv2s","positions2","normals2","colors2","uvs2","uv2s2","iteration","tessellating","addTriangle","a","b","c","v1","v2","v3","push","x","y","z","n1","n2","n3","c1","c2","c3","r","g","u1","u2","u3","u21","u22","u23","i","i2","il","length","fromArray","dab","distanceToSquared","dbc","dac","lerpVectors","lerpColors","geometry2","setAttribute"],"mappings":"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","sourcesContent":["var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nimport { Vector3, Color, Vector2, BufferGeometry, Float32BufferAttribute } from \"three\";\nclass TessellateModifier {\n  constructor(maxEdgeLength = 0.1, maxIterations = 6) {\n    __publicField(this, \"maxEdgeLength\");\n    __publicField(this, \"maxIterations\");\n    __publicField(this, \"modify\", (geometry) => {\n      if (geometry.index !== null) {\n        geometry = geometry.toNonIndexed();\n      }\n      const maxIterations = this.maxIterations;\n      const maxEdgeLengthSquared = this.maxEdgeLength * this.maxEdgeLength;\n      const va = new Vector3();\n      const vb = new Vector3();\n      const vc = new Vector3();\n      const vm = new Vector3();\n      const vs = [va, vb, vc, vm];\n      const na = new Vector3();\n      const nb = new Vector3();\n      const nc = new Vector3();\n      const nm = new Vector3();\n      const ns = [na, nb, nc, nm];\n      const ca = new Color();\n      const cb = new Color();\n      const cc = new Color();\n      const cm = new Color();\n      const cs = [ca, cb, cc, cm];\n      const ua = new Vector2();\n      const ub = new Vector2();\n      const uc = new Vector2();\n      const um = new Vector2();\n      const us = [ua, ub, uc, um];\n      const u2a = new Vector2();\n      const u2b = new Vector2();\n      const u2c = new Vector2();\n      const u2m = new Vector2();\n      const u2s = [u2a, u2b, u2c, u2m];\n      const attributes = geometry.attributes;\n      const hasNormals = attributes.normal !== void 0;\n      const hasColors = attributes.color !== void 0;\n      const hasUVs = attributes.uv !== void 0;\n      const hasUV2s = attributes.uv2 !== void 0;\n      let positions = attributes.position.array;\n      let normals = hasNormals ? attributes.normal.array : null;\n      let colors = hasColors ? attributes.color.array : null;\n      let uvs = hasUVs ? attributes.uv.array : null;\n      let uv2s = hasUV2s ? attributes.uv2.array : null;\n      let positions2 = positions;\n      let normals2 = normals;\n      let colors2 = colors;\n      let uvs2 = uvs;\n      let uv2s2 = uv2s;\n      let iteration = 0;\n      let tessellating = true;\n      function addTriangle(a, b, c) {\n        const v1 = vs[a];\n        const v2 = vs[b];\n        const v3 = vs[c];\n        positions2.push(v1.x, v1.y, v1.z);\n        positions2.push(v2.x, v2.y, v2.z);\n        positions2.push(v3.x, v3.y, v3.z);\n        if (hasNormals) {\n          const n1 = ns[a];\n          const n2 = ns[b];\n          const n3 = ns[c];\n          normals2.push(n1.x, n1.y, n1.z);\n          normals2.push(n2.x, n2.y, n2.z);\n          normals2.push(n3.x, n3.y, n3.z);\n        }\n        if (hasColors) {\n          const c1 = cs[a];\n          const c2 = cs[b];\n          const c3 = cs[c];\n          colors2.push(c1.r, c1.g, c1.b);\n          colors2.push(c2.r, c2.g, c2.b);\n          colors2.push(c3.r, c3.g, c3.b);\n        }\n        if (hasUVs) {\n          const u1 = us[a];\n          const u2 = us[b];\n          const u3 = us[c];\n          uvs2.push(u1.x, u1.y);\n          uvs2.push(u2.x, u2.y);\n          uvs2.push(u3.x, u3.y);\n        }\n        if (hasUV2s) {\n          const u21 = u2s[a];\n          const u22 = u2s[b];\n          const u23 = u2s[c];\n          uv2s2.push(u21.x, u21.y);\n          uv2s2.push(u22.x, u22.y);\n          uv2s2.push(u23.x, u23.y);\n        }\n      }\n      while (tessellating && iteration < maxIterations) {\n        iteration++;\n        tessellating = false;\n        positions = positions2;\n        positions2 = [];\n        if (hasNormals) {\n          normals = normals2;\n          normals2 = [];\n        }\n        if (hasColors) {\n          colors = colors2;\n          colors2 = [];\n        }\n        if (hasUVs) {\n          uvs = uvs2;\n          uvs2 = [];\n        }\n        if (hasUV2s) {\n          uv2s = uv2s2;\n          uv2s2 = [];\n        }\n        for (let i = 0, i2 = 0, il = positions.length; i < il; i += 9, i2 += 6) {\n          va.fromArray(positions, i + 0);\n          vb.fromArray(positions, i + 3);\n          vc.fromArray(positions, i + 6);\n          if (hasNormals && normals) {\n            na.fromArray(normals, i + 0);\n            nb.fromArray(normals, i + 3);\n            nc.fromArray(normals, i + 6);\n          }\n          if (hasColors && colors) {\n            ca.fromArray(colors, i + 0);\n            cb.fromArray(colors, i + 3);\n            cc.fromArray(colors, i + 6);\n          }\n          if (hasUVs && uvs) {\n            ua.fromArray(uvs, i2 + 0);\n            ub.fromArray(uvs, i2 + 2);\n            uc.fromArray(uvs, i2 + 4);\n          }\n          if (hasUV2s && uv2s) {\n            u2a.fromArray(uv2s, i2 + 0);\n            u2b.fromArray(uv2s, i2 + 2);\n            u2c.fromArray(uv2s, i2 + 4);\n          }\n          const dab = va.distanceToSquared(vb);\n          const dbc = vb.distanceToSquared(vc);\n          const dac = va.distanceToSquared(vc);\n          if (dab > maxEdgeLengthSquared || dbc > maxEdgeLengthSquared || dac > maxEdgeLengthSquared) {\n            tessellating = true;\n            if (dab >= dbc && dab >= dac) {\n              vm.lerpVectors(va, vb, 0.5);\n              if (hasNormals)\n                nm.lerpVectors(na, nb, 0.5);\n              if (hasColors)\n                cm.lerpColors(ca, cb, 0.5);\n              if (hasUVs)\n                um.lerpVectors(ua, ub, 0.5);\n              if (hasUV2s)\n                u2m.lerpVectors(u2a, u2b, 0.5);\n              addTriangle(0, 3, 2);\n              addTriangle(3, 1, 2);\n            } else if (dbc >= dab && dbc >= dac) {\n              vm.lerpVectors(vb, vc, 0.5);\n              if (hasNormals)\n                nm.lerpVectors(nb, nc, 0.5);\n              if (hasColors)\n                cm.lerpColors(cb, cc, 0.5);\n              if (hasUVs)\n                um.lerpVectors(ub, uc, 0.5);\n              if (hasUV2s)\n                u2m.lerpVectors(u2b, u2c, 0.5);\n              addTriangle(0, 1, 3);\n              addTriangle(3, 2, 0);\n            } else {\n              vm.lerpVectors(va, vc, 0.5);\n              if (hasNormals)\n                nm.lerpVectors(na, nc, 0.5);\n              if (hasColors)\n                cm.lerpColors(ca, cc, 0.5);\n              if (hasUVs)\n                um.lerpVectors(ua, uc, 0.5);\n              if (hasUV2s)\n                u2m.lerpVectors(u2a, u2c, 0.5);\n              addTriangle(0, 1, 3);\n              addTriangle(3, 1, 2);\n            }\n          } else {\n            addTriangle(0, 1, 2);\n          }\n        }\n      }\n      const geometry2 = new BufferGeometry();\n      geometry2.setAttribute(\"position\", new Float32BufferAttribute(positions2, 3));\n      if (hasNormals) {\n        geometry2.setAttribute(\"normal\", new Float32BufferAttribute(normals2, 3));\n      }\n      if (hasColors) {\n        geometry2.setAttribute(\"color\", new Float32BufferAttribute(colors2, 3));\n      }\n      if (hasUVs) {\n        geometry2.setAttribute(\"uv\", new Float32BufferAttribute(uvs2, 2));\n      }\n      if (hasUV2s) {\n        geometry2.setAttribute(\"uv2\", new Float32BufferAttribute(uv2s2, 2));\n      }\n      return geometry2;\n    });\n    this.maxEdgeLength = maxEdgeLength;\n    this.maxIterations = maxIterations;\n  }\n}\nexport {\n  TessellateModifier\n};\n"]},"metadata":{},"sourceType":"module"}