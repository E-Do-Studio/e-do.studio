{"ast":null,"code":"import _classCallCheck from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/theodaguier/Repositories/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport { Loader, FileLoader } from \"three\";\nimport { parse as _parse } from \"opentype.js\";\n\nvar TTFLoader = /*#__PURE__*/function (_Loader) {\n  _inherits(TTFLoader, _Loader);\n\n  var _super = _createSuper(TTFLoader);\n\n  function TTFLoader(manager) {\n    var _this;\n\n    _classCallCheck(this, TTFLoader);\n\n    _this = _super.call(this, manager);\n    _this.reversed = false;\n    return _this;\n  }\n\n  _createClass(TTFLoader, [{\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var loader = new FileLoader(this.manager);\n      loader.setPath(this.path);\n      loader.setResponseType(\"arraybuffer\");\n      loader.setRequestHeader(this.requestHeader);\n      loader.setWithCredentials(this.withCredentials);\n      loader.load(url, function (buffer) {\n        try {\n          onLoad(_parse(buffer));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n\n          scope.manager.itemError(url);\n        }\n      }, onProgress, onError);\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(arraybuffer) {\n      function convert(font, reversed) {\n        var round = Math.round;\n        var glyphs = {};\n        var scale = 1e5 / ((font.unitsPerEm || 2048) * 72);\n        var glyphIndexMap = font.encoding.cmap.glyphIndexMap;\n        var unicodes = Object.keys(glyphIndexMap);\n\n        for (var i = 0; i < unicodes.length; i++) {\n          var unicode = unicodes[i];\n          var glyph = font.glyphs.glyphs[glyphIndexMap[unicode]];\n\n          if (unicode !== void 0) {\n            (function () {\n              var token = {\n                ha: round(glyph.advanceWidth * scale),\n                x_min: round(glyph.xMin * scale),\n                x_max: round(glyph.xMax * scale),\n                o: \"\"\n              };\n\n              if (reversed) {\n                glyph.path.commands = reverseCommands(glyph.path.commands);\n              }\n\n              glyph.path.commands.forEach(function (command) {\n                if (command.type.toLowerCase() === \"c\") {\n                  command.type = \"b\";\n                }\n\n                token.o += command.type.toLowerCase() + \" \";\n\n                if (command.x !== void 0 && command.y !== void 0) {\n                  token.o += round(command.x * scale) + \" \" + round(command.y * scale) + \" \";\n                }\n\n                if (command.x1 !== void 0 && command.y1 !== void 0) {\n                  token.o += round(command.x1 * scale) + \" \" + round(command.y1 * scale) + \" \";\n                }\n\n                if (command.x2 !== void 0 && command.y2 !== void 0) {\n                  token.o += round(command.x2 * scale) + \" \" + round(command.y2 * scale) + \" \";\n                }\n              });\n              glyphs[String.fromCodePoint(glyph.unicode)] = token;\n            })();\n          }\n        }\n\n        return {\n          glyphs: glyphs,\n          familyName: font.getEnglishName(\"fullName\"),\n          ascender: round(font.ascender * scale),\n          descender: round(font.descender * scale),\n          underlinePosition: font.tables.post.underlinePosition,\n          underlineThickness: font.tables.post.underlineThickness,\n          boundingBox: {\n            xMin: font.tables.head.xMin,\n            xMax: font.tables.head.xMax,\n            yMin: font.tables.head.yMin,\n            yMax: font.tables.head.yMax\n          },\n          resolution: 1e3,\n          original_font_information: font.tables.name\n        };\n      }\n\n      function reverseCommands(commands) {\n        var paths = [];\n        var path;\n        commands.forEach(function (c) {\n          if (c.type.toLowerCase() === \"m\") {\n            path = [c];\n            paths.push(path);\n          } else if (c.type.toLowerCase() !== \"z\") {\n            path.push(c);\n          }\n        });\n        var reversed = [];\n        paths.forEach(function (p) {\n          var result = {\n            type: \"m\",\n            x: p[p.length - 1].x,\n            y: p[p.length - 1].y\n          };\n          reversed.push(result);\n\n          for (var i = p.length - 1; i > 0; i--) {\n            var command = p[i];\n            var result2 = {\n              type: command.type\n            };\n\n            if (command.x2 !== void 0 && command.y2 !== void 0) {\n              result2.x1 = command.x2;\n              result2.y1 = command.y2;\n              result2.x2 = command.x1;\n              result2.y2 = command.y1;\n            } else if (command.x1 !== void 0 && command.y1 !== void 0) {\n              result2.x1 = command.x1;\n              result2.y1 = command.y1;\n            }\n\n            result2.x = p[i - 1].x;\n            result2.y = p[i - 1].y;\n            reversed.push(result2);\n          }\n        });\n        return reversed;\n      }\n\n      return convert(_parse(arraybuffer), this.reversed);\n    }\n  }]);\n\n  return TTFLoader;\n}(Loader);\n\nexport { TTFLoader };","map":{"version":3,"sources":["/Users/theodaguier/Repositories/E-Do-Studio/node_modules/three-stdlib/loaders/TTFLoader.js"],"names":["Loader","FileLoader","parse","TTFLoader","manager","reversed","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","load","buffer","e","console","error","itemError","arraybuffer","convert","font","round","Math","glyphs","scale","unitsPerEm","glyphIndexMap","encoding","cmap","unicodes","Object","keys","i","length","unicode","glyph","token","ha","advanceWidth","x_min","xMin","x_max","xMax","o","commands","reverseCommands","forEach","command","type","toLowerCase","x","y","x1","y1","x2","y2","String","fromCodePoint","familyName","getEnglishName","ascender","descender","underlinePosition","tables","post","underlineThickness","boundingBox","head","yMin","yMax","resolution","original_font_information","name","paths","c","push","p","result","result2"],"mappings":"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","sourcesContent":["import { Loader, FileLoader } from \"three\";\nimport { parse } from \"opentype.js\";\nclass TTFLoader extends Loader {\n  constructor(manager) {\n    super(manager);\n    this.reversed = false;\n  }\n  load(url, onLoad, onProgress, onError) {\n    const scope = this;\n    const loader = new FileLoader(this.manager);\n    loader.setPath(this.path);\n    loader.setResponseType(\"arraybuffer\");\n    loader.setRequestHeader(this.requestHeader);\n    loader.setWithCredentials(this.withCredentials);\n    loader.load(\n      url,\n      function(buffer) {\n        try {\n          onLoad(parse(buffer));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n          scope.manager.itemError(url);\n        }\n      },\n      onProgress,\n      onError\n    );\n  }\n  parse(arraybuffer) {\n    function convert(font, reversed) {\n      const round = Math.round;\n      const glyphs = {};\n      const scale = 1e5 / ((font.unitsPerEm || 2048) * 72);\n      const glyphIndexMap = font.encoding.cmap.glyphIndexMap;\n      const unicodes = Object.keys(glyphIndexMap);\n      for (let i = 0; i < unicodes.length; i++) {\n        const unicode = unicodes[i];\n        const glyph = font.glyphs.glyphs[glyphIndexMap[unicode]];\n        if (unicode !== void 0) {\n          const token = {\n            ha: round(glyph.advanceWidth * scale),\n            x_min: round(glyph.xMin * scale),\n            x_max: round(glyph.xMax * scale),\n            o: \"\"\n          };\n          if (reversed) {\n            glyph.path.commands = reverseCommands(glyph.path.commands);\n          }\n          glyph.path.commands.forEach(function(command) {\n            if (command.type.toLowerCase() === \"c\") {\n              command.type = \"b\";\n            }\n            token.o += command.type.toLowerCase() + \" \";\n            if (command.x !== void 0 && command.y !== void 0) {\n              token.o += round(command.x * scale) + \" \" + round(command.y * scale) + \" \";\n            }\n            if (command.x1 !== void 0 && command.y1 !== void 0) {\n              token.o += round(command.x1 * scale) + \" \" + round(command.y1 * scale) + \" \";\n            }\n            if (command.x2 !== void 0 && command.y2 !== void 0) {\n              token.o += round(command.x2 * scale) + \" \" + round(command.y2 * scale) + \" \";\n            }\n          });\n          glyphs[String.fromCodePoint(glyph.unicode)] = token;\n        }\n      }\n      return {\n        glyphs,\n        familyName: font.getEnglishName(\"fullName\"),\n        ascender: round(font.ascender * scale),\n        descender: round(font.descender * scale),\n        underlinePosition: font.tables.post.underlinePosition,\n        underlineThickness: font.tables.post.underlineThickness,\n        boundingBox: {\n          xMin: font.tables.head.xMin,\n          xMax: font.tables.head.xMax,\n          yMin: font.tables.head.yMin,\n          yMax: font.tables.head.yMax\n        },\n        resolution: 1e3,\n        original_font_information: font.tables.name\n      };\n    }\n    function reverseCommands(commands) {\n      const paths = [];\n      let path;\n      commands.forEach(function(c) {\n        if (c.type.toLowerCase() === \"m\") {\n          path = [c];\n          paths.push(path);\n        } else if (c.type.toLowerCase() !== \"z\") {\n          path.push(c);\n        }\n      });\n      const reversed = [];\n      paths.forEach(function(p) {\n        const result = {\n          type: \"m\",\n          x: p[p.length - 1].x,\n          y: p[p.length - 1].y\n        };\n        reversed.push(result);\n        for (let i = p.length - 1; i > 0; i--) {\n          const command = p[i];\n          const result2 = { type: command.type };\n          if (command.x2 !== void 0 && command.y2 !== void 0) {\n            result2.x1 = command.x2;\n            result2.y1 = command.y2;\n            result2.x2 = command.x1;\n            result2.y2 = command.y1;\n          } else if (command.x1 !== void 0 && command.y1 !== void 0) {\n            result2.x1 = command.x1;\n            result2.y1 = command.y1;\n          }\n          result2.x = p[i - 1].x;\n          result2.y = p[i - 1].y;\n          reversed.push(result2);\n        }\n      });\n      return reversed;\n    }\n    return convert(parse(arraybuffer), this.reversed);\n  }\n}\nexport {\n  TTFLoader\n};\n"]},"metadata":{},"sourceType":"module"}