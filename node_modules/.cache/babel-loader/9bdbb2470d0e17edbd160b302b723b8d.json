{"ast":null,"code":"import _classCallCheck from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport { Loader, LoaderUtils, FileLoader, Group, MeshPhongMaterial, DoubleSide, AdditiveBlending, BufferGeometry, Mesh, Float32BufferAttribute, Matrix4, TextureLoader, Color } from \"three\";\n\nvar TDSLoader = /*#__PURE__*/function (_Loader) {\n  _inherits(TDSLoader, _Loader);\n\n  var _super = _createSuper(TDSLoader);\n\n  function TDSLoader(manager) {\n    var _this;\n\n    _classCallCheck(this, TDSLoader);\n\n    _this = _super.call(this, manager);\n    _this.debug = false;\n    _this.group = null;\n    _this.position = 0;\n    _this.materials = [];\n    _this.meshes = [];\n    return _this;\n  }\n  /**\n   * Load 3ds file from url.\n   *\n   * @method load\n   * @param {[type]} url URL for the file.\n   * @param {Function} onLoad onLoad callback, receives group Object3D as argument.\n   * @param {Function} onProgress onProgress callback.\n   * @param {Function} onError onError callback.\n   */\n\n\n  _createClass(TDSLoader, [{\n    key: \"load\",\n    value: function load(url, onLoad, onProgress, onError) {\n      var scope = this;\n      var path = this.path === \"\" ? LoaderUtils.extractUrlBase(url) : this.path;\n      var loader = new FileLoader(this.manager);\n      loader.setPath(this.path);\n      loader.setResponseType(\"arraybuffer\");\n      loader.setRequestHeader(this.requestHeader);\n      loader.setWithCredentials(this.withCredentials);\n      loader.load(url, function (data) {\n        try {\n          onLoad(scope.parse(data, path));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n\n          scope.manager.itemError(url);\n        }\n      }, onProgress, onError);\n    }\n    /**\n     * Parse arraybuffer data and load 3ds file.\n     *\n     * @method parse\n     * @param {ArrayBuffer} arraybuffer Arraybuffer data to be loaded.\n     * @param {String} path Path for external resources.\n     * @return {Group} Group loaded from 3ds file.\n     */\n\n  }, {\n    key: \"parse\",\n    value: function parse(arraybuffer, path) {\n      this.group = new Group();\n      this.position = 0;\n      this.materials = [];\n      this.meshes = [];\n      this.readFile(arraybuffer, path);\n\n      for (var i = 0; i < this.meshes.length; i++) {\n        this.group.add(this.meshes[i]);\n      }\n\n      return this.group;\n    }\n    /**\n     * Decode file content to read 3ds data.\n     *\n     * @method readFile\n     * @param {ArrayBuffer} arraybuffer Arraybuffer data to be loaded.\n     * @param {String} path Path for external resources.\n     */\n\n  }, {\n    key: \"readFile\",\n    value: function readFile(arraybuffer, path) {\n      var data = new DataView(arraybuffer);\n      var chunk = this.readChunk(data);\n\n      if (chunk.id === MLIBMAGIC || chunk.id === CMAGIC || chunk.id === M3DMAGIC) {\n        var next = this.nextChunk(data, chunk);\n\n        while (next !== 0) {\n          if (next === M3D_VERSION) {\n            var version = this.readDWord(data);\n            this.debugMessage(\"3DS file version: \" + version);\n          } else if (next === MDATA) {\n            this.resetPosition(data);\n            this.readMeshData(data, path);\n          } else {\n            this.debugMessage(\"Unknown main chunk: \" + next.toString(16));\n          }\n\n          next = this.nextChunk(data, chunk);\n        }\n      }\n\n      this.debugMessage(\"Parsed \" + this.meshes.length + \" meshes\");\n    }\n    /**\n     * Read mesh data chunk.\n     *\n     * @method readMeshData\n     * @param {Dataview} data Dataview in use.\n     * @param {String} path Path for external resources.\n     */\n\n  }, {\n    key: \"readMeshData\",\n    value: function readMeshData(data, path) {\n      var chunk = this.readChunk(data);\n      var next = this.nextChunk(data, chunk);\n\n      while (next !== 0) {\n        if (next === MESH_VERSION) {\n          var version = +this.readDWord(data);\n          this.debugMessage(\"Mesh Version: \" + version);\n        } else if (next === MASTER_SCALE) {\n          var scale = this.readFloat(data);\n          this.debugMessage(\"Master scale: \" + scale);\n          this.group.scale.set(scale, scale, scale);\n        } else if (next === NAMED_OBJECT) {\n          this.debugMessage(\"Named Object\");\n          this.resetPosition(data);\n          this.readNamedObject(data);\n        } else if (next === MAT_ENTRY) {\n          this.debugMessage(\"Material\");\n          this.resetPosition(data);\n          this.readMaterialEntry(data, path);\n        } else {\n          this.debugMessage(\"Unknown MDATA chunk: \" + next.toString(16));\n        }\n\n        next = this.nextChunk(data, chunk);\n      }\n    }\n    /**\n     * Read named object chunk.\n     *\n     * @method readNamedObject\n     * @param {Dataview} data Dataview in use.\n     */\n\n  }, {\n    key: \"readNamedObject\",\n    value: function readNamedObject(data) {\n      var chunk = this.readChunk(data);\n      var name = this.readString(data, 64);\n      chunk.cur = this.position;\n      var next = this.nextChunk(data, chunk);\n\n      while (next !== 0) {\n        if (next === N_TRI_OBJECT) {\n          this.resetPosition(data);\n          var mesh = this.readMesh(data);\n          mesh.name = name;\n          this.meshes.push(mesh);\n        } else {\n          this.debugMessage(\"Unknown named object chunk: \" + next.toString(16));\n        }\n\n        next = this.nextChunk(data, chunk);\n      }\n\n      this.endChunk(chunk);\n    }\n    /**\n     * Read material data chunk and add it to the material list.\n     *\n     * @method readMaterialEntry\n     * @param {Dataview} data Dataview in use.\n     * @param {String} path Path for external resources.\n     */\n\n  }, {\n    key: \"readMaterialEntry\",\n    value: function readMaterialEntry(data, path) {\n      var chunk = this.readChunk(data);\n      var next = this.nextChunk(data, chunk);\n      var material = new MeshPhongMaterial();\n\n      while (next !== 0) {\n        if (next === MAT_NAME) {\n          material.name = this.readString(data, 64);\n          this.debugMessage(\"   Name: \" + material.name);\n        } else if (next === MAT_WIRE) {\n          this.debugMessage(\"   Wireframe\");\n          material.wireframe = true;\n        } else if (next === MAT_WIRE_SIZE) {\n          var value = this.readByte(data);\n          material.wireframeLinewidth = value;\n          this.debugMessage(\"   Wireframe Thickness: \" + value);\n        } else if (next === MAT_TWO_SIDE) {\n          material.side = DoubleSide;\n          this.debugMessage(\"   DoubleSided\");\n        } else if (next === MAT_ADDITIVE) {\n          this.debugMessage(\"   Additive Blending\");\n          material.blending = AdditiveBlending;\n        } else if (next === MAT_DIFFUSE) {\n          this.debugMessage(\"   Diffuse Color\");\n          material.color = this.readColor(data);\n        } else if (next === MAT_SPECULAR) {\n          this.debugMessage(\"   Specular Color\");\n          material.specular = this.readColor(data);\n        } else if (next === MAT_AMBIENT) {\n          this.debugMessage(\"   Ambient color\");\n          material.color = this.readColor(data);\n        } else if (next === MAT_SHININESS) {\n          var shininess = this.readPercentage(data);\n          material.shininess = shininess * 100;\n          this.debugMessage(\"   Shininess : \" + shininess);\n        } else if (next === MAT_TRANSPARENCY) {\n          var transparency = this.readPercentage(data);\n          material.opacity = 1 - transparency;\n          this.debugMessage(\"  Transparency : \" + transparency);\n          material.transparent = material.opacity < 1 ? true : false;\n        } else if (next === MAT_TEXMAP) {\n          this.debugMessage(\"   ColorMap\");\n          this.resetPosition(data);\n          material.map = this.readMap(data, path);\n        } else if (next === MAT_BUMPMAP) {\n          this.debugMessage(\"   BumpMap\");\n          this.resetPosition(data);\n          material.bumpMap = this.readMap(data, path);\n        } else if (next === MAT_OPACMAP) {\n          this.debugMessage(\"   OpacityMap\");\n          this.resetPosition(data);\n          material.alphaMap = this.readMap(data, path);\n        } else if (next === MAT_SPECMAP) {\n          this.debugMessage(\"   SpecularMap\");\n          this.resetPosition(data);\n          material.specularMap = this.readMap(data, path);\n        } else {\n          this.debugMessage(\"   Unknown material chunk: \" + next.toString(16));\n        }\n\n        next = this.nextChunk(data, chunk);\n      }\n\n      this.endChunk(chunk);\n      this.materials[material.name] = material;\n    }\n    /**\n     * Read mesh data chunk.\n     *\n     * @method readMesh\n     * @param {Dataview} data Dataview in use.\n     * @return {Mesh} The parsed mesh.\n     */\n\n  }, {\n    key: \"readMesh\",\n    value: function readMesh(data) {\n      var chunk = this.readChunk(data);\n      var next = this.nextChunk(data, chunk);\n      var geometry = new BufferGeometry();\n      var material = new MeshPhongMaterial();\n      var mesh = new Mesh(geometry, material);\n      mesh.name = \"mesh\";\n\n      while (next !== 0) {\n        if (next === POINT_ARRAY) {\n          var points = this.readWord(data);\n          this.debugMessage(\"   Vertex: \" + points);\n          var vertices = [];\n\n          for (var i = 0; i < points; i++) {\n            vertices.push(this.readFloat(data));\n            vertices.push(this.readFloat(data));\n            vertices.push(this.readFloat(data));\n          }\n\n          geometry.setAttribute(\"position\", new Float32BufferAttribute(vertices, 3));\n        } else if (next === FACE_ARRAY) {\n          this.resetPosition(data);\n          this.readFaceArray(data, mesh);\n        } else if (next === TEX_VERTS) {\n          var texels = this.readWord(data);\n          this.debugMessage(\"   UV: \" + texels);\n          var uvs = [];\n\n          for (var _i = 0; _i < texels; _i++) {\n            uvs.push(this.readFloat(data));\n            uvs.push(this.readFloat(data));\n          }\n\n          geometry.setAttribute(\"uv\", new Float32BufferAttribute(uvs, 2));\n        } else if (next === MESH_MATRIX) {\n          this.debugMessage(\"   Tranformation Matrix (TODO)\");\n          var values = [];\n\n          for (var _i2 = 0; _i2 < 12; _i2++) {\n            values[_i2] = this.readFloat(data);\n          }\n\n          var matrix = new Matrix4();\n          matrix.elements[0] = values[0];\n          matrix.elements[1] = values[6];\n          matrix.elements[2] = values[3];\n          matrix.elements[3] = values[9];\n          matrix.elements[4] = values[2];\n          matrix.elements[5] = values[8];\n          matrix.elements[6] = values[5];\n          matrix.elements[7] = values[11];\n          matrix.elements[8] = values[1];\n          matrix.elements[9] = values[7];\n          matrix.elements[10] = values[4];\n          matrix.elements[11] = values[10];\n          matrix.elements[12] = 0;\n          matrix.elements[13] = 0;\n          matrix.elements[14] = 0;\n          matrix.elements[15] = 1;\n          matrix.transpose();\n          var inverse = new Matrix4();\n          inverse.copy(matrix).invert();\n          geometry.applyMatrix4(inverse);\n          matrix.decompose(mesh.position, mesh.quaternion, mesh.scale);\n        } else {\n          this.debugMessage(\"   Unknown mesh chunk: \" + next.toString(16));\n        }\n\n        next = this.nextChunk(data, chunk);\n      }\n\n      this.endChunk(chunk);\n      geometry.computeVertexNormals();\n      return mesh;\n    }\n    /**\n     * Read face array data chunk.\n     *\n     * @method readFaceArray\n     * @param {Dataview} data Dataview in use.\n     * @param {Mesh} mesh Mesh to be filled with the data read.\n     */\n\n  }, {\n    key: \"readFaceArray\",\n    value: function readFaceArray(data, mesh) {\n      var chunk = this.readChunk(data);\n      var faces = this.readWord(data);\n      this.debugMessage(\"   Faces: \" + faces);\n      var index = [];\n\n      for (var i = 0; i < faces; ++i) {\n        index.push(this.readWord(data), this.readWord(data), this.readWord(data));\n        this.readWord(data);\n      }\n\n      mesh.geometry.setIndex(index);\n      var materialIndex = 0;\n      var start = 0;\n\n      while (this.position < chunk.end) {\n        var subchunk = this.readChunk(data);\n\n        if (subchunk.id === MSH_MAT_GROUP) {\n          this.debugMessage(\"      Material Group\");\n          this.resetPosition(data);\n          var group = this.readMaterialGroup(data);\n          var count = group.index.length * 3;\n          mesh.geometry.addGroup(start, count, materialIndex);\n          start += count;\n          materialIndex++;\n          var material = this.materials[group.name];\n          if (Array.isArray(mesh.material) === false) mesh.material = [];\n\n          if (material !== void 0) {\n            mesh.material.push(material);\n          }\n        } else {\n          this.debugMessage(\"      Unknown face array chunk: \" + subchunk.toString(16));\n        }\n\n        this.endChunk(subchunk);\n      }\n\n      if (mesh.material.length === 1) mesh.material = mesh.material[0];\n      this.endChunk(chunk);\n    }\n    /**\n     * Read texture map data chunk.\n     *\n     * @method readMap\n     * @param {Dataview} data Dataview in use.\n     * @param {String} path Path for external resources.\n     * @return {Texture} Texture read from this data chunk.\n     */\n\n  }, {\n    key: \"readMap\",\n    value: function readMap(data, path) {\n      var chunk = this.readChunk(data);\n      var next = this.nextChunk(data, chunk);\n      var texture = {};\n      var loader = new TextureLoader(this.manager);\n      loader.setPath(this.resourcePath || path).setCrossOrigin(this.crossOrigin);\n\n      while (next !== 0) {\n        if (next === MAT_MAPNAME) {\n          var name = this.readString(data, 128);\n          texture = loader.load(name);\n          this.debugMessage(\"      File: \" + path + name);\n        } else if (next === MAT_MAP_UOFFSET) {\n          texture.offset.x = this.readFloat(data);\n          this.debugMessage(\"      OffsetX: \" + texture.offset.x);\n        } else if (next === MAT_MAP_VOFFSET) {\n          texture.offset.y = this.readFloat(data);\n          this.debugMessage(\"      OffsetY: \" + texture.offset.y);\n        } else if (next === MAT_MAP_USCALE) {\n          texture.repeat.x = this.readFloat(data);\n          this.debugMessage(\"      RepeatX: \" + texture.repeat.x);\n        } else if (next === MAT_MAP_VSCALE) {\n          texture.repeat.y = this.readFloat(data);\n          this.debugMessage(\"      RepeatY: \" + texture.repeat.y);\n        } else {\n          this.debugMessage(\"      Unknown map chunk: \" + next.toString(16));\n        }\n\n        next = this.nextChunk(data, chunk);\n      }\n\n      this.endChunk(chunk);\n      return texture;\n    }\n    /**\n     * Read material group data chunk.\n     *\n     * @method readMaterialGroup\n     * @param {Dataview} data Dataview in use.\n     * @return {Object} Object with name and index of the object.\n     */\n\n  }, {\n    key: \"readMaterialGroup\",\n    value: function readMaterialGroup(data) {\n      this.readChunk(data);\n      var name = this.readString(data, 64);\n      var numFaces = this.readWord(data);\n      this.debugMessage(\"         Name: \" + name);\n      this.debugMessage(\"         Faces: \" + numFaces);\n      var index = [];\n\n      for (var i = 0; i < numFaces; ++i) {\n        index.push(this.readWord(data));\n      }\n\n      return {\n        name: name,\n        index: index\n      };\n    }\n    /**\n     * Read a color value.\n     *\n     * @method readColor\n     * @param {DataView} data Dataview.\n     * @return {Color} Color value read..\n     */\n\n  }, {\n    key: \"readColor\",\n    value: function readColor(data) {\n      var chunk = this.readChunk(data);\n      var color = new Color();\n\n      if (chunk.id === COLOR_24 || chunk.id === LIN_COLOR_24) {\n        var r = this.readByte(data);\n        var g = this.readByte(data);\n        var b = this.readByte(data);\n        color.setRGB(r / 255, g / 255, b / 255);\n        this.debugMessage(\"      Color: \" + color.r + \", \" + color.g + \", \" + color.b);\n      } else if (chunk.id === COLOR_F || chunk.id === LIN_COLOR_F) {\n        var _r = this.readFloat(data);\n\n        var _g = this.readFloat(data);\n\n        var _b = this.readFloat(data);\n\n        color.setRGB(_r, _g, _b);\n        this.debugMessage(\"      Color: \" + color.r + \", \" + color.g + \", \" + color.b);\n      } else {\n        this.debugMessage(\"      Unknown color chunk: \" + chunk.toString(16));\n      }\n\n      this.endChunk(chunk);\n      return color;\n    }\n    /**\n     * Read next chunk of data.\n     *\n     * @method readChunk\n     * @param {DataView} data Dataview.\n     * @return {Object} Chunk of data read.\n     */\n\n  }, {\n    key: \"readChunk\",\n    value: function readChunk(data) {\n      var chunk = {};\n      chunk.cur = this.position;\n      chunk.id = this.readWord(data);\n      chunk.size = this.readDWord(data);\n      chunk.end = chunk.cur + chunk.size;\n      chunk.cur += 6;\n      return chunk;\n    }\n    /**\n     * Set position to the end of the current chunk of data.\n     *\n     * @method endChunk\n     * @param {Object} chunk Data chunk.\n     */\n\n  }, {\n    key: \"endChunk\",\n    value: function endChunk(chunk) {\n      this.position = chunk.end;\n    }\n    /**\n     * Move to the next data chunk.\n     *\n     * @method nextChunk\n     * @param {DataView} data Dataview.\n     * @param {Object} chunk Data chunk.\n     */\n\n  }, {\n    key: \"nextChunk\",\n    value: function nextChunk(data, chunk) {\n      if (chunk.cur >= chunk.end) {\n        return 0;\n      }\n\n      this.position = chunk.cur;\n\n      try {\n        var next = this.readChunk(data);\n        chunk.cur += next.size;\n        return next.id;\n      } catch (e) {\n        this.debugMessage(\"Unable to read chunk at \" + this.position);\n        return 0;\n      }\n    }\n    /**\n     * Reset dataview position.\n     *\n     * @method resetPosition\n     */\n\n  }, {\n    key: \"resetPosition\",\n    value: function resetPosition() {\n      this.position -= 6;\n    }\n    /**\n     * Read byte value.\n     *\n     * @method readByte\n     * @param {DataView} data Dataview to read data from.\n     * @return {Number} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readByte\",\n    value: function readByte(data) {\n      var v = data.getUint8(this.position, true);\n      this.position += 1;\n      return v;\n    }\n    /**\n     * Read 32 bit float value.\n     *\n     * @method readFloat\n     * @param {DataView} data Dataview to read data from.\n     * @return {Number} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readFloat\",\n    value: function readFloat(data) {\n      try {\n        var v = data.getFloat32(this.position, true);\n        this.position += 4;\n        return v;\n      } catch (e) {\n        this.debugMessage(e + \" \" + this.position + \" \" + data.byteLength);\n      }\n    }\n    /**\n     * Read 32 bit signed integer value.\n     *\n     * @method readInt\n     * @param {DataView} data Dataview to read data from.\n     * @return {Number} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readInt\",\n    value: function readInt(data) {\n      var v = data.getInt32(this.position, true);\n      this.position += 4;\n      return v;\n    }\n    /**\n     * Read 16 bit signed integer value.\n     *\n     * @method readShort\n     * @param {DataView} data Dataview to read data from.\n     * @return {Number} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readShort\",\n    value: function readShort(data) {\n      var v = data.getInt16(this.position, true);\n      this.position += 2;\n      return v;\n    }\n    /**\n     * Read 64 bit unsigned integer value.\n     *\n     * @method readDWord\n     * @param {DataView} data Dataview to read data from.\n     * @return {Number} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readDWord\",\n    value: function readDWord(data) {\n      var v = data.getUint32(this.position, true);\n      this.position += 4;\n      return v;\n    }\n    /**\n     * Read 32 bit unsigned integer value.\n     *\n     * @method readWord\n     * @param {DataView} data Dataview to read data from.\n     * @return {Number} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readWord\",\n    value: function readWord(data) {\n      var v = data.getUint16(this.position, true);\n      this.position += 2;\n      return v;\n    }\n    /**\n     * Read string value.\n     *\n     * @method readString\n     * @param {DataView} data Dataview to read data from.\n     * @param {Number} maxLength Max size of the string to be read.\n     * @return {String} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readString\",\n    value: function readString(data, maxLength) {\n      var s = \"\";\n\n      for (var i = 0; i < maxLength; i++) {\n        var c = this.readByte(data);\n\n        if (!c) {\n          break;\n        }\n\n        s += String.fromCharCode(c);\n      }\n\n      return s;\n    }\n    /**\n     * Read percentage value.\n     *\n     * @method readPercentage\n     * @param {DataView} data Dataview to read data from.\n     * @return {Number} Data read from the dataview.\n     */\n\n  }, {\n    key: \"readPercentage\",\n    value: function readPercentage(data) {\n      var chunk = this.readChunk(data);\n      var value;\n\n      switch (chunk.id) {\n        case INT_PERCENTAGE:\n          value = this.readShort(data) / 100;\n          break;\n\n        case FLOAT_PERCENTAGE:\n          value = this.readFloat(data);\n          break;\n\n        default:\n          this.debugMessage(\"      Unknown percentage chunk: \" + chunk.toString(16));\n      }\n\n      this.endChunk(chunk);\n      return value;\n    }\n    /**\n     * Print debug message to the console.\n     *\n     * Is controlled by a flag to show or hide debug messages.\n     *\n     * @method debugMessage\n     * @param {Object} message Debug message to print to the console.\n     */\n\n  }, {\n    key: \"debugMessage\",\n    value: function debugMessage(message) {\n      if (this.debug) {\n        console.log(message);\n      }\n    }\n  }]);\n\n  return TDSLoader;\n}(Loader);\n\nvar M3DMAGIC = 19789;\nvar MLIBMAGIC = 15786;\nvar CMAGIC = 49725;\nvar M3D_VERSION = 2;\nvar COLOR_F = 16;\nvar COLOR_24 = 17;\nvar LIN_COLOR_24 = 18;\nvar LIN_COLOR_F = 19;\nvar INT_PERCENTAGE = 48;\nvar FLOAT_PERCENTAGE = 49;\nvar MDATA = 15677;\nvar MESH_VERSION = 15678;\nvar MASTER_SCALE = 256;\nvar MAT_ENTRY = 45055;\nvar MAT_NAME = 40960;\nvar MAT_AMBIENT = 40976;\nvar MAT_DIFFUSE = 40992;\nvar MAT_SPECULAR = 41008;\nvar MAT_SHININESS = 41024;\nvar MAT_TRANSPARENCY = 41040;\nvar MAT_TWO_SIDE = 41089;\nvar MAT_ADDITIVE = 41091;\nvar MAT_WIRE = 41093;\nvar MAT_WIRE_SIZE = 41095;\nvar MAT_TEXMAP = 41472;\nvar MAT_OPACMAP = 41488;\nvar MAT_BUMPMAP = 41520;\nvar MAT_SPECMAP = 41476;\nvar MAT_MAPNAME = 41728;\nvar MAT_MAP_USCALE = 41812;\nvar MAT_MAP_VSCALE = 41814;\nvar MAT_MAP_UOFFSET = 41816;\nvar MAT_MAP_VOFFSET = 41818;\nvar NAMED_OBJECT = 16384;\nvar N_TRI_OBJECT = 16640;\nvar POINT_ARRAY = 16656;\nvar FACE_ARRAY = 16672;\nvar MSH_MAT_GROUP = 16688;\nvar TEX_VERTS = 16704;\nvar MESH_MATRIX = 16736;\nexport { TDSLoader };","map":{"version":3,"sources":["/Users/theodaguier/_workdir/dev/pro/e-do/E-Do-Studio/node_modules/three-stdlib/loaders/TDSLoader.js"],"names":["Loader","LoaderUtils","FileLoader","Group","MeshPhongMaterial","DoubleSide","AdditiveBlending","BufferGeometry","Mesh","Float32BufferAttribute","Matrix4","TextureLoader","Color","TDSLoader","manager","debug","group","position","materials","meshes","url","onLoad","onProgress","onError","scope","path","extractUrlBase","loader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","load","data","parse","e","console","error","itemError","arraybuffer","readFile","i","length","add","DataView","chunk","readChunk","id","MLIBMAGIC","CMAGIC","M3DMAGIC","next","nextChunk","M3D_VERSION","version","readDWord","debugMessage","MDATA","resetPosition","readMeshData","toString","MESH_VERSION","MASTER_SCALE","scale","readFloat","set","NAMED_OBJECT","readNamedObject","MAT_ENTRY","readMaterialEntry","name","readString","cur","N_TRI_OBJECT","mesh","readMesh","push","endChunk","material","MAT_NAME","MAT_WIRE","wireframe","MAT_WIRE_SIZE","value","readByte","wireframeLinewidth","MAT_TWO_SIDE","side","MAT_ADDITIVE","blending","MAT_DIFFUSE","color","readColor","MAT_SPECULAR","specular","MAT_AMBIENT","MAT_SHININESS","shininess","readPercentage","MAT_TRANSPARENCY","transparency","opacity","transparent","MAT_TEXMAP","map","readMap","MAT_BUMPMAP","bumpMap","MAT_OPACMAP","alphaMap","MAT_SPECMAP","specularMap","geometry","POINT_ARRAY","points","readWord","vertices","setAttribute","FACE_ARRAY","readFaceArray","TEX_VERTS","texels","uvs","MESH_MATRIX","values","matrix","elements","transpose","inverse","copy","invert","applyMatrix4","decompose","quaternion","computeVertexNormals","faces","index","setIndex","materialIndex","start","end","subchunk","MSH_MAT_GROUP","readMaterialGroup","count","addGroup","Array","isArray","texture","resourcePath","setCrossOrigin","crossOrigin","MAT_MAPNAME","MAT_MAP_UOFFSET","offset","x","MAT_MAP_VOFFSET","y","MAT_MAP_USCALE","repeat","MAT_MAP_VSCALE","numFaces","COLOR_24","LIN_COLOR_24","r","g","b","setRGB","COLOR_F","LIN_COLOR_F","size","v","getUint8","getFloat32","byteLength","getInt32","getInt16","getUint32","getUint16","maxLength","s","c","String","fromCharCode","INT_PERCENTAGE","readShort","FLOAT_PERCENTAGE","message","log"],"mappings":"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","sourcesContent":["import { Loader, LoaderUtils, FileLoader, Group, MeshPhongMaterial, DoubleSide, AdditiveBlending, BufferGeometry, Mesh, Float32BufferAttribute, Matrix4, TextureLoader, Color } from \"three\";\nclass TDSLoader extends Loader {\n  constructor(manager) {\n    super(manager);\n    this.debug = false;\n    this.group = null;\n    this.position = 0;\n    this.materials = [];\n    this.meshes = [];\n  }\n  /**\n   * Load 3ds file from url.\n   *\n   * @method load\n   * @param {[type]} url URL for the file.\n   * @param {Function} onLoad onLoad callback, receives group Object3D as argument.\n   * @param {Function} onProgress onProgress callback.\n   * @param {Function} onError onError callback.\n   */\n  load(url, onLoad, onProgress, onError) {\n    const scope = this;\n    const path = this.path === \"\" ? LoaderUtils.extractUrlBase(url) : this.path;\n    const loader = new FileLoader(this.manager);\n    loader.setPath(this.path);\n    loader.setResponseType(\"arraybuffer\");\n    loader.setRequestHeader(this.requestHeader);\n    loader.setWithCredentials(this.withCredentials);\n    loader.load(\n      url,\n      function(data) {\n        try {\n          onLoad(scope.parse(data, path));\n        } catch (e) {\n          if (onError) {\n            onError(e);\n          } else {\n            console.error(e);\n          }\n          scope.manager.itemError(url);\n        }\n      },\n      onProgress,\n      onError\n    );\n  }\n  /**\n   * Parse arraybuffer data and load 3ds file.\n   *\n   * @method parse\n   * @param {ArrayBuffer} arraybuffer Arraybuffer data to be loaded.\n   * @param {String} path Path for external resources.\n   * @return {Group} Group loaded from 3ds file.\n   */\n  parse(arraybuffer, path) {\n    this.group = new Group();\n    this.position = 0;\n    this.materials = [];\n    this.meshes = [];\n    this.readFile(arraybuffer, path);\n    for (let i = 0; i < this.meshes.length; i++) {\n      this.group.add(this.meshes[i]);\n    }\n    return this.group;\n  }\n  /**\n   * Decode file content to read 3ds data.\n   *\n   * @method readFile\n   * @param {ArrayBuffer} arraybuffer Arraybuffer data to be loaded.\n   * @param {String} path Path for external resources.\n   */\n  readFile(arraybuffer, path) {\n    const data = new DataView(arraybuffer);\n    const chunk = this.readChunk(data);\n    if (chunk.id === MLIBMAGIC || chunk.id === CMAGIC || chunk.id === M3DMAGIC) {\n      let next = this.nextChunk(data, chunk);\n      while (next !== 0) {\n        if (next === M3D_VERSION) {\n          const version = this.readDWord(data);\n          this.debugMessage(\"3DS file version: \" + version);\n        } else if (next === MDATA) {\n          this.resetPosition(data);\n          this.readMeshData(data, path);\n        } else {\n          this.debugMessage(\"Unknown main chunk: \" + next.toString(16));\n        }\n        next = this.nextChunk(data, chunk);\n      }\n    }\n    this.debugMessage(\"Parsed \" + this.meshes.length + \" meshes\");\n  }\n  /**\n   * Read mesh data chunk.\n   *\n   * @method readMeshData\n   * @param {Dataview} data Dataview in use.\n   * @param {String} path Path for external resources.\n   */\n  readMeshData(data, path) {\n    const chunk = this.readChunk(data);\n    let next = this.nextChunk(data, chunk);\n    while (next !== 0) {\n      if (next === MESH_VERSION) {\n        const version = +this.readDWord(data);\n        this.debugMessage(\"Mesh Version: \" + version);\n      } else if (next === MASTER_SCALE) {\n        const scale = this.readFloat(data);\n        this.debugMessage(\"Master scale: \" + scale);\n        this.group.scale.set(scale, scale, scale);\n      } else if (next === NAMED_OBJECT) {\n        this.debugMessage(\"Named Object\");\n        this.resetPosition(data);\n        this.readNamedObject(data);\n      } else if (next === MAT_ENTRY) {\n        this.debugMessage(\"Material\");\n        this.resetPosition(data);\n        this.readMaterialEntry(data, path);\n      } else {\n        this.debugMessage(\"Unknown MDATA chunk: \" + next.toString(16));\n      }\n      next = this.nextChunk(data, chunk);\n    }\n  }\n  /**\n   * Read named object chunk.\n   *\n   * @method readNamedObject\n   * @param {Dataview} data Dataview in use.\n   */\n  readNamedObject(data) {\n    const chunk = this.readChunk(data);\n    const name = this.readString(data, 64);\n    chunk.cur = this.position;\n    let next = this.nextChunk(data, chunk);\n    while (next !== 0) {\n      if (next === N_TRI_OBJECT) {\n        this.resetPosition(data);\n        const mesh = this.readMesh(data);\n        mesh.name = name;\n        this.meshes.push(mesh);\n      } else {\n        this.debugMessage(\"Unknown named object chunk: \" + next.toString(16));\n      }\n      next = this.nextChunk(data, chunk);\n    }\n    this.endChunk(chunk);\n  }\n  /**\n   * Read material data chunk and add it to the material list.\n   *\n   * @method readMaterialEntry\n   * @param {Dataview} data Dataview in use.\n   * @param {String} path Path for external resources.\n   */\n  readMaterialEntry(data, path) {\n    const chunk = this.readChunk(data);\n    let next = this.nextChunk(data, chunk);\n    const material = new MeshPhongMaterial();\n    while (next !== 0) {\n      if (next === MAT_NAME) {\n        material.name = this.readString(data, 64);\n        this.debugMessage(\"   Name: \" + material.name);\n      } else if (next === MAT_WIRE) {\n        this.debugMessage(\"   Wireframe\");\n        material.wireframe = true;\n      } else if (next === MAT_WIRE_SIZE) {\n        const value = this.readByte(data);\n        material.wireframeLinewidth = value;\n        this.debugMessage(\"   Wireframe Thickness: \" + value);\n      } else if (next === MAT_TWO_SIDE) {\n        material.side = DoubleSide;\n        this.debugMessage(\"   DoubleSided\");\n      } else if (next === MAT_ADDITIVE) {\n        this.debugMessage(\"   Additive Blending\");\n        material.blending = AdditiveBlending;\n      } else if (next === MAT_DIFFUSE) {\n        this.debugMessage(\"   Diffuse Color\");\n        material.color = this.readColor(data);\n      } else if (next === MAT_SPECULAR) {\n        this.debugMessage(\"   Specular Color\");\n        material.specular = this.readColor(data);\n      } else if (next === MAT_AMBIENT) {\n        this.debugMessage(\"   Ambient color\");\n        material.color = this.readColor(data);\n      } else if (next === MAT_SHININESS) {\n        const shininess = this.readPercentage(data);\n        material.shininess = shininess * 100;\n        this.debugMessage(\"   Shininess : \" + shininess);\n      } else if (next === MAT_TRANSPARENCY) {\n        const transparency = this.readPercentage(data);\n        material.opacity = 1 - transparency;\n        this.debugMessage(\"  Transparency : \" + transparency);\n        material.transparent = material.opacity < 1 ? true : false;\n      } else if (next === MAT_TEXMAP) {\n        this.debugMessage(\"   ColorMap\");\n        this.resetPosition(data);\n        material.map = this.readMap(data, path);\n      } else if (next === MAT_BUMPMAP) {\n        this.debugMessage(\"   BumpMap\");\n        this.resetPosition(data);\n        material.bumpMap = this.readMap(data, path);\n      } else if (next === MAT_OPACMAP) {\n        this.debugMessage(\"   OpacityMap\");\n        this.resetPosition(data);\n        material.alphaMap = this.readMap(data, path);\n      } else if (next === MAT_SPECMAP) {\n        this.debugMessage(\"   SpecularMap\");\n        this.resetPosition(data);\n        material.specularMap = this.readMap(data, path);\n      } else {\n        this.debugMessage(\"   Unknown material chunk: \" + next.toString(16));\n      }\n      next = this.nextChunk(data, chunk);\n    }\n    this.endChunk(chunk);\n    this.materials[material.name] = material;\n  }\n  /**\n   * Read mesh data chunk.\n   *\n   * @method readMesh\n   * @param {Dataview} data Dataview in use.\n   * @return {Mesh} The parsed mesh.\n   */\n  readMesh(data) {\n    const chunk = this.readChunk(data);\n    let next = this.nextChunk(data, chunk);\n    const geometry = new BufferGeometry();\n    const material = new MeshPhongMaterial();\n    const mesh = new Mesh(geometry, material);\n    mesh.name = \"mesh\";\n    while (next !== 0) {\n      if (next === POINT_ARRAY) {\n        const points = this.readWord(data);\n        this.debugMessage(\"   Vertex: \" + points);\n        const vertices = [];\n        for (let i = 0; i < points; i++) {\n          vertices.push(this.readFloat(data));\n          vertices.push(this.readFloat(data));\n          vertices.push(this.readFloat(data));\n        }\n        geometry.setAttribute(\"position\", new Float32BufferAttribute(vertices, 3));\n      } else if (next === FACE_ARRAY) {\n        this.resetPosition(data);\n        this.readFaceArray(data, mesh);\n      } else if (next === TEX_VERTS) {\n        const texels = this.readWord(data);\n        this.debugMessage(\"   UV: \" + texels);\n        const uvs = [];\n        for (let i = 0; i < texels; i++) {\n          uvs.push(this.readFloat(data));\n          uvs.push(this.readFloat(data));\n        }\n        geometry.setAttribute(\"uv\", new Float32BufferAttribute(uvs, 2));\n      } else if (next === MESH_MATRIX) {\n        this.debugMessage(\"   Tranformation Matrix (TODO)\");\n        const values = [];\n        for (let i = 0; i < 12; i++) {\n          values[i] = this.readFloat(data);\n        }\n        const matrix = new Matrix4();\n        matrix.elements[0] = values[0];\n        matrix.elements[1] = values[6];\n        matrix.elements[2] = values[3];\n        matrix.elements[3] = values[9];\n        matrix.elements[4] = values[2];\n        matrix.elements[5] = values[8];\n        matrix.elements[6] = values[5];\n        matrix.elements[7] = values[11];\n        matrix.elements[8] = values[1];\n        matrix.elements[9] = values[7];\n        matrix.elements[10] = values[4];\n        matrix.elements[11] = values[10];\n        matrix.elements[12] = 0;\n        matrix.elements[13] = 0;\n        matrix.elements[14] = 0;\n        matrix.elements[15] = 1;\n        matrix.transpose();\n        const inverse = new Matrix4();\n        inverse.copy(matrix).invert();\n        geometry.applyMatrix4(inverse);\n        matrix.decompose(mesh.position, mesh.quaternion, mesh.scale);\n      } else {\n        this.debugMessage(\"   Unknown mesh chunk: \" + next.toString(16));\n      }\n      next = this.nextChunk(data, chunk);\n    }\n    this.endChunk(chunk);\n    geometry.computeVertexNormals();\n    return mesh;\n  }\n  /**\n   * Read face array data chunk.\n   *\n   * @method readFaceArray\n   * @param {Dataview} data Dataview in use.\n   * @param {Mesh} mesh Mesh to be filled with the data read.\n   */\n  readFaceArray(data, mesh) {\n    const chunk = this.readChunk(data);\n    const faces = this.readWord(data);\n    this.debugMessage(\"   Faces: \" + faces);\n    const index = [];\n    for (let i = 0; i < faces; ++i) {\n      index.push(this.readWord(data), this.readWord(data), this.readWord(data));\n      this.readWord(data);\n    }\n    mesh.geometry.setIndex(index);\n    let materialIndex = 0;\n    let start = 0;\n    while (this.position < chunk.end) {\n      const subchunk = this.readChunk(data);\n      if (subchunk.id === MSH_MAT_GROUP) {\n        this.debugMessage(\"      Material Group\");\n        this.resetPosition(data);\n        const group = this.readMaterialGroup(data);\n        const count = group.index.length * 3;\n        mesh.geometry.addGroup(start, count, materialIndex);\n        start += count;\n        materialIndex++;\n        const material = this.materials[group.name];\n        if (Array.isArray(mesh.material) === false)\n          mesh.material = [];\n        if (material !== void 0) {\n          mesh.material.push(material);\n        }\n      } else {\n        this.debugMessage(\"      Unknown face array chunk: \" + subchunk.toString(16));\n      }\n      this.endChunk(subchunk);\n    }\n    if (mesh.material.length === 1)\n      mesh.material = mesh.material[0];\n    this.endChunk(chunk);\n  }\n  /**\n   * Read texture map data chunk.\n   *\n   * @method readMap\n   * @param {Dataview} data Dataview in use.\n   * @param {String} path Path for external resources.\n   * @return {Texture} Texture read from this data chunk.\n   */\n  readMap(data, path) {\n    const chunk = this.readChunk(data);\n    let next = this.nextChunk(data, chunk);\n    let texture = {};\n    const loader = new TextureLoader(this.manager);\n    loader.setPath(this.resourcePath || path).setCrossOrigin(this.crossOrigin);\n    while (next !== 0) {\n      if (next === MAT_MAPNAME) {\n        const name = this.readString(data, 128);\n        texture = loader.load(name);\n        this.debugMessage(\"      File: \" + path + name);\n      } else if (next === MAT_MAP_UOFFSET) {\n        texture.offset.x = this.readFloat(data);\n        this.debugMessage(\"      OffsetX: \" + texture.offset.x);\n      } else if (next === MAT_MAP_VOFFSET) {\n        texture.offset.y = this.readFloat(data);\n        this.debugMessage(\"      OffsetY: \" + texture.offset.y);\n      } else if (next === MAT_MAP_USCALE) {\n        texture.repeat.x = this.readFloat(data);\n        this.debugMessage(\"      RepeatX: \" + texture.repeat.x);\n      } else if (next === MAT_MAP_VSCALE) {\n        texture.repeat.y = this.readFloat(data);\n        this.debugMessage(\"      RepeatY: \" + texture.repeat.y);\n      } else {\n        this.debugMessage(\"      Unknown map chunk: \" + next.toString(16));\n      }\n      next = this.nextChunk(data, chunk);\n    }\n    this.endChunk(chunk);\n    return texture;\n  }\n  /**\n   * Read material group data chunk.\n   *\n   * @method readMaterialGroup\n   * @param {Dataview} data Dataview in use.\n   * @return {Object} Object with name and index of the object.\n   */\n  readMaterialGroup(data) {\n    this.readChunk(data);\n    const name = this.readString(data, 64);\n    const numFaces = this.readWord(data);\n    this.debugMessage(\"         Name: \" + name);\n    this.debugMessage(\"         Faces: \" + numFaces);\n    const index = [];\n    for (let i = 0; i < numFaces; ++i) {\n      index.push(this.readWord(data));\n    }\n    return { name, index };\n  }\n  /**\n   * Read a color value.\n   *\n   * @method readColor\n   * @param {DataView} data Dataview.\n   * @return {Color} Color value read..\n   */\n  readColor(data) {\n    const chunk = this.readChunk(data);\n    const color = new Color();\n    if (chunk.id === COLOR_24 || chunk.id === LIN_COLOR_24) {\n      const r = this.readByte(data);\n      const g = this.readByte(data);\n      const b = this.readByte(data);\n      color.setRGB(r / 255, g / 255, b / 255);\n      this.debugMessage(\"      Color: \" + color.r + \", \" + color.g + \", \" + color.b);\n    } else if (chunk.id === COLOR_F || chunk.id === LIN_COLOR_F) {\n      const r = this.readFloat(data);\n      const g = this.readFloat(data);\n      const b = this.readFloat(data);\n      color.setRGB(r, g, b);\n      this.debugMessage(\"      Color: \" + color.r + \", \" + color.g + \", \" + color.b);\n    } else {\n      this.debugMessage(\"      Unknown color chunk: \" + chunk.toString(16));\n    }\n    this.endChunk(chunk);\n    return color;\n  }\n  /**\n   * Read next chunk of data.\n   *\n   * @method readChunk\n   * @param {DataView} data Dataview.\n   * @return {Object} Chunk of data read.\n   */\n  readChunk(data) {\n    const chunk = {};\n    chunk.cur = this.position;\n    chunk.id = this.readWord(data);\n    chunk.size = this.readDWord(data);\n    chunk.end = chunk.cur + chunk.size;\n    chunk.cur += 6;\n    return chunk;\n  }\n  /**\n   * Set position to the end of the current chunk of data.\n   *\n   * @method endChunk\n   * @param {Object} chunk Data chunk.\n   */\n  endChunk(chunk) {\n    this.position = chunk.end;\n  }\n  /**\n   * Move to the next data chunk.\n   *\n   * @method nextChunk\n   * @param {DataView} data Dataview.\n   * @param {Object} chunk Data chunk.\n   */\n  nextChunk(data, chunk) {\n    if (chunk.cur >= chunk.end) {\n      return 0;\n    }\n    this.position = chunk.cur;\n    try {\n      const next = this.readChunk(data);\n      chunk.cur += next.size;\n      return next.id;\n    } catch (e) {\n      this.debugMessage(\"Unable to read chunk at \" + this.position);\n      return 0;\n    }\n  }\n  /**\n   * Reset dataview position.\n   *\n   * @method resetPosition\n   */\n  resetPosition() {\n    this.position -= 6;\n  }\n  /**\n   * Read byte value.\n   *\n   * @method readByte\n   * @param {DataView} data Dataview to read data from.\n   * @return {Number} Data read from the dataview.\n   */\n  readByte(data) {\n    const v = data.getUint8(this.position, true);\n    this.position += 1;\n    return v;\n  }\n  /**\n   * Read 32 bit float value.\n   *\n   * @method readFloat\n   * @param {DataView} data Dataview to read data from.\n   * @return {Number} Data read from the dataview.\n   */\n  readFloat(data) {\n    try {\n      const v = data.getFloat32(this.position, true);\n      this.position += 4;\n      return v;\n    } catch (e) {\n      this.debugMessage(e + \" \" + this.position + \" \" + data.byteLength);\n    }\n  }\n  /**\n   * Read 32 bit signed integer value.\n   *\n   * @method readInt\n   * @param {DataView} data Dataview to read data from.\n   * @return {Number} Data read from the dataview.\n   */\n  readInt(data) {\n    const v = data.getInt32(this.position, true);\n    this.position += 4;\n    return v;\n  }\n  /**\n   * Read 16 bit signed integer value.\n   *\n   * @method readShort\n   * @param {DataView} data Dataview to read data from.\n   * @return {Number} Data read from the dataview.\n   */\n  readShort(data) {\n    const v = data.getInt16(this.position, true);\n    this.position += 2;\n    return v;\n  }\n  /**\n   * Read 64 bit unsigned integer value.\n   *\n   * @method readDWord\n   * @param {DataView} data Dataview to read data from.\n   * @return {Number} Data read from the dataview.\n   */\n  readDWord(data) {\n    const v = data.getUint32(this.position, true);\n    this.position += 4;\n    return v;\n  }\n  /**\n   * Read 32 bit unsigned integer value.\n   *\n   * @method readWord\n   * @param {DataView} data Dataview to read data from.\n   * @return {Number} Data read from the dataview.\n   */\n  readWord(data) {\n    const v = data.getUint16(this.position, true);\n    this.position += 2;\n    return v;\n  }\n  /**\n   * Read string value.\n   *\n   * @method readString\n   * @param {DataView} data Dataview to read data from.\n   * @param {Number} maxLength Max size of the string to be read.\n   * @return {String} Data read from the dataview.\n   */\n  readString(data, maxLength) {\n    let s = \"\";\n    for (let i = 0; i < maxLength; i++) {\n      const c = this.readByte(data);\n      if (!c) {\n        break;\n      }\n      s += String.fromCharCode(c);\n    }\n    return s;\n  }\n  /**\n   * Read percentage value.\n   *\n   * @method readPercentage\n   * @param {DataView} data Dataview to read data from.\n   * @return {Number} Data read from the dataview.\n   */\n  readPercentage(data) {\n    const chunk = this.readChunk(data);\n    let value;\n    switch (chunk.id) {\n      case INT_PERCENTAGE:\n        value = this.readShort(data) / 100;\n        break;\n      case FLOAT_PERCENTAGE:\n        value = this.readFloat(data);\n        break;\n      default:\n        this.debugMessage(\"      Unknown percentage chunk: \" + chunk.toString(16));\n    }\n    this.endChunk(chunk);\n    return value;\n  }\n  /**\n   * Print debug message to the console.\n   *\n   * Is controlled by a flag to show or hide debug messages.\n   *\n   * @method debugMessage\n   * @param {Object} message Debug message to print to the console.\n   */\n  debugMessage(message) {\n    if (this.debug) {\n      console.log(message);\n    }\n  }\n}\nconst M3DMAGIC = 19789;\nconst MLIBMAGIC = 15786;\nconst CMAGIC = 49725;\nconst M3D_VERSION = 2;\nconst COLOR_F = 16;\nconst COLOR_24 = 17;\nconst LIN_COLOR_24 = 18;\nconst LIN_COLOR_F = 19;\nconst INT_PERCENTAGE = 48;\nconst FLOAT_PERCENTAGE = 49;\nconst MDATA = 15677;\nconst MESH_VERSION = 15678;\nconst MASTER_SCALE = 256;\nconst MAT_ENTRY = 45055;\nconst MAT_NAME = 40960;\nconst MAT_AMBIENT = 40976;\nconst MAT_DIFFUSE = 40992;\nconst MAT_SPECULAR = 41008;\nconst MAT_SHININESS = 41024;\nconst MAT_TRANSPARENCY = 41040;\nconst MAT_TWO_SIDE = 41089;\nconst MAT_ADDITIVE = 41091;\nconst MAT_WIRE = 41093;\nconst MAT_WIRE_SIZE = 41095;\nconst MAT_TEXMAP = 41472;\nconst MAT_OPACMAP = 41488;\nconst MAT_BUMPMAP = 41520;\nconst MAT_SPECMAP = 41476;\nconst MAT_MAPNAME = 41728;\nconst MAT_MAP_USCALE = 41812;\nconst MAT_MAP_VSCALE = 41814;\nconst MAT_MAP_UOFFSET = 41816;\nconst MAT_MAP_VOFFSET = 41818;\nconst NAMED_OBJECT = 16384;\nconst N_TRI_OBJECT = 16640;\nconst POINT_ARRAY = 16656;\nconst FACE_ARRAY = 16672;\nconst MSH_MAT_GROUP = 16688;\nconst TEX_VERTS = 16704;\nconst MESH_MATRIX = 16736;\nexport {\n  TDSLoader\n};\n"]},"metadata":{},"sourceType":"module"}