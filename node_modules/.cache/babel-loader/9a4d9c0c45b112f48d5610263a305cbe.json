{"ast":null,"code":"import { Vector3, Quaternion, Object3D, Matrix4 } from \"three\";\n\nconst _position = /* @__PURE__ */new Vector3();\n\nconst _quaternion = /* @__PURE__ */new Quaternion();\n\nconst _scale = /* @__PURE__ */new Vector3();\n\nclass CSS3DObject extends Object3D {\n  constructor(element = document.createElement(\"div\")) {\n    super();\n    this.isCSS3DObject = true;\n    this.element = element;\n    this.element.style.position = \"absolute\";\n    this.element.style.pointerEvents = \"auto\";\n    this.element.style.userSelect = \"none\";\n    this.element.setAttribute(\"draggable\", false);\n    this.addEventListener(\"removed\", function () {\n      this.traverse(function (object) {\n        if (object.element instanceof Element && object.element.parentNode !== null) {\n          object.element.parentNode.removeChild(object.element);\n        }\n      });\n    });\n  }\n\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n\n}\n\nclass CSS3DSprite extends CSS3DObject {\n  constructor(element) {\n    super(element);\n    this.isCSS3DSprite = true;\n    this.rotation2D = 0;\n  }\n\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.rotation2D = source.rotation2D;\n    return this;\n  }\n\n}\n\nconst _matrix = /* @__PURE__ */new Matrix4();\n\nconst _matrix2 = /* @__PURE__ */new Matrix4();\n\nclass CSS3DRenderer {\n  constructor(parameters = {}) {\n    const _this = this;\n\n    let _width, _height;\n\n    let _widthHalf, _heightHalf;\n\n    const cache = {\n      camera: {\n        fov: 0,\n        style: \"\"\n      },\n      objects: /* @__PURE__ */new WeakMap()\n    };\n    const domElement = parameters.element !== void 0 ? parameters.element : document.createElement(\"div\");\n    domElement.style.overflow = \"hidden\";\n    this.domElement = domElement;\n    const viewElement = document.createElement(\"div\");\n    viewElement.style.transformOrigin = \"0 0\";\n    viewElement.style.pointerEvents = \"none\";\n    domElement.appendChild(viewElement);\n    const cameraElement = document.createElement(\"div\");\n    cameraElement.style.transformStyle = \"preserve-3d\";\n    viewElement.appendChild(cameraElement);\n\n    this.getSize = function () {\n      return {\n        width: _width,\n        height: _height\n      };\n    };\n\n    this.render = function (scene, camera) {\n      const fov = camera.projectionMatrix.elements[5] * _heightHalf;\n\n      if (cache.camera.fov !== fov) {\n        viewElement.style.perspective = camera.isPerspectiveCamera ? fov + \"px\" : \"\";\n        cache.camera.fov = fov;\n      }\n\n      if (camera.view && camera.view.enabled) {\n        viewElement.style.transform = `translate( ${-camera.view.offsetX * (_width / camera.view.width)}px, ${-camera.view.offsetY * (_height / camera.view.height)}px )`;\n        viewElement.style.transform += `scale( ${camera.view.fullWidth / camera.view.width}, ${camera.view.fullHeight / camera.view.height} )`;\n      } else {\n        viewElement.style.transform = \"\";\n      }\n\n      if (scene.matrixWorldAutoUpdate === true) scene.updateMatrixWorld();\n      if (camera.parent === null && camera.matrixWorldAutoUpdate === true) camera.updateMatrixWorld();\n      let tx, ty;\n\n      if (camera.isOrthographicCamera) {\n        tx = -(camera.right + camera.left) / 2;\n        ty = (camera.top + camera.bottom) / 2;\n      }\n\n      const scaleByViewOffset = camera.view && camera.view.enabled ? camera.view.height / camera.view.fullHeight : 1;\n      const cameraCSSMatrix = camera.isOrthographicCamera ? `scale( ${scaleByViewOffset} )scale(` + fov + \")translate(\" + epsilon(tx) + \"px,\" + epsilon(ty) + \"px)\" + getCameraCSSMatrix(camera.matrixWorldInverse) : `scale( ${scaleByViewOffset} )translateZ(` + fov + \"px)\" + getCameraCSSMatrix(camera.matrixWorldInverse);\n      const style = cameraCSSMatrix + \"translate(\" + _widthHalf + \"px,\" + _heightHalf + \"px)\";\n\n      if (cache.camera.style !== style) {\n        cameraElement.style.transform = style;\n        cache.camera.style = style;\n      }\n\n      renderObject(scene, scene, camera, cameraCSSMatrix);\n    };\n\n    this.setSize = function (width, height) {\n      _width = width;\n      _height = height;\n      _widthHalf = _width / 2;\n      _heightHalf = _height / 2;\n      domElement.style.width = width + \"px\";\n      domElement.style.height = height + \"px\";\n      viewElement.style.width = width + \"px\";\n      viewElement.style.height = height + \"px\";\n      cameraElement.style.width = width + \"px\";\n      cameraElement.style.height = height + \"px\";\n    };\n\n    function epsilon(value) {\n      return Math.abs(value) < 1e-10 ? 0 : value;\n    }\n\n    function getCameraCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      return \"matrix3d(\" + epsilon(elements[0]) + \",\" + epsilon(-elements[1]) + \",\" + epsilon(elements[2]) + \",\" + epsilon(elements[3]) + \",\" + epsilon(elements[4]) + \",\" + epsilon(-elements[5]) + \",\" + epsilon(elements[6]) + \",\" + epsilon(elements[7]) + \",\" + epsilon(elements[8]) + \",\" + epsilon(-elements[9]) + \",\" + epsilon(elements[10]) + \",\" + epsilon(elements[11]) + \",\" + epsilon(elements[12]) + \",\" + epsilon(-elements[13]) + \",\" + epsilon(elements[14]) + \",\" + epsilon(elements[15]) + \")\";\n    }\n\n    function getObjectCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      const matrix3d = \"matrix3d(\" + epsilon(elements[0]) + \",\" + epsilon(elements[1]) + \",\" + epsilon(elements[2]) + \",\" + epsilon(elements[3]) + \",\" + epsilon(-elements[4]) + \",\" + epsilon(-elements[5]) + \",\" + epsilon(-elements[6]) + \",\" + epsilon(-elements[7]) + \",\" + epsilon(elements[8]) + \",\" + epsilon(elements[9]) + \",\" + epsilon(elements[10]) + \",\" + epsilon(elements[11]) + \",\" + epsilon(elements[12]) + \",\" + epsilon(elements[13]) + \",\" + epsilon(elements[14]) + \",\" + epsilon(elements[15]) + \")\";\n      return \"translate(-50%,-50%)\" + matrix3d;\n    }\n\n    function renderObject(object, scene, camera, cameraCSSMatrix) {\n      if (object.isCSS3DObject) {\n        const visible = object.visible === true && object.layers.test(camera.layers) === true;\n        object.element.style.display = visible === true ? \"\" : \"none\";\n\n        if (visible === true) {\n          object.onBeforeRender(_this, scene, camera);\n          let style;\n\n          if (object.isCSS3DSprite) {\n            _matrix.copy(camera.matrixWorldInverse);\n\n            _matrix.transpose();\n\n            if (object.rotation2D !== 0) _matrix.multiply(_matrix2.makeRotationZ(object.rotation2D));\n            object.matrixWorld.decompose(_position, _quaternion, _scale);\n\n            _matrix.setPosition(_position);\n\n            _matrix.scale(_scale);\n\n            _matrix.elements[3] = 0;\n            _matrix.elements[7] = 0;\n            _matrix.elements[11] = 0;\n            _matrix.elements[15] = 1;\n            style = getObjectCSSMatrix(_matrix);\n          } else {\n            style = getObjectCSSMatrix(object.matrixWorld);\n          }\n\n          const element = object.element;\n          const cachedObject = cache.objects.get(object);\n\n          if (cachedObject === void 0 || cachedObject.style !== style) {\n            element.style.transform = style;\n            const objectData = {\n              style\n            };\n            cache.objects.set(object, objectData);\n          }\n\n          if (element.parentNode !== cameraElement) {\n            cameraElement.appendChild(element);\n          }\n\n          object.onAfterRender(_this, scene, camera);\n        }\n      }\n\n      for (let i = 0, l = object.children.length; i < l; i++) {\n        renderObject(object.children[i], scene, camera, cameraCSSMatrix);\n      }\n    }\n  }\n\n}\n\nexport { CSS3DObject, CSS3DRenderer, CSS3DSprite };","map":{"version":3,"sources":["/Users/theodaguier/Developer/old/_dev/pro/e-do/website/old/E-Do-Studio/node_modules/three-stdlib/renderers/CSS3DRenderer.js"],"names":["Vector3","Quaternion","Object3D","Matrix4","_position","_quaternion","_scale","CSS3DObject","constructor","element","document","createElement","isCSS3DObject","style","position","pointerEvents","userSelect","setAttribute","addEventListener","traverse","object","Element","parentNode","removeChild","copy","source","recursive","cloneNode","CSS3DSprite","isCSS3DSprite","rotation2D","_matrix","_matrix2","CSS3DRenderer","parameters","_this","_width","_height","_widthHalf","_heightHalf","cache","camera","fov","objects","WeakMap","domElement","overflow","viewElement","transformOrigin","appendChild","cameraElement","transformStyle","getSize","width","height","render","scene","projectionMatrix","elements","perspective","isPerspectiveCamera","view","enabled","transform","offsetX","offsetY","fullWidth","fullHeight","matrixWorldAutoUpdate","updateMatrixWorld","parent","tx","ty","isOrthographicCamera","right","left","top","bottom","scaleByViewOffset","cameraCSSMatrix","epsilon","getCameraCSSMatrix","matrixWorldInverse","renderObject","setSize","value","Math","abs","matrix","getObjectCSSMatrix","matrix3d","visible","layers","test","display","onBeforeRender","transpose","multiply","makeRotationZ","matrixWorld","decompose","setPosition","scale","cachedObject","get","objectData","set","onAfterRender","i","l","children","length"],"mappings":"AAAA,SAASA,OAAT,EAAkBC,UAAlB,EAA8BC,QAA9B,EAAwCC,OAAxC,QAAuD,OAAvD;;AACA,MAAMC,SAAS,GAAG,eAAgB,IAAIJ,OAAJ,EAAlC;;AACA,MAAMK,WAAW,GAAG,eAAgB,IAAIJ,UAAJ,EAApC;;AACA,MAAMK,MAAM,GAAG,eAAgB,IAAIN,OAAJ,EAA/B;;AACA,MAAMO,WAAN,SAA0BL,QAA1B,CAAmC;AACjCM,EAAAA,WAAW,CAACC,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAX,EAA0C;AACnD;AACA,SAAKC,aAAL,GAAqB,IAArB;AACA,SAAKH,OAAL,GAAeA,OAAf;AACA,SAAKA,OAAL,CAAaI,KAAb,CAAmBC,QAAnB,GAA8B,UAA9B;AACA,SAAKL,OAAL,CAAaI,KAAb,CAAmBE,aAAnB,GAAmC,MAAnC;AACA,SAAKN,OAAL,CAAaI,KAAb,CAAmBG,UAAnB,GAAgC,MAAhC;AACA,SAAKP,OAAL,CAAaQ,YAAb,CAA0B,WAA1B,EAAuC,KAAvC;AACA,SAAKC,gBAAL,CAAsB,SAAtB,EAAiC,YAAW;AAC1C,WAAKC,QAAL,CAAc,UAASC,MAAT,EAAiB;AAC7B,YAAIA,MAAM,CAACX,OAAP,YAA0BY,OAA1B,IAAqCD,MAAM,CAACX,OAAP,CAAea,UAAf,KAA8B,IAAvE,EAA6E;AAC3EF,UAAAA,MAAM,CAACX,OAAP,CAAea,UAAf,CAA0BC,WAA1B,CAAsCH,MAAM,CAACX,OAA7C;AACD;AACF,OAJD;AAKD,KAND;AAOD;;AACDe,EAAAA,IAAI,CAACC,MAAD,EAASC,SAAT,EAAoB;AACtB,UAAMF,IAAN,CAAWC,MAAX,EAAmBC,SAAnB;AACA,SAAKjB,OAAL,GAAegB,MAAM,CAAChB,OAAP,CAAekB,SAAf,CAAyB,IAAzB,CAAf;AACA,WAAO,IAAP;AACD;;AArBgC;;AAuBnC,MAAMC,WAAN,SAA0BrB,WAA1B,CAAsC;AACpCC,EAAAA,WAAW,CAACC,OAAD,EAAU;AACnB,UAAMA,OAAN;AACA,SAAKoB,aAAL,GAAqB,IAArB;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACD;;AACDN,EAAAA,IAAI,CAACC,MAAD,EAASC,SAAT,EAAoB;AACtB,UAAMF,IAAN,CAAWC,MAAX,EAAmBC,SAAnB;AACA,SAAKI,UAAL,GAAkBL,MAAM,CAACK,UAAzB;AACA,WAAO,IAAP;AACD;;AAVmC;;AAYtC,MAAMC,OAAO,GAAG,eAAgB,IAAI5B,OAAJ,EAAhC;;AACA,MAAM6B,QAAQ,GAAG,eAAgB,IAAI7B,OAAJ,EAAjC;;AACA,MAAM8B,aAAN,CAAoB;AAClBzB,EAAAA,WAAW,CAAC0B,UAAU,GAAG,EAAd,EAAkB;AAC3B,UAAMC,KAAK,GAAG,IAAd;;AACA,QAAIC,MAAJ,EAAYC,OAAZ;;AACA,QAAIC,UAAJ,EAAgBC,WAAhB;;AACA,UAAMC,KAAK,GAAG;AACZC,MAAAA,MAAM,EAAE;AAAEC,QAAAA,GAAG,EAAE,CAAP;AAAU7B,QAAAA,KAAK,EAAE;AAAjB,OADI;AAEZ8B,MAAAA,OAAO,EAAE,eAAgB,IAAIC,OAAJ;AAFb,KAAd;AAIA,UAAMC,UAAU,GAAGX,UAAU,CAACzB,OAAX,KAAuB,KAAK,CAA5B,GAAgCyB,UAAU,CAACzB,OAA3C,GAAqDC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAxE;AACAkC,IAAAA,UAAU,CAAChC,KAAX,CAAiBiC,QAAjB,GAA4B,QAA5B;AACA,SAAKD,UAAL,GAAkBA,UAAlB;AACA,UAAME,WAAW,GAAGrC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAApB;AACAoC,IAAAA,WAAW,CAAClC,KAAZ,CAAkBmC,eAAlB,GAAoC,KAApC;AACAD,IAAAA,WAAW,CAAClC,KAAZ,CAAkBE,aAAlB,GAAkC,MAAlC;AACA8B,IAAAA,UAAU,CAACI,WAAX,CAAuBF,WAAvB;AACA,UAAMG,aAAa,GAAGxC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAtB;AACAuC,IAAAA,aAAa,CAACrC,KAAd,CAAoBsC,cAApB,GAAqC,aAArC;AACAJ,IAAAA,WAAW,CAACE,WAAZ,CAAwBC,aAAxB;;AACA,SAAKE,OAAL,GAAe,YAAW;AACxB,aAAO;AACLC,QAAAA,KAAK,EAAEjB,MADF;AAELkB,QAAAA,MAAM,EAAEjB;AAFH,OAAP;AAID,KALD;;AAMA,SAAKkB,MAAL,GAAc,UAASC,KAAT,EAAgBf,MAAhB,EAAwB;AACpC,YAAMC,GAAG,GAAGD,MAAM,CAACgB,gBAAP,CAAwBC,QAAxB,CAAiC,CAAjC,IAAsCnB,WAAlD;;AACA,UAAIC,KAAK,CAACC,MAAN,CAAaC,GAAb,KAAqBA,GAAzB,EAA8B;AAC5BK,QAAAA,WAAW,CAAClC,KAAZ,CAAkB8C,WAAlB,GAAgClB,MAAM,CAACmB,mBAAP,GAA6BlB,GAAG,GAAG,IAAnC,GAA0C,EAA1E;AACAF,QAAAA,KAAK,CAACC,MAAN,CAAaC,GAAb,GAAmBA,GAAnB;AACD;;AACD,UAAID,MAAM,CAACoB,IAAP,IAAepB,MAAM,CAACoB,IAAP,CAAYC,OAA/B,EAAwC;AACtCf,QAAAA,WAAW,CAAClC,KAAZ,CAAkBkD,SAAlB,GAA+B,cAAa,CAACtB,MAAM,CAACoB,IAAP,CAAYG,OAAb,IAAwB5B,MAAM,GAAGK,MAAM,CAACoB,IAAP,CAAYR,KAA7C,CAAoD,OAAM,CAACZ,MAAM,CAACoB,IAAP,CAAYI,OAAb,IAAwB5B,OAAO,GAAGI,MAAM,CAACoB,IAAP,CAAYP,MAA9C,CAAsD,MAA5J;AACAP,QAAAA,WAAW,CAAClC,KAAZ,CAAkBkD,SAAlB,IAAgC,UAAStB,MAAM,CAACoB,IAAP,CAAYK,SAAZ,GAAwBzB,MAAM,CAACoB,IAAP,CAAYR,KAAM,KAAIZ,MAAM,CAACoB,IAAP,CAAYM,UAAZ,GAAyB1B,MAAM,CAACoB,IAAP,CAAYP,MAAO,IAAnI;AACD,OAHD,MAGO;AACLP,QAAAA,WAAW,CAAClC,KAAZ,CAAkBkD,SAAlB,GAA8B,EAA9B;AACD;;AACD,UAAIP,KAAK,CAACY,qBAAN,KAAgC,IAApC,EACEZ,KAAK,CAACa,iBAAN;AACF,UAAI5B,MAAM,CAAC6B,MAAP,KAAkB,IAAlB,IAA0B7B,MAAM,CAAC2B,qBAAP,KAAiC,IAA/D,EACE3B,MAAM,CAAC4B,iBAAP;AACF,UAAIE,EAAJ,EAAQC,EAAR;;AACA,UAAI/B,MAAM,CAACgC,oBAAX,EAAiC;AAC/BF,QAAAA,EAAE,GAAG,EAAE9B,MAAM,CAACiC,KAAP,GAAejC,MAAM,CAACkC,IAAxB,IAAgC,CAArC;AACAH,QAAAA,EAAE,GAAG,CAAC/B,MAAM,CAACmC,GAAP,GAAanC,MAAM,CAACoC,MAArB,IAA+B,CAApC;AACD;;AACD,YAAMC,iBAAiB,GAAGrC,MAAM,CAACoB,IAAP,IAAepB,MAAM,CAACoB,IAAP,CAAYC,OAA3B,GAAqCrB,MAAM,CAACoB,IAAP,CAAYP,MAAZ,GAAqBb,MAAM,CAACoB,IAAP,CAAYM,UAAtE,GAAmF,CAA7G;AACA,YAAMY,eAAe,GAAGtC,MAAM,CAACgC,oBAAP,GAA+B,UAASK,iBAAkB,UAA5B,GAAwCpC,GAAxC,GAA8C,aAA9C,GAA8DsC,OAAO,CAACT,EAAD,CAArE,GAA4E,KAA5E,GAAoFS,OAAO,CAACR,EAAD,CAA3F,GAAkG,KAAlG,GAA0GS,kBAAkB,CAACxC,MAAM,CAACyC,kBAAR,CAA1J,GAAyL,UAASJ,iBAAkB,eAA5B,GAA6CpC,GAA7C,GAAmD,KAAnD,GAA2DuC,kBAAkB,CAACxC,MAAM,CAACyC,kBAAR,CAA7R;AACA,YAAMrE,KAAK,GAAGkE,eAAe,GAAG,YAAlB,GAAiCzC,UAAjC,GAA8C,KAA9C,GAAsDC,WAAtD,GAAoE,KAAlF;;AACA,UAAIC,KAAK,CAACC,MAAN,CAAa5B,KAAb,KAAuBA,KAA3B,EAAkC;AAChCqC,QAAAA,aAAa,CAACrC,KAAd,CAAoBkD,SAApB,GAAgClD,KAAhC;AACA2B,QAAAA,KAAK,CAACC,MAAN,CAAa5B,KAAb,GAAqBA,KAArB;AACD;;AACDsE,MAAAA,YAAY,CAAC3B,KAAD,EAAQA,KAAR,EAAef,MAAf,EAAuBsC,eAAvB,CAAZ;AACD,KA7BD;;AA8BA,SAAKK,OAAL,GAAe,UAAS/B,KAAT,EAAgBC,MAAhB,EAAwB;AACrClB,MAAAA,MAAM,GAAGiB,KAAT;AACAhB,MAAAA,OAAO,GAAGiB,MAAV;AACAhB,MAAAA,UAAU,GAAGF,MAAM,GAAG,CAAtB;AACAG,MAAAA,WAAW,GAAGF,OAAO,GAAG,CAAxB;AACAQ,MAAAA,UAAU,CAAChC,KAAX,CAAiBwC,KAAjB,GAAyBA,KAAK,GAAG,IAAjC;AACAR,MAAAA,UAAU,CAAChC,KAAX,CAAiByC,MAAjB,GAA0BA,MAAM,GAAG,IAAnC;AACAP,MAAAA,WAAW,CAAClC,KAAZ,CAAkBwC,KAAlB,GAA0BA,KAAK,GAAG,IAAlC;AACAN,MAAAA,WAAW,CAAClC,KAAZ,CAAkByC,MAAlB,GAA2BA,MAAM,GAAG,IAApC;AACAJ,MAAAA,aAAa,CAACrC,KAAd,CAAoBwC,KAApB,GAA4BA,KAAK,GAAG,IAApC;AACAH,MAAAA,aAAa,CAACrC,KAAd,CAAoByC,MAApB,GAA6BA,MAAM,GAAG,IAAtC;AACD,KAXD;;AAYA,aAAS0B,OAAT,CAAiBK,KAAjB,EAAwB;AACtB,aAAOC,IAAI,CAACC,GAAL,CAASF,KAAT,IAAkB,KAAlB,GAA0B,CAA1B,GAA8BA,KAArC;AACD;;AACD,aAASJ,kBAAT,CAA4BO,MAA5B,EAAoC;AAClC,YAAM9B,QAAQ,GAAG8B,MAAM,CAAC9B,QAAxB;AACA,aAAO,cAAcsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAArB,GAAqC,GAArC,GAA2CsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,CAAD,CAAV,CAAlD,GAAmE,GAAnE,GAAyEsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAAhF,GAAgG,GAAhG,GAAsGsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAA7G,GAA6H,GAA7H,GAAmIsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAA1I,GAA0J,GAA1J,GAAgKsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,CAAD,CAAV,CAAvK,GAAwL,GAAxL,GAA8LsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAArM,GAAqN,GAArN,GAA2NsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAAlO,GAAkP,GAAlP,GAAwPsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAA/P,GAA+Q,GAA/Q,GAAqRsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,CAAD,CAAV,CAA5R,GAA6S,GAA7S,GAAmTsB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAA1T,GAA2U,GAA3U,GAAiVsB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAxV,GAAyW,GAAzW,GAA+WsB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAtX,GAAuY,GAAvY,GAA6YsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,EAAD,CAAV,CAApZ,GAAsa,GAAta,GAA4asB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAnb,GAAoc,GAApc,GAA0csB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAjd,GAAke,GAAze;AACD;;AACD,aAAS+B,kBAAT,CAA4BD,MAA5B,EAAoC;AAClC,YAAM9B,QAAQ,GAAG8B,MAAM,CAAC9B,QAAxB;AACA,YAAMgC,QAAQ,GAAG,cAAcV,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAArB,GAAqC,GAArC,GAA2CsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAAlD,GAAkE,GAAlE,GAAwEsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAA/E,GAA+F,GAA/F,GAAqGsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAA5G,GAA4H,GAA5H,GAAkIsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,CAAD,CAAV,CAAzI,GAA0J,GAA1J,GAAgKsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,CAAD,CAAV,CAAvK,GAAwL,GAAxL,GAA8LsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,CAAD,CAAV,CAArM,GAAsN,GAAtN,GAA4NsB,OAAO,CAAC,CAACtB,QAAQ,CAAC,CAAD,CAAV,CAAnO,GAAoP,GAApP,GAA0PsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAAjQ,GAAiR,GAAjR,GAAuRsB,OAAO,CAACtB,QAAQ,CAAC,CAAD,CAAT,CAA9R,GAA8S,GAA9S,GAAoTsB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAA3T,GAA4U,GAA5U,GAAkVsB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAzV,GAA0W,GAA1W,GAAgXsB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAvX,GAAwY,GAAxY,GAA8YsB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAArZ,GAAsa,GAAta,GAA4asB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAnb,GAAoc,GAApc,GAA0csB,OAAO,CAACtB,QAAQ,CAAC,EAAD,CAAT,CAAjd,GAAke,GAAnf;AACA,aAAO,yBAAyBgC,QAAhC;AACD;;AACD,aAASP,YAAT,CAAsB/D,MAAtB,EAA8BoC,KAA9B,EAAqCf,MAArC,EAA6CsC,eAA7C,EAA8D;AAC5D,UAAI3D,MAAM,CAACR,aAAX,EAA0B;AACxB,cAAM+E,OAAO,GAAGvE,MAAM,CAACuE,OAAP,KAAmB,IAAnB,IAA2BvE,MAAM,CAACwE,MAAP,CAAcC,IAAd,CAAmBpD,MAAM,CAACmD,MAA1B,MAAsC,IAAjF;AACAxE,QAAAA,MAAM,CAACX,OAAP,CAAeI,KAAf,CAAqBiF,OAArB,GAA+BH,OAAO,KAAK,IAAZ,GAAmB,EAAnB,GAAwB,MAAvD;;AACA,YAAIA,OAAO,KAAK,IAAhB,EAAsB;AACpBvE,UAAAA,MAAM,CAAC2E,cAAP,CAAsB5D,KAAtB,EAA6BqB,KAA7B,EAAoCf,MAApC;AACA,cAAI5B,KAAJ;;AACA,cAAIO,MAAM,CAACS,aAAX,EAA0B;AACxBE,YAAAA,OAAO,CAACP,IAAR,CAAaiB,MAAM,CAACyC,kBAApB;;AACAnD,YAAAA,OAAO,CAACiE,SAAR;;AACA,gBAAI5E,MAAM,CAACU,UAAP,KAAsB,CAA1B,EACEC,OAAO,CAACkE,QAAR,CAAiBjE,QAAQ,CAACkE,aAAT,CAAuB9E,MAAM,CAACU,UAA9B,CAAjB;AACFV,YAAAA,MAAM,CAAC+E,WAAP,CAAmBC,SAAnB,CAA6BhG,SAA7B,EAAwCC,WAAxC,EAAqDC,MAArD;;AACAyB,YAAAA,OAAO,CAACsE,WAAR,CAAoBjG,SAApB;;AACA2B,YAAAA,OAAO,CAACuE,KAAR,CAAchG,MAAd;;AACAyB,YAAAA,OAAO,CAAC2B,QAAR,CAAiB,CAAjB,IAAsB,CAAtB;AACA3B,YAAAA,OAAO,CAAC2B,QAAR,CAAiB,CAAjB,IAAsB,CAAtB;AACA3B,YAAAA,OAAO,CAAC2B,QAAR,CAAiB,EAAjB,IAAuB,CAAvB;AACA3B,YAAAA,OAAO,CAAC2B,QAAR,CAAiB,EAAjB,IAAuB,CAAvB;AACA7C,YAAAA,KAAK,GAAG4E,kBAAkB,CAAC1D,OAAD,CAA1B;AACD,WAbD,MAaO;AACLlB,YAAAA,KAAK,GAAG4E,kBAAkB,CAACrE,MAAM,CAAC+E,WAAR,CAA1B;AACD;;AACD,gBAAM1F,OAAO,GAAGW,MAAM,CAACX,OAAvB;AACA,gBAAM8F,YAAY,GAAG/D,KAAK,CAACG,OAAN,CAAc6D,GAAd,CAAkBpF,MAAlB,CAArB;;AACA,cAAImF,YAAY,KAAK,KAAK,CAAtB,IAA2BA,YAAY,CAAC1F,KAAb,KAAuBA,KAAtD,EAA6D;AAC3DJ,YAAAA,OAAO,CAACI,KAAR,CAAckD,SAAd,GAA0BlD,KAA1B;AACA,kBAAM4F,UAAU,GAAG;AAAE5F,cAAAA;AAAF,aAAnB;AACA2B,YAAAA,KAAK,CAACG,OAAN,CAAc+D,GAAd,CAAkBtF,MAAlB,EAA0BqF,UAA1B;AACD;;AACD,cAAIhG,OAAO,CAACa,UAAR,KAAuB4B,aAA3B,EAA0C;AACxCA,YAAAA,aAAa,CAACD,WAAd,CAA0BxC,OAA1B;AACD;;AACDW,UAAAA,MAAM,CAACuF,aAAP,CAAqBxE,KAArB,EAA4BqB,KAA5B,EAAmCf,MAAnC;AACD;AACF;;AACD,WAAK,IAAImE,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGzF,MAAM,CAAC0F,QAAP,CAAgBC,MAApC,EAA4CH,CAAC,GAAGC,CAAhD,EAAmDD,CAAC,EAApD,EAAwD;AACtDzB,QAAAA,YAAY,CAAC/D,MAAM,CAAC0F,QAAP,CAAgBF,CAAhB,CAAD,EAAqBpD,KAArB,EAA4Bf,MAA5B,EAAoCsC,eAApC,CAAZ;AACD;AACF;AACF;;AAvHiB;;AAyHpB,SACExE,WADF,EAEE0B,aAFF,EAGEL,WAHF","sourcesContent":["import { Vector3, Quaternion, Object3D, Matrix4 } from \"three\";\nconst _position = /* @__PURE__ */ new Vector3();\nconst _quaternion = /* @__PURE__ */ new Quaternion();\nconst _scale = /* @__PURE__ */ new Vector3();\nclass CSS3DObject extends Object3D {\n  constructor(element = document.createElement(\"div\")) {\n    super();\n    this.isCSS3DObject = true;\n    this.element = element;\n    this.element.style.position = \"absolute\";\n    this.element.style.pointerEvents = \"auto\";\n    this.element.style.userSelect = \"none\";\n    this.element.setAttribute(\"draggable\", false);\n    this.addEventListener(\"removed\", function() {\n      this.traverse(function(object) {\n        if (object.element instanceof Element && object.element.parentNode !== null) {\n          object.element.parentNode.removeChild(object.element);\n        }\n      });\n    });\n  }\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n}\nclass CSS3DSprite extends CSS3DObject {\n  constructor(element) {\n    super(element);\n    this.isCSS3DSprite = true;\n    this.rotation2D = 0;\n  }\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.rotation2D = source.rotation2D;\n    return this;\n  }\n}\nconst _matrix = /* @__PURE__ */ new Matrix4();\nconst _matrix2 = /* @__PURE__ */ new Matrix4();\nclass CSS3DRenderer {\n  constructor(parameters = {}) {\n    const _this = this;\n    let _width, _height;\n    let _widthHalf, _heightHalf;\n    const cache = {\n      camera: { fov: 0, style: \"\" },\n      objects: /* @__PURE__ */ new WeakMap()\n    };\n    const domElement = parameters.element !== void 0 ? parameters.element : document.createElement(\"div\");\n    domElement.style.overflow = \"hidden\";\n    this.domElement = domElement;\n    const viewElement = document.createElement(\"div\");\n    viewElement.style.transformOrigin = \"0 0\";\n    viewElement.style.pointerEvents = \"none\";\n    domElement.appendChild(viewElement);\n    const cameraElement = document.createElement(\"div\");\n    cameraElement.style.transformStyle = \"preserve-3d\";\n    viewElement.appendChild(cameraElement);\n    this.getSize = function() {\n      return {\n        width: _width,\n        height: _height\n      };\n    };\n    this.render = function(scene, camera) {\n      const fov = camera.projectionMatrix.elements[5] * _heightHalf;\n      if (cache.camera.fov !== fov) {\n        viewElement.style.perspective = camera.isPerspectiveCamera ? fov + \"px\" : \"\";\n        cache.camera.fov = fov;\n      }\n      if (camera.view && camera.view.enabled) {\n        viewElement.style.transform = `translate( ${-camera.view.offsetX * (_width / camera.view.width)}px, ${-camera.view.offsetY * (_height / camera.view.height)}px )`;\n        viewElement.style.transform += `scale( ${camera.view.fullWidth / camera.view.width}, ${camera.view.fullHeight / camera.view.height} )`;\n      } else {\n        viewElement.style.transform = \"\";\n      }\n      if (scene.matrixWorldAutoUpdate === true)\n        scene.updateMatrixWorld();\n      if (camera.parent === null && camera.matrixWorldAutoUpdate === true)\n        camera.updateMatrixWorld();\n      let tx, ty;\n      if (camera.isOrthographicCamera) {\n        tx = -(camera.right + camera.left) / 2;\n        ty = (camera.top + camera.bottom) / 2;\n      }\n      const scaleByViewOffset = camera.view && camera.view.enabled ? camera.view.height / camera.view.fullHeight : 1;\n      const cameraCSSMatrix = camera.isOrthographicCamera ? `scale( ${scaleByViewOffset} )scale(` + fov + \")translate(\" + epsilon(tx) + \"px,\" + epsilon(ty) + \"px)\" + getCameraCSSMatrix(camera.matrixWorldInverse) : `scale( ${scaleByViewOffset} )translateZ(` + fov + \"px)\" + getCameraCSSMatrix(camera.matrixWorldInverse);\n      const style = cameraCSSMatrix + \"translate(\" + _widthHalf + \"px,\" + _heightHalf + \"px)\";\n      if (cache.camera.style !== style) {\n        cameraElement.style.transform = style;\n        cache.camera.style = style;\n      }\n      renderObject(scene, scene, camera, cameraCSSMatrix);\n    };\n    this.setSize = function(width, height) {\n      _width = width;\n      _height = height;\n      _widthHalf = _width / 2;\n      _heightHalf = _height / 2;\n      domElement.style.width = width + \"px\";\n      domElement.style.height = height + \"px\";\n      viewElement.style.width = width + \"px\";\n      viewElement.style.height = height + \"px\";\n      cameraElement.style.width = width + \"px\";\n      cameraElement.style.height = height + \"px\";\n    };\n    function epsilon(value) {\n      return Math.abs(value) < 1e-10 ? 0 : value;\n    }\n    function getCameraCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      return \"matrix3d(\" + epsilon(elements[0]) + \",\" + epsilon(-elements[1]) + \",\" + epsilon(elements[2]) + \",\" + epsilon(elements[3]) + \",\" + epsilon(elements[4]) + \",\" + epsilon(-elements[5]) + \",\" + epsilon(elements[6]) + \",\" + epsilon(elements[7]) + \",\" + epsilon(elements[8]) + \",\" + epsilon(-elements[9]) + \",\" + epsilon(elements[10]) + \",\" + epsilon(elements[11]) + \",\" + epsilon(elements[12]) + \",\" + epsilon(-elements[13]) + \",\" + epsilon(elements[14]) + \",\" + epsilon(elements[15]) + \")\";\n    }\n    function getObjectCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      const matrix3d = \"matrix3d(\" + epsilon(elements[0]) + \",\" + epsilon(elements[1]) + \",\" + epsilon(elements[2]) + \",\" + epsilon(elements[3]) + \",\" + epsilon(-elements[4]) + \",\" + epsilon(-elements[5]) + \",\" + epsilon(-elements[6]) + \",\" + epsilon(-elements[7]) + \",\" + epsilon(elements[8]) + \",\" + epsilon(elements[9]) + \",\" + epsilon(elements[10]) + \",\" + epsilon(elements[11]) + \",\" + epsilon(elements[12]) + \",\" + epsilon(elements[13]) + \",\" + epsilon(elements[14]) + \",\" + epsilon(elements[15]) + \")\";\n      return \"translate(-50%,-50%)\" + matrix3d;\n    }\n    function renderObject(object, scene, camera, cameraCSSMatrix) {\n      if (object.isCSS3DObject) {\n        const visible = object.visible === true && object.layers.test(camera.layers) === true;\n        object.element.style.display = visible === true ? \"\" : \"none\";\n        if (visible === true) {\n          object.onBeforeRender(_this, scene, camera);\n          let style;\n          if (object.isCSS3DSprite) {\n            _matrix.copy(camera.matrixWorldInverse);\n            _matrix.transpose();\n            if (object.rotation2D !== 0)\n              _matrix.multiply(_matrix2.makeRotationZ(object.rotation2D));\n            object.matrixWorld.decompose(_position, _quaternion, _scale);\n            _matrix.setPosition(_position);\n            _matrix.scale(_scale);\n            _matrix.elements[3] = 0;\n            _matrix.elements[7] = 0;\n            _matrix.elements[11] = 0;\n            _matrix.elements[15] = 1;\n            style = getObjectCSSMatrix(_matrix);\n          } else {\n            style = getObjectCSSMatrix(object.matrixWorld);\n          }\n          const element = object.element;\n          const cachedObject = cache.objects.get(object);\n          if (cachedObject === void 0 || cachedObject.style !== style) {\n            element.style.transform = style;\n            const objectData = { style };\n            cache.objects.set(object, objectData);\n          }\n          if (element.parentNode !== cameraElement) {\n            cameraElement.appendChild(element);\n          }\n          object.onAfterRender(_this, scene, camera);\n        }\n      }\n      for (let i = 0, l = object.children.length; i < l; i++) {\n        renderObject(object.children[i], scene, camera, cameraCSSMatrix);\n      }\n    }\n  }\n}\nexport {\n  CSS3DObject,\n  CSS3DRenderer,\n  CSS3DSprite\n};\n"]},"metadata":{},"sourceType":"module"}